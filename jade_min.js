var jade=function(){function a(a){a.jade=this,this.parent=a,this.module=void 0,this.top_level=$('<div class="jade-top-level"> <div class="jade-tabs-div"></div> <div class="jade-status"><span id="message"></span><div style="float:right">Jade 2.1.1</div></div></div>'),$(a).append(this.top_level),this.status=this.top_level.find("#message"),this.tabs_div=this.top_level.find(".jade-tabs-div"),this.tabs={},this.selected_tab=void 0,this.status.text("Copyright \xa9 MIT EECS 2011-2014");var b=this;$(window).on("resize",function(){var a=$("body"),c=$(window).width()-(a.outerWidth(!0)-a.width())-8,d=$(window).height()-(a.outerHeight(!0)-a.height())-8;b.resize(c,d)});var g=$('<div class="jade-settings-popup"></div>');if(this.settings=g,g.append($('<div class="jade-setting" id="edit_module">Edit module</div>').on("click",function(){c($(".jade-settings-popup")[0].diagram)})),g.append($('<div class="jade-setting" id="delete_module")>Delete module</div>').on("click",function(){d($(".jade-settings-popup")[0].diagram)})),g.append($('<div class="jade-setting" id="copy_module">Copy module</div>').on("click",function(){e($(".jade-settings-popup")[0].diagram)})),g.append($("<hr/>")),g.append($('<div class="jade-setting" id="copy_library">Copy library</div>').on("click",function(){f($(".jade-settings-popup")[0].diagram)})),g.append($("<hr/>")),g.append($('<div class="jade-setting jade-setting-enabled">Toggle grid</div>').on("click",function(){h($(".jade-settings-popup")[0].diagram),g.toggle()})),jade.request_zip_url){var i=$("<a></a>").attr("href",jade.request_zip_url).text("Download zip archive");i.css({color:"black","text-decoration":"none"}),g.append($('<div class="jade-setting jade-setting-enabled"></div>').append(i).on("click",function(){g.toggle()}))}g.on("mouseleave",function(){g.hide()}),this.top_level.append(g)}function b(a){var b=a.editor.jade,c=b.settings,d=$(".jade-toolbar",$(".jade-tab-body-active",b.top_level)),e=d.offset();e.top+=d.outerHeight(),c.css(e),$("#edit_module",c).removeClass("jade-setting-enabled"),$("#delete_module",c).removeClass("jade-setting-enabled"),$("#copy_module",c).removeClass("jade-setting-enabled"),$("#copy_library",c).removeClass("jade-setting-enabled"),b.configuration.hierarchical&&($("#edit_module",c).addClass("jade-setting-enabled"),$("#copy_module",c).addClass("jade-setting-enabled"),$("#copy_library",c).addClass("jade-setting-enabled"),a.aspect.read_only()||$("#delete_module",c).addClass("jade-setting-enabled")),c[0].diagram=a,c.toggle()}function c(a){function b(){function g(a){$("#msg",e).text(a),$("#msg",e).show(),s("Edit Module",e,b,d)}var h,i,j=$(f).val().split(":");if(1==j.length)h=a.aspect.module?a.aspect.module.library.name:"user",i=j[0];else{if(2!=j.length)return void g("Invalid module name: "+$(f).val());h=j[0],i=j[1]}return h=jade.model.load_library(h),!h.read_only||i in h.modules?(i=h.module(i),void c.edit(i.get_name())):void g("Library is read-only: "+h.name)}var c=a.editor.jade,d=c.settings.offset();c.settings.toggle();var e=$('<div style="margin:10px;"><div id="msg" style="display:none;color:red;margin-bottom:10px;"></div></div>');e.append("Module name:");var f=v("text",10,"library:module");$(f).css("vertical-align","middle"),e.append(f),s("Edit Module",e,b,d)}function d(a){function b(){var b=a.aspect.module,d=b.library;d.remove_module(b.name),b=Object.keys(d.modules)[0],b=b?d.modules[b].get_name():"user:untitled",c.edit(b)}var c=a.editor.jade,d=c.settings.offset();c.settings.toggle();var e=$('<div style="margin:10px;width:300px;">Click OK to confirm the deletion of module <span id="mname"></span>.  Note that this action cannot be undone.</div>');$("#mname",e).text(a.aspect.module.get_name()),s("Delete Module",e,b,d)}function e(a){function b(){function g(a){$("#msg",e).text(a),$("#msg",e).show(),s("Copy Module",e,b,d)}var h,i,j=$(f).val().split(":");if(1==j.length)h=a.aspect.module?a.aspect.module.library.name:"user",i=j[0];else{if(2!=j.length)return void g("Invalid module name: "+$(f).val());h=j[0],i=j[1]}return h=jade.model.load_library(h),h.read_only?void g("Library is read-only: "+h.name):i in h.modules?void g("Module already exists: "+h.modules[i].get_name()):(i=h.module(i,a.aspect.module.json()),void c.edit(i.get_name()))}var c=a.editor.jade,d=c.settings.offset();c.settings.toggle();var e=$('<div style="margin:10px;"><div id="msg" style="display:none;color:red;margin-bottom:10px;"></div></div>');e.append("New module name:");var f=v("text",10,"library:module");$(f).css("vertical-align","middle"),e.append(f),s("Copy Module",e,b,d)}function f(a){function b(){function g(a){$("#msg",e).text(a),$("#msg",e).show(),s("Copy Library",e,b,d)}var h=$(f).val();if(h=jade.model.load_library(h),0!=Object.keys(h.modules).length||h.read_only)return void g("Library already exists: "+h.name);var i=a.aspect.module,j=i.library.json(),k=i.library.name,l=h.name;$.each(j,function(a,b){b.schematic&&$.each(b.schematic,function(a,b){var c=b[0].split(":");2==c.length&&c[0]==k&&(b[0]=l+":"+c[1])})}),h.load(j),jade.save_to_server(h),i=h.module(i.name),c.edit(i.get_name())}var c=a.editor.jade,d=c.settings.offset();c.settings.toggle();var e=$('<div style="margin:10px;"><div id="msg" style="display:none;color:red;margin-bottom:10px;"></div></div>');e.append("New library name:");var f=v("text",10,"library");$(f).css("vertical-align","middle"),e.append(f),s("Copy Library",e,b,d)}function g(a,b){this.editor=a,this.aspect=void 0,this.canvas=$("<canvas></canvas>").addClass(b)[0];var c=this.canvas.getContext("2d"),d=window.devicePixelRatio||1,e=c.webkitBackingStorePixelRatio||c.mozBackingStorePixelRatio||c.msBackingStorePixelRatio||c.oBackingStorePixelRatio||c.backingStorePixelRatio||1;this.pixelRatio=d/e,this.sctl_r=16,this.sctl_x=this.sctl_r+8,this.sctl_y=this.sctl_r+8,this.zctl_left=this.sctl_x-8,this.zctl_top=this.sctl_y+this.sctl_r+8,this.background_style="rgb(250,250,250)",this.grid_style="rgb(230,230,230)",this.control_style="rgb(180,180,180)",this.normal_style="rgb(88,110,117)",this.component_style="rgb(38,139,210)",this.selected_style="rgb(211,54,130)",this.annotation_style="rgb(220,50,47)",this.property_font="5pt sans-serif",this.annotation_font="6pt sans-serif",this.bg_image=$("<canvas></canvas>")[0],this.bg_image.getContext("2d").scale(this.pixelRatio,this.pixelRatio),this.canvas.tabIndex=1,this.canvas.diagram=this,this.dragging=!1,this.select_rect=void 0,this.annotations=[],this.show_grid=!0,this.origin_x=0,this.origin_y=0,this.cursor_x=0,this.cursor_y=0,this.unsel_bbox=[1/0,1/0,-1/0,-1/0],this.bbox=[0,0,0,0]}function h(a){a.show_grid=!a.show_grid,a.redraw_background()}function i(a){a.aspect.undo(),a.unselect_all(-1),a.redraw_background()}function j(a){a.aspect.redo(),a.unselect_all(-1),a.redraw_background()}function k(a){H[a.editor.editor_name]=[],a.aspect.start_action(),a.aspect.map_over_components(function(b){b.selected&&(b.remove(),H[a.editor.editor_name].push(b))}),a.aspect.end_action(),a.editor.diagram_changed(a),a.redraw()}function l(a){H[a.editor.editor_name]=[],a.aspect.map_over_components(function(b){b.selected&&H[a.editor.editor_name].push(b.clone(b.coords[0],b.coords[1]))}),a.redraw()}function m(a){var b,c,d,e,f=H[a.editor.editor_name],g=1;for(b=f.length-1;b>=0;b-=1)c=f[b],d=d?Math.min(d,c.coords[0]):c.coords[0],e=e?Math.min(e,c.coords[1]):c.coords[1],g=Math.max(g,c.required_grid);for(a.set_cursor_grid(g),d=a.on_grid(d),e=a.on_grid(e),a.unselect_all(-1),a.redraw_background(),a.aspect.start_action(),b=f.length-1;b>=0;b-=1){c=f[b];var h=c.clone(a.cursor_x+(c.coords[0]-d),a.cursor_y+(c.coords[1]-e));h.set_select(!0),h.add(a.aspect)}a.aspect.end_action(),a.editor.diagram_changed(a),a.redraw()}function n(a){a.rotate(4)}function o(a){a.rotate(6)}function p(a){a.rotate(1)}function q(a){a.rotate(3)}function r(){var a=$('<div class="jade-progress"><div class="jade-progress-wrapper"><div class="jade-progress-bar" style="width:0%"></div></div><button id="stop">Stop</button></div>');a[0].update_progress=function(b){a.find(".jade-progress-bar").css("width",b+"%")};var b=a.find("#stop");return b.on("click",function(){a[0].stop_requested=!0}),a}function s(a,b,c,d){var e=$('<div> <div class="jade-dialog-content"></div> <div class="jade-dialog-buttons">  <span id="ok" class="jade-dialog-button">OK</span>  <span id="cancel" class="jade-dialog-button">Cancel</span></div></div>');e[0].callback=c;var f;$(b).find(".property").each(function(a,b){var c=$(b);0==a&&(f=c),b.dialog=e[0],c.keypress(function(a){13==a.keyCode&&e.find("#ok").trigger("click")}),c.focus(function(){c.select()})}),e.find(".jade-dialog-content").append(b),e.find("#ok").on("click",function(){z(e[0].win),e[0].callback&&setTimeout(function(){e[0].callback()},1)}),e.find("#cancel").on("click",function(){z(e[0].win)}),x(a,e[0],d),f&&f.focus()}function t(a){var b=$("<table></table>");for(var c in a){var d=$('<tr valign="center"><td><nobr>'+c+' :</nobr></td><td id="field"></td></tr>');d.find("#field").append(a[c]),b.append(d)}return b[0]}function u(a,b){var c=$("<button>"+a+"</button>").click(b);return c[0]}function v(a,b,c){var d;return d="text"==a?$('<textarea class="property" autocorrect="off" autocapitalize="off" rows="1"></textarea>'):$('<input class="property" autocorrect="off" autocapitalize="off"></input>').attr("type",a).attr("size",b),d.val(void 0===c?"":c.toString()),d[0]}function w(a,b,c){c=$(void 0===c?"<select></select>":c);for(var d=0;d<a.length;d+=1){var e=$("<option>"+a[d]+"</option>");c.append(e),a[d]==b&&e.attr("selected","true")}return c[0]}function x(a,b,c){var d=$('<div class="jade-window"> <div class="jade-window-title">'+a+'<span style="float:right;cursor: pointer">'+jade.icons.close_icon+"</span></div></div>");d[0].content=b,d[0].drag_x=void 0,d[0].draw_y=void 0;var e=d.find(".jade-window-title").mousedown(A);e[0].win=d[0],d[0].head=e[0];d.find("span").click(function(){z(d[0])});if(d.append($(b)),b.win=d[0],$(b).toggleClass("jade-window-contents"),b.resize){var f=$('<div class="jade-window-resize"></div>');f.append($(jade.icons.resize_icon).css("pointer-events","none")),f[0].win=d[0],d[0].resize=function(a,c){var e=d;e.height(e.height()+c),e.width(e.width()+a),e=$(b),b.resize(b,e.width()+a,e.height()+c)},f.mousedown(B),d.append(f)}return $("body").append(d),c&&d.offset(c),y(d[0],!0),d}function y(a,b){var c=I.indexOf(a);for(-1!=c&&I.splice(c,1),b&&I.push(a),c=0;c<I.length;c+=1)$(I[c]).css("z-index",100+c)}function z(a){$(a).remove(),y(a,!1)}function A(a){function b(a){var b=a.pageX-g,c=a.pageY-h,d=$(f).offset();return d.top+=c,d.left+=b,$(f).offset(d),g+=b,h+=c,!1}function c(){return e.removeEventListener("mousemove",b,!0),e.removeEventListener("mouseup",c,!0),!1}var d=window.event||a,e=$(document).get(0),f=d.target.win;y(f,!0);var g=d.pageX,h=d.pageY;return e.addEventListener("mousemove",b,!0),e.addEventListener("mouseup",c,!0),!1}function B(a){function b(a){var b=window.event||a;return d.resize(b.pageX-e,b.pageY-f),e=b.pageX,f=b.pageY,!1}function c(){return g.removeEventListener("mousemove",b,!0),g.removeEventListener("mouseup",c,!0),!1}var d=a.target.win,e=a.pageX,f=a.pageY,g=$(document).get(0);return g.addEventListener("mousemove",b,!0),g.addEventListener("mouseup",c,!0),!1}function C(a){this.diagram=a,this.tools={},this.toolbar=$('<div class="jade-toolbar"></div>')}function D(a){var b=a.target;b.enabled&&b.diagram.message(b.tip)}function E(a){var b=a.target;b.enabled&&b.diagram.clear_message(b.tip)}function F(a){var b=a.target;b.enabled&&(b.diagram.event_coords(a),b.callback(b.diagram))}var G=[],H={};a.prototype.initialize=function(a){var b=this;this.configuration=a,this.id=a.id,void 0===a.tests&&(a.tests={});var c;a.editors?(c=[],$.each(a.editors.split(","),function(a,b){$.each(G,function(a,d){d.prototype.editor_name==b&&c.push(d)})})):c=G,b.tabs_div.empty(),$(".jade-tab-body",b.top_level).remove(),$.each(c,function(a,c){var d=c.prototype.editor_name;H[d]=[];var e=$('<div class="jade-tab">'+d+"</div>");b.tabs_div.append(e),e.click(function(a){b.show(d),a.preventDefault()});var f=$('<div class="jade-tab-body"></div>');b.top_level.find(".jade-tabs-div").after(f),f[0].editor=new c(f[0],b),b.tabs[d]=[e[0],f[0]],f.on("mouseleave",function(){jade.model.save_libraries()})}),c.length>0&&this.show(c[0].prototype.editor_name),$(window).trigger("resize");var d=a.state||a.initial_state||{};$.each(d,function(a,b){var c=new jade.model.Library(a);c.load(b)}),void 0===a.edit&&(a.edit=localStorage.getItem("jade-module"),null==a.edit&&(a.edit="gates:and2"));var e=a.edit.split(".");this.edit(e[0]),e.length>1&&this.show(e[1])},a.prototype.get_state=function(){var a=$.extend({},this.configuration);return jade.model.libraries.user&&(a.state={user:jade.model.libraries.user.json()},jade.model.libraries.user.clear_modified()),a},a.prototype.get_grade=function(){return this.configuration.tests},a.prototype.bookmark=function(){if(void 0!==this.module){var a=this.module.get_name();void 0!==this.selected_tab&&(a+="."+this.selected_tab),localStorage.setItem("jade-module",a)}},a.prototype.edit=function(a){"string"==typeof a&&(a=jade.model.find_module(a)),this.module=a,void 0!==this.input_field&&this.input_field.val(a.get_name()),this.bookmark(),this.refresh(),jade.model.save_libraries()},a.prototype.refresh=function(){if(void 0!==this.module)for(var a in this.tabs)this.tabs[a][1].editor.set_aspect(this.module)},a.prototype.show=function(a){this.selected_tab=a,this.bookmark();for(var b in this.tabs){var c=this.tabs[b],d=b==a;$(c[0]).toggleClass("jade-tab-active",d),$(c[1]).toggleClass("jade-tab-body-active",d),d&&c[1].editor.show()}},a.prototype.resize=function(a,b){var c=$(this.top_level),d=c.outerWidth(!0)-c.width(),e=c.outerHeight(!0)-c.height();a-=d,b-=e+$(".jade-tabs-div",c).outerHeight(!0)+$(".jade-status",c).outerHeight(!0);for(var f in this.tabs){var g=this.tabs[f][1];c=$(g),d=c.outerWidth(!0)-c.width(),e=c.outerHeight(!0)-c.height();var h=a-d,i=b-e;c.width(h),c.height(i),g.editor.resize(h,i,f==this.selected_tab)}},g.prototype.getAttribute=function(){return void 0},g.prototype.set_aspect=function(a){this.aspect=a,this.show_grid=!0,this.redraw_background(),this.zoomall()},g.prototype.unselect_all=function(a){this.annotations=[],this.aspect.map_over_components(function(b,c){c!=a&&b.set_select(!1)})},g.prototype.remove_annotations=function(){this.unselect_all(),this.redraw_background()},g.prototype.add_annotation=function(a){this.annotations.push(a),this.redraw()},g.prototype.drag_begin=function(){var a=1;this.aspect.map_over_components(function(b){b.selected&&(b.move_begin(),a=Math.max(a,b.required_grid))}),this.set_cursor_grid(a),this.drag_x=this.cursor_x,this.drag_y=this.cursor_y,this.dragging=!0},g.prototype.drag_end=function(){this.aspect.map_over_components(function(a){a.selected&&a.move_end()}),this.dragging=!1,this.aspect.end_action(),this.editor.diagram_changed(this),this.redraw_background()},g.prototype.zoomin=function(){var a=this.scale*this.zoom_factor;a<this.zoom_max&&(this.origin_x+=this.canvas.clientWidth/2*(1/this.scale-1/a),this.origin_y+=this.canvas.clientHeight/2*(1/this.scale-1/a),this.scale=a,this.redraw_background())},g.prototype.zoomout=function(){var a=this.scale/this.zoom_factor;a>this.zoom_min&&(this.origin_x+=this.canvas.clientWidth/2*(1/this.scale-1/a),this.origin_y+=this.canvas.clientHeight/2*(1/this.scale-1/a),this.scale=a,this.redraw_background())},g.prototype.zoomall=function(){var a=1.5*(this.bbox[2]-this.bbox[0]),b=1.5*(this.bbox[3]-this.bbox[1]);if(0===a)this.scale=1;else{var c=this.canvas.clientWidth/a,d=this.canvas.clientHeight/b;this.scale=Math.pow(this.zoom_factor,Math.ceil(Math.log(Math.min(c,d))/Math.log(this.zoom_factor))),this.scale<this.zoom_min?this.scale=this.zoom_min:this.scale>this.zoom_max&&(this.scale=this.zoom_max)}this.origin_x=(this.bbox[2]+this.bbox[0])/2-this.canvas.clientWidth/(2*this.scale),this.origin_y=(this.bbox[3]+this.bbox[1])/2-this.canvas.clientHeight/(2*this.scale),this.redraw_background()},g.prototype.set_cursor_grid=function(a){this.cursor_grid=a,this.cursor_x=this.on_grid(this.aspect_x),this.cursor_y=this.on_grid(this.aspect_y)},g.prototype.on_grid=function(a,b){return void 0===b&&(b=this.cursor_grid),0>a?Math.floor((-a+(b>>1))/b)*-b:Math.floor((a+(b>>1))/b)*b},g.prototype.rotate=function(a){var b=this.aspect.selected_bbox(),c=this.aspect.selected_grid(),d=this.on_grid(b[0]+b[2]>>1,c),e=this.on_grid(b[1]+b[3]>>1,c);this.aspect.start_action(),this.aspect.map_over_components(function(b){b.selected&&(b.move_begin(),b.rotate(a,d,e))}),b=this.aspect.selected_bbox();var f=d-this.on_grid(b[0]+b[2]>>1,c),g=e-this.on_grid(b[1]+b[3]>>1,c);this.aspect.map_over_components(function(a){a.selected&&((0!==f||0!==g)&&a.move(f,g),a.move_end())}),this.aspect.end_action(),this.editor.diagram_changed(this),this.redraw()},g.prototype.resize=function(){var a=this.canvas.clientWidth,b=this.canvas.clientHeight;this.canvas.width=a*this.pixelRatio,this.canvas.height=b*this.pixelRatio,this.canvas.getContext("2d").scale(this.pixelRatio,this.pixelRatio),this.bg_image.width=a*this.pixelRatio,this.bg_image.height=b*this.pixelRatio,this.bg_image.getContext("2d").scale(this.pixelRatio,this.pixelRatio),this.zoomall()},g.prototype.redraw_background=function(){var a=this.bg_image.getContext("2d");if(this.c=a,a.lineCap="round",a.fillStyle=this.show_grid?this.background_style:"white",a.fillRect(0,0,this.canvas.clientWidth,this.canvas.clientHeight),!this.diagram_only&&this.show_grid){a.strokeStyle=this.grid_style;var b,c=this.origin_x,d=c+this.canvas.clientWidth/this.scale,e=this.origin_y,f=e+this.canvas.clientHeight/this.scale;for(b=this.grid*Math.ceil(c/this.grid);d>b;b+=this.grid)this.draw_line(b,e,b,f,.2);for(b=this.grid*Math.ceil(e/this.grid);f>b;b+=this.grid)this.draw_line(c,b,d,b,.2);this.draw_arc(0,0,this.grid/2,0,2*Math.PI,!1,.2,!1)}this.unsel_bbox=this.aspect.unselected_bbox();var g=this;this.aspect.map_over_components(function(a){a.selected||a.draw(g)}),this.aspect&&this.aspect.module&&(a.textAlign="left",a.textBaseline="bottom",a.font="12pt sans-serif",a.fillStyle=this.normal_style,a.fillText(this.aspect.module.get_name(),2,this.canvas.height-2)),this.redraw()},g.prototype.redraw=function(){var a=this.canvas.getContext("2d");this.c=a,a.drawImage(this.bg_image,0,0,this.canvas.clientWidth,this.canvas.clientHeight),this.bbox=this.aspect.selected_bbox(this.unsel_bbox),1/0==this.bbox[0]&&(this.bbox=[0,0,0,0]);var b=this;this.aspect.map_over_components(function(a){a.selected&&a.draw(b)});for(var c in this.aspect.connection_points){var d=this.aspect.connection_points[c];d[0].draw(this,d.length)}if(this.editor.redraw(this),this.select_rect){var e=this.select_rect;a.lineWidth=1,a.strokeStyle=this.selected_style,a.beginPath(),a.moveTo(e[0],e[1]),a.lineTo(e[0],e[3]),a.lineTo(e[2],e[3]),a.lineTo(e[2],e[1]),a.lineTo(e[0],e[1]),a.stroke()}for(var f=0;f<this.annotations.length;f+=1)this.annotations[f](this);var g=this.sctl_r,h=this.sctl_x,i=this.sctl_y;a.fillStyle=this.background_style,a.beginPath(),a.arc(h,i,g,0,2*Math.PI),a.fill(),a.strokeStyle=this.control_style,a.lineWidth=.5,a.beginPath(),a.arc(h,i,g,0,2*Math.PI),a.stroke(),a.lineWidth=3,a.beginPath(),a.moveTo(h+4,i-g+8),a.lineTo(h,i-g+4),a.lineTo(h-4,i-g+8),a.moveTo(h+g-8,i+4),a.lineTo(h+g-4,i),a.lineTo(h+g-8,i-4),a.moveTo(h+4,i+g-8),a.lineTo(h,i+g-4),a.lineTo(h-4,i+g-8),a.moveTo(h-g+8,i+4),a.lineTo(h-g+4,i),a.lineTo(h-g+8,i-4),a.stroke(),h=this.zctl_left,i=this.zctl_top,a.lineWidth=.5,a.fillStyle=this.background_style,a.fillRect(h,i,16,48),a.strokeStyle=this.control_style,a.strokeRect(h,i,16,48),a.lineWidth=1,a.beginPath(),a.moveTo(h+4,i+8),a.lineTo(h+12,i+8),a.moveTo(h+8,i+4),a.lineTo(h+8,i+12),a.moveTo(h+4,i+24),a.lineTo(h+12,i+24),a.stroke(),a.strokeRect(h+4,i+36,8,8),a.fillStyle=this.background_style,a.fillRect(h+7,i+34,2,10),a.fillRect(h+3,i+39,10,2)},g.prototype.moveTo=function(a,b){var c=Math.floor((a-this.origin_x)*this.scale),d=Math.floor((b-this.origin_y)*this.scale);1==(1&this.c.lineWidth)&&(c+=.5,d+=.5),this.c.moveTo(c,d)},g.prototype.lineTo=function(a,b){var c=Math.floor((a-this.origin_x)*this.scale),d=Math.floor((b-this.origin_y)*this.scale);1==(1&this.c.lineWidth)&&(c+=.5,d+=.5),this.c.lineTo(c,d)},g.prototype.line_width=function(a){return Math.max(1,Math.floor(a*this.scale))},g.prototype.draw_line=function(a,b,c,d,e){var f=this.c;f.lineWidth=this.line_width(e),f.beginPath(),this.moveTo(a,b),this.lineTo(c,d),f.stroke()},g.prototype.draw_arc=function(a,b,c,d,e,f,g,h){var i=this.c;i.lineWidth=this.line_width(g),i.beginPath();var j=Math.floor((a-this.origin_x)*this.scale),k=Math.floor((b-this.origin_y)*this.scale);1==(1&this.c.lineWidth)&&(j+=.5,k+=.5),i.arc(j,k,c*this.scale,d,e,f),h?i.fill():i.stroke()},g.prototype.draw_text=function(a,b,c,d){var e=this.c,f=d.match(/\d+/)[0];f=Math.max(2,Math.round(f*this.scale)),e.font=d.replace(/\d+/,f.toString());var g=Math.floor((b-this.origin_x)*this.scale),h=Math.floor((c-this.origin_y)*this.scale);e.fillText(a,g,h)},g.prototype.draw_text_important=function(a,b,c,d){this.draw_text(a,b,c,d)},g.prototype.event_coords=function(a){var b=$(this.canvas).offset();this.mouse_x=a.pageX-b.left,this.mouse_y=a.pageY-b.top,this.aspect_x=this.mouse_x/this.scale+this.origin_x,this.aspect_y=this.mouse_y/this.scale+this.origin_y,this.cursor_x=this.on_grid(this.aspect_x),this.cursor_y=this.on_grid(this.aspect_y)},g.prototype.key_down=function(a){var b=a.keyCode;if((a.ctrlKey||a.metaKey)&&65==b)this.aspect.map_over_components(function(a){a.set_select(!0)}),this.redraw_background();else if((a.ctrlKey||a.metaKey)&&67==b)l(this);else{if(this.aspect.read_only())return!0;if(8==b||46==b)this.aspect.start_action(),this.aspect.map_over_components(function(a){a.selected&&a.remove()}),this.aspect.end_action(),this.editor.diagram_changed(this),this.redraw_background();else if((a.ctrlKey||a.metaKey)&&67==b)l(this);else if((a.ctrlKey||a.metaKey)&&86==b)m(this);else if((a.ctrlKey||a.metaKey)&&88==b)k(this);else if((a.ctrlKey||a.metaKey)&&89==b)j(this);else{if(!a.ctrlKey&&!a.metaKey||90!=b)return!0;i(this)}}return a.preventDefault(),!1},g.prototype.pan_zoom=function(){var a,b,c=this.mouse_x,d=this.mouse_y,e=c-this.sctl_x,f=d-this.sctl_y,g=c-this.zctl_left,h=d-this.zctl_top;if(e*e+f*f<=this.sctl_r*this.sctl_r)Math.abs(f)>Math.abs(e)?(a=this.canvas.height/(8*this.scale),f>0&&(a=-a),b=this.origin_y-a,b>this.origin_min*this.grid&&b<this.origin_max*this.grid&&(this.origin_y=b)):(a=this.canvas.width/(8*this.scale),0>e&&(a=-a),b=this.origin_x+a,b>this.origin_min*this.grid&&b<this.origin_max*this.grid&&(this.origin_x=b));else{if(!(g>=0&&16>g&&h>=0&&48>h))return!1;16>h?this.zoomin():32>h?this.zoomout():this.zoomall()}return this.redraw_background(),!0},g.prototype.start_select=function(a){var b=-1,c=this;if(this.aspect.map_over_components(function(d,e){return d.select(c.aspect_x,c.aspect_y,a)?(d.selected&&(c.aspect.read_only()||(c.aspect.start_action(),c.drag_begin()),b=e),!0):!1}),!a){var d=-1!=b&&this.aspect.components[b].was_previously_selected;d||this.unselect_all(b),this.dragging||(this.select_rect=[this.mouse_x,this.mouse_y,this.mouse_x,this.mouse_y])}this.redraw_background()},g.prototype.mouse_move=function(){if(this.dragging){var a=this.cursor_x-this.drag_x,b=this.cursor_y-this.drag_y;(0!==a||0!==b)&&(this.drag_x=this.cursor_x,this.drag_y=this.cursor_y,this.aspect.map_over_components(function(c){c.selected&&c.move(a,b)}))}else this.select_rect&&(this.select_rect[2]=this.mouse_x,this.select_rect[3]=this.mouse_y);this.redraw()},g.prototype.mouse_up=function(a){if(this.dragging&&this.drag_end(),this.select_rect){var b=this.select_rect;if(b[0]!=b[2]||b[1]!=b[3]){var c=[b[0]/this.scale+this.origin_x,b[1]/this.scale+this.origin_y,b[2]/this.scale+this.origin_x,b[3]/this.scale+this.origin_y];jade.model.canonicalize(c),a||this.unselect_all(),this.aspect.map_over_components(function(b){b.select_rect(c,a)})}this.select_rect=void 0,this.redraw_background()}},g.prototype.message=function(a){var b=this.editor.status;b&&b.html(a)},g.prototype.clear_message=function(a){var b=this.editor.status;b&&b.text()==a&&b.text("")},g.prototype.dialog=function(a,b,c){var d=$(this.canvas).offset();d.top+=this.mouse_y,d.left+=this.mouse_x,s(a,b,c,d)},g.prototype.window=function(a,b,c){var d=$(this.canvas).offset();d.top+=this.mouse_y+(c||0),d.left+=this.mouse_x+(c||0),x(a,b,d)};var I=[];return C.prototype.add_tool=function(a,b,c,d,e){var f;return-1!=b.search("data:image")?(f=$('<img draggable="false"></img>'),f.attr("src",b)):f=$("<span>"+b+"</span>"),f.addClass("jade-tool jade-tool-disabled"),f[0].enabled=!1,f.mouseover(D).mouseout(E).click(F),f[0].diagram=this.diagram,f[0].tip=c,f[0].callback=d,f[0].enable_check=e,this.tools[a]=f,this.toolbar.append(f),f},C.prototype.add_spacer=function(){this.toolbar.append('<div class="jade-tool-spacer"></div>')},C.prototype.enable_tools=function(a){for(var b in this.tools){var c=this.tools[b],d=c[0].enable_check?c[0].enable_check(a):!0;d!=c[0].enabled&&(c[0].enabled=d,c.toggleClass("jade-tool-disabled",!d),c.toggleClass("jade-tool-enabled",d))}},{Diagram:g,diagram_undo:i,diagram_redo:j,diagram_cut:k,diagram_copy:l,diagram_paste:m,diagram_fliph:n,diagram_flipv:o,diagram_rotcw:p,diagram_rotccw:q,Toolbar:C,Jade:a,jade_settings:b,editors:G,clipboards:H,build_table:t,build_button:u,build_input:v,build_select:w,progress_report:r,dialog:s,window:x,window_close:z}}();jade.model=function(){function b(a,b){this.name=a,this.modules={},this.modified=!1,this.read_only=!1,this.loading=!1,this.nchanges=0,r[a]=this,b&&this.load(b)}function c(){for(var a in r)r[a].save()}function d(a,c){var d=r[a];return d||(d=new b(a),c&&(d.read_only=!0),jade.load_from_server(d)),d}function e(a){var b,c,e=a.split(":");if(1==e.length)b="user",c=e[0];else{if(2!=e.length)return void 0;b=e[0],c=e[1]}return b in r||d(b),r[b].module(c)}function f(a,b,c){this.library=b,this.name=a,this.aspects={},this.properties={},this.modified=!1,this.loaded=!1,this.listeners=[],c&&this.load(c)}function g(a,b,c){this.module=b,this.name=a,this.components=[],this.modified=!1,this.connection_points={},this.actions=[],this.current_action=-1,this.change_list=void 0,c&&this.load(c)}function h(a){var b;a[0]>a[2]&&(b=a[0],a[0]=a[2],a[2]=b),a[1]>a[3]&&(b=a[1],a[1]=a[3],a[3]=b)}function i(a,b,c){return a>=b&&c>=a}function j(a,b){var c=!(b[0]>a[2]||b[2]<a[0]||b[1]>a[3]||b[3]<a[1]);return c}function k(a,b,c){return 0===a||6==a?b:1==a||5==a?-c:2==a||4==a?-b:c}function l(a,b,c){return 1==a||7==a?b:2==a||6==a?-c:3==a||5==a?-b:c}function n(a){var b=u[a[0]];return b?new b(a):new o(a)}function o(a){this.aspect=void 0,this.module=void 0,this.icon=void 0,this.coords=[0,0,0],this.properties={},this.selected=!1,this.bounding_box=[0,0,0,0],this.bbox=this.bounding_box,this.connections=[],a&&this.load(a)}function p(a,b,c,d){this.parent=a,this.offset_x=b,this.offset_y=c,this.name=d,this.nlist=jade.utils.parse_signal(d),this.location="",this.update_location(),this.label=void 0}function q(a,b,c){var d=a.x*(b.y-c.y)+b.x*(c.y-a.y)+c.x*(a.y-b.y);return 0===d}var r={},s=25;b.prototype.load=function(a){this.loading=!0;for(var b in a)this.module(b).load(a[b]);this.loading=!1},b.prototype.module=function(a,b){var c=this.modules[a];return void 0===c&&(c=new f(a,this,b),this.modules[a]=c,this.set_modified()),c},b.prototype.remove_module=function(a){a in this.modules&&(delete this.modules[a],this.set_modified())},b.prototype.json=function(){var a={};for(var b in this.modules){var c=this.modules[b].json();c&&(a[b]=c)}return a},b.prototype.clear_modified=function(){for(m in this.modules)this.modules[m].clear_modified();this.modified=!1,this.nchanges=0;var a=!1;$.each(r,function(b,c){c.modified&&(a=!0)}),a||$("body").removeAttr("data-dirty")},b.prototype.set_modified=function(){this.loading||(this.modified||(this.modified=!0,$("body").attr("data-dirty","yes")),this.nchanges+=1,this.nchanges>=s&&jade.save_to_server(this))},b.prototype.save=function(){!this.read_only&&this.modified&&jade.save_to_server(this)},f.prototype.get_name=function(){return this.library.name+":"+this.name},f.prototype.read_only=function(){return"true"==this.properties.readonly?!0:this.library.read_only},f.prototype.add_listener=function(a){this.loaded?a("load"):this.listeners.push(a)},f.prototype.set_modified=function(){this.modified=!0,this.library.set_modified()},f.prototype.clear_modified=function(){for(a in this.aspects)this.aspects[a].clear_modified()},f.prototype.set_property=function(a,b){b!=this.properties[a]&&(this.properties[a]=b,this.set_modified())},f.prototype.set_property_attribute=function(a,b,c){var d=this.properties[a];c!=d[b]&&(d[b]=c,this.set_modified())},f.prototype.remove_property=function(a){a in this.properties&&(delete this.properties[a],this.set_modified())},f.prototype.load=function(a){for(var b in a)"properties"==b?this.properties=a[b]:this.aspects[b]=new g(b,this,a[b]);this.clear_modified(),this.loaded=!0;for(var c=this.listeners.length-1;c>=0;c-=1)this.listeners[c]("load")},f.prototype.has_aspect=function(a){return a in this.aspects?!this.aspects[a].empty():!1},f.prototype.aspect=function(a){var b=this.aspects[a];return void 0===b&&(b=new g(a,this),this.aspects[a]=b),b},f.prototype.json=function(){var a={properties:this.properties};for(var b in this.aspects){var c=this.aspects[b].json();c.length>0&&(a[b]=c)}return a},g.prototype.load=function(a){this.components=[];for(var b=0;b<a.length;b+=1){var c=n(a[b]);c.add(this)}this.clear_modified()},g.prototype.set_modified=function(){this.modified=!0,this.module&&this.module.set_modified()},g.prototype.clear_modified=function(){this.modified=!1},g.prototype.json=function(){for(var a=[],b=0;b<this.components.length;b+=1)a.push(this.components[b].json());return a},g.prototype.read_only=function(){return this.module?"true"==this.module.properties[this.name+"-readonly"]?!0:this.module.read_only():!1},g.prototype.empty=function(){return 0===this.components.length},g.prototype.start_action=function(){this.change_list=[]},g.prototype.end_action=function(){void 0!==this.change_list&&this.change_list.length>0&&(this.clean_up_wires(!0),this.current_action+=1,this.actions.length>this.current_action&&(this.actions=this.actions.slice(0,this.current_action)),this.actions.push(this.change_list),this.set_modified()),this.change_list=void 0},g.prototype.add_change=function(a){void 0!==this.change_list&&this.change_list.push(a)},g.prototype.can_undo=function(){return this.current_action>=0},g.prototype.undo=function(){if(this.current_action>=0){var a=this.actions[this.current_action];this.current_action-=1;for(var b=a.length-1;b>=0;b-=1)a[b](this,"undo");this.clean_up_wires(!1),this.set_modified()}},g.prototype.can_redo=function(){return this.current_action+1<this.actions.length},g.prototype.redo=function(){if(this.current_action+1<this.actions.length){this.current_action+=1;for(var a=this.actions[this.current_action],b=0;b<a.length;b+=1)a[b](this,"redo");this.clean_up_wires(!1),this.set_modified()}},g.prototype.add_component=function(a){this.components.push(a)},g.prototype.remove_component=function(a){var b=this.components.indexOf(a);-1!=b&&this.components.splice(b,1)},g.prototype.map_over_components=function(a){for(var b=this.components.length-1;b>=0;b-=1)if(a(this.components[b],b))return},g.prototype.selections=function(){for(var a=this.components.length-1;a>=0;a-=1)if(this.components[a].selected)return!0;return!1},g.prototype.selected_component=function(){for(var a,b=this.components.length-1;b>=0;b-=1)if(this.components[b].selected){if(void 0!==a)return void 0;a=this.components[b]}return a},g.prototype.find_connections=function(a){return this.connection_points[a.location]},g.prototype.add_connection_point=function(a){var b=this.connection_points[a.location];return b?b.push(a):(b=[a],this.connection_points[a.location]=b),b},g.prototype.remove_connection_point=function(a,b){var c=this.connection_points[b];if(c){var d=c.indexOf(a);-1!=d&&(c.splice(d,1),0===c.length&&delete this.connection_points[b])}},g.prototype.update_connection_point=function(a,b){return this.remove_connection_point(a,b),this.add_connection_point(a)
},g.prototype.add_wire=function(a,b,c,d,e){var f=n(["wire",[a,b,e,c-a,d-b]]);return f.add(this),f},g.prototype.split_wire=function(a,b){a.remove(),this.add_wire(a.coords[0],a.coords[1],b.x,b.y,0);var c=a.far_end();this.add_wire(c[0],c[1],b.x,b.y,0)},g.prototype.check_wires=function(a){for(var b=0;b<this.components.length;b+=1){var c=this.components[b];if(c!=a){var d=c.bisect(a);d&&this.split_wire(c,d)}}},g.prototype.check_connection_points=function(a){for(var b in this.connection_points){var c=this.connection_points[b];if(c&&a.bisect_cp(c[0]))return void this.split_wire(a,c[0])}},g.prototype.clean_up_wires=function(){for(var a in this.connection_points){var b=this.connection_points[a];if(b&&2==b.length){var c=b[0].parent,d=b[1].parent;if("wire"==c.type()&&"wire"==d.type()){var e=c.other_end(b[0]),f=d.other_end(b[1]),g=b[0];q(e,f,g)&&(c.remove(),d.remove(),this.add_wire(e.x,e.y,f.x,f.y,0))}}}for(;this.remove_redundant_wires(););},g.prototype.remove_redundant_wires=function(){for(var a in this.connection_points)for(var b=this.connection_points[a],c=0;c<b.length;c+=1){var d=b[c],e=d.parent;if("wire"==e.type())for(var f=e.other_end(d),g=c+1;g<b.length;g+=1){var h=b[g].parent;if("wire"==h.type()&&h.other_end(d).coincident(f.x,f.y))return o.prototype.remove.call(h),!0}}return!1},g.prototype.selections=function(){for(var a=!1,b=this.components.length-1;b>=0;b-=1)this.components[b].selected&&(a=!0);return a},g.prototype.compute_bbox=function(a,b,c){if(0==this.components.length)return[-16,-16,16,16];for(var d=void 0===a?1/0:a[0],e=void 0===a?-1/0:a[2],f=void 0===a?1/0:a[1],g=void 0===a?-1/0:a[3],h=this.components.length-1;h>=0;h-=1){var i=this.components[h];(!b||i.selected)&&(c&&i.selected||"property"!=i.type()&&(d=Math.min(i.bbox[0],d),e=Math.max(i.bbox[2],e),f=Math.min(i.bbox[1],f),g=Math.max(i.bbox[3],g)))}return[d,f,e,g]},g.prototype.unselected_bbox=function(a){return this.compute_bbox(a,!1,!0)},g.prototype.selected_bbox=function(a){return this.compute_bbox(a,!0,!1)},g.prototype.selected_grid=function(){for(var a=1,b=this.components.length-1;b>=0;b-=1){var c=this.components[b];c.selected&&(a=Math.max(a,c.required_grid))}return a};var t=[0,1,2,3,4,5,6,7,1,2,3,0,7,4,5,6,2,3,0,1,6,7,4,5,3,0,1,2,5,6,7,4,4,5,6,7,0,1,2,3,5,6,7,4,3,0,1,2,6,7,4,5,2,3,0,1,7,4,5,6,1,2,3,0],u={};o.prototype.required_grid=8,o.prototype.type=function(){return this.module.get_name()},o.prototype.clone_properties=function(a){var b={};for(var c in this.properties){var d=this.properties[c];void 0===d||""===d||!this.module.properties[c]||a&&d==this.module.properties[c].value||(b[c]=d)}return b},o.prototype.load=function(a){this.module=e(a[0]),this.coords=a[1],this.properties=a[2]||{};var b=this;this.module.add_listener(function(){o.prototype.compute_bbox.call(b)})},o.prototype.default_properties=function(){for(var a in this.module.properties)a in this.properties||(this.properties[a]=this.module.properties[a].value||"")},o.prototype.compute_bbox=function(){if(this.default_properties(),this.name=this.properties.name,this.icon=this.module.aspect("icon"),void 0!==this.icon){var a=this;this.icon.map_over_components(function(b){var c=b.terminal_coords();c&&a.add_connection(c[0],c[1],c[2])}),this.bounding_box=this.icon.compute_bbox(),this.update_coords()}},o.prototype.terminal_coords=function(){return void 0},o.prototype.json=function(){var a=this.clone_properties(!0);return Object.keys(a).length>0?[this.type(),this.coords.slice(0),a]:[this.type(),this.coords.slice(0)]},o.prototype.clone=function(a,b){var c=n(this.json());return c.coords[0]=a,c.coords[1]=b,c},o.prototype.has_aspect=function(a){return void 0!==this.module?this.module.has_aspect(a):!1},o.prototype.set_select=function(a){this.selected=a},o.prototype.add_connection=function(a,b,c){this.connections.push(new p(this,a,b,c))},o.prototype.update_coords=function(){var a=this.coords[0],b=this.coords[1],c=this.bounding_box;this.bbox[0]=this.transform_x(c[0],c[1])+a,this.bbox[1]=this.transform_y(c[0],c[1])+b,this.bbox[2]=this.transform_x(c[2],c[3])+a,this.bbox[3]=this.transform_y(c[2],c[3])+b,h(this.bbox);for(var d=this.connections.length-1;d>=0;d-=1)this.connections[d].update_location()},o.prototype.inside=function(a,b,c){return void 0===c&&(c=this.bbox),i(a,c[0],c[2])&&i(b,c[1],c[3])},o.prototype.rotate=function(a,b,c){var d=this.coords[0],e=this.coords[1],f=this.coords[2],g=d-b,h=e-c,i=k(a,g,h)+b,j=l(a,g,h)+c,m=t[8*f+a];this.coords[0]=i,this.coords[1]=j,this.coords[2]=m,this.update_coords();var n=this;this.aspect.add_change(function(a,b){"undo"==b?(n.coords[0]=d,n.coords[1]=e,n.coords[2]=f):(n.coords[0]=i,n.coords[1]=j,n.coords[2]=m),n.update_coords()})},o.prototype.move_begin=function(){this.move_x=this.coords[0],this.move_y=this.coords[1],this.move_rotation=this.coords[2]},o.prototype.move=function(a,b){this.coords[0]+=a,this.coords[1]+=b,this.update_coords()},o.prototype.move_end=function(){var a=this.coords[0]-this.move_x,b=this.coords[1]-this.move_y;if(0!==a||0!==b||this.coords[2]!=this.move_rotation){var c=this;this.aspect.add_change(function(d,e){"undo"==e?c.move(-a,-b):c.move(a,b),c.aspect.check_wires(c)}),this.aspect.check_wires(this)}},o.prototype.add=function(a){this.aspect=a,a.add_component(this),this.update_coords();var b=this;a.add_change(function(a,c){"undo"==c?b.remove():b.add(a)})},o.prototype.remove=function(){for(var a=this.connections.length-1;a>=0;a-=1){var b=this.connections[a];this.aspect.remove_connection_point(b,b.location)}this.aspect.remove_component(this);var c=this;this.aspect.add_change(function(a,b){"undo"==b?c.add(a):c.remove()})},o.prototype.transform_x=function(a,b){return k(this.coords[2],a,b)},o.prototype.transform_y=function(a,b){return l(this.coords[2],a,b)},o.prototype.moveTo=function(a,b,c){var d=this.transform_x(b,c)+this.coords[0],e=this.transform_y(b,c)+this.coords[1];a.moveTo(d,e)},o.prototype.lineTo=function(a,b,c){var d=this.transform_x(b,c)+this.coords[0],e=this.transform_y(b,c)+this.coords[1];a.lineTo(d,e)};var v={red:"rgb(255,64,64)",green:"rgb(64,255,64)",blue:"rgb(64,64,255)",cyan:"rgb(64,255,255)",magenta:"rgb(255,64,255)",yellow:"rgb(255,255,64)",black:"rgb(0,0,0)"};o.prototype.draw_line=function(a,b,c,d,e,f){a.c.strokeStyle=this.selected?a.selected_style:"wire"==this.type()?a.normal_style:v[this.properties.color]||(a.show_grid?a.component_style:a.normal_style);var g=this.transform_x(b,c)+this.coords[0],h=this.transform_y(b,c)+this.coords[1],i=this.transform_x(d,e)+this.coords[0],j=this.transform_y(d,e)+this.coords[1];a.draw_line(g,h,i,j,f||1)},o.prototype.draw_circle=function(a,b,c,d,e){e?a.c.fillStyle=this.selected?a.selected_style:a.normal_style:a.c.strokeStyle=this.selected?a.selected_style:"wire"==this.type()?a.normal_style:v[this.properties.color]||(a.show_grid?a.component_style:a.normal_style);var f=this.transform_x(b,c)+this.coords[0],g=this.transform_y(b,c)+this.coords[1];a.draw_arc(f,g,d,0,2*Math.PI,!1,1,e)},o.prototype.draw_arc=function(a,b,c,d,e,f,g){a.c.strokeStyle=this.selected?a.selected_style:"wire"==this.type()?a.normal_style:v[this.properties.color]||(a.show_grid?a.component_style:a.normal_style);var h=this.transform_x(b,c)+this.coords[0],i=this.transform_y(b,c)+this.coords[1],j=this.transform_x(d,e)+this.coords[0]-h,k=this.transform_y(d,e)+this.coords[1]-i,l=this.transform_x(f,g)+this.coords[0]-h,m=this.transform_y(f,g)+this.coords[1]-i,n=2*(j*m-k*l);if(0===n)return void a.draw_line(h,i,j+h,k+i,1);var o=j*j+k*k,p=l*l+m*m,q=(m*o-k*p)/n,r=(j*p-l*o)/n,s=Math.sqrt((j-q)*(j-q)+(k-r)*(k-r)),t=2*Math.PI-Math.atan2(-(0-r),0-q),u=2*Math.PI-Math.atan2(-(k-r),j-q),w=2*Math.PI-Math.atan2(-(m-r),l-q),x=u-t;0>x&&(x+=2*Math.PI);var y=w-t;0>y&&(y+=2*Math.PI);var z=y>x;a.draw_arc(q+h,r+i,s,t,u,z,1,!1)};var w=[0,1,2,3,4,5,6,7,8,2,5,8,1,4,7,0,3,6,8,7,6,5,4,3,2,1,0,6,3,0,7,4,1,8,5,3,2,1,0,5,4,3,8,7,6,8,5,2,7,4,1,6,3,0,6,7,8,3,4,5,0,1,2,0,3,6,1,4,7,2,5,8],x=["left","center","right","left","center","right","left","center","right"],y=["top","top","top","middle","middle","middle","bottom","bottom","bottom"];o.prototype.draw_text=function(a,b,c,d,e,f,g){var h=w[9*this.coords[2]+e];a.c.textAlign=x[h],a.c.textBaseline=y[h],a.c.fillStyle=void 0===g?this.selected?a.selected_style:v[this.properties.color]||(a.show_grid?a.component_style:a.normal_style):g,a.draw_text(b,this.transform_x(c,d)+this.coords[0],this.transform_y(c,d)+this.coords[1],f)},o.prototype.draw_text_important=function(a,b,c,d,e,f,g){var h=w[9*this.coords[2]+e];a.c.textAlign=x[h],a.c.textBaseline=y[h],a.c.fillStyle=void 0===g?this.selected?a.selected_style:a.normal_style:g,a.draw_text_important(b,this.transform_x(c,d)+this.coords[0],this.transform_y(c,d)+this.coords[1],f)},o.prototype.draw=function(a){if(void 0===this.icon&&this.compute_bbox(),this.icon&&!this.icon.empty()){var b=this;this.icon.map_over_components(function(c){c.draw_icon(b,a)})}else{var c=this.type().split(":");this.draw_text_important(a,c[0]+":",0,0,7,a.annotation_font),this.draw_text_important(a,c[1],0,0,1,a.annotation_font),this.draw_line(a,-16,-16,16,-16,1),this.draw_line(a,16,-16,16,16,1),this.draw_line(a,16,16,-16,16,1),this.draw_line(a,-16,16,-16,-16,1)}},o.prototype.near=function(a,b){return this.inside(a,b)},o.prototype.select=function(a,b,c){return this.was_previously_selected=this.selected,this.near(a,b)?(this.set_select(c?!this.selected:!0),!0):!1},o.prototype.select_rect=function(a){j(this.bbox,a)&&this.set_select(!0)},o.prototype.bisect=function(){},o.prototype.clear_labels=function(){for(var a=this.connections.length-1;a>=0;a-=1)this.connections[a].clear_label()},o.prototype.update_properties=function(a){if(void 0!==a){var b=this.clone_properties(!1);this.properties=a;var c=this;this.aspect.add_change(function(d,e){c.properties="undo"==e?b:a})}},o.prototype.edit_properties=function(a,b,c,d){if(this.near(b,c)&&Object.keys(this.properties).length>0){var e={};for(var f in this.properties){var g=this.module.properties[f];if("no"!=g.edit){var h,i=g.label||f;if("menu"==g.type)h=jade.build_select(g.choices,this.properties[f]);else{var j=this.properties[f];h=jade.build_input("text",Math.max(10,(void 0===j?1:j.length)+5),this.properties[f])}h.prop_name=f,e[i]=h}}var k=jade.build_table(e),l=this;return a.dialog("Edit Properties",k,function(){var b={};for(var c in e){var f=e[c].value;""===f&&(f=void 0),b[e[c].prop_name]=f}l.name=b.name,a.aspect.start_action(),l.update_properties(b),a.aspect.end_action(),d&&d(l),a.redraw_background()}),!0}return!1};var z=2;return p.prototype.clear_label=function(){this.label=void 0},p.prototype.nconnections=function(){var a=this.parent.aspect.connection_points[this.location];return a.length},p.prototype.update_location=function(){var a=this.location,b=this.parent,c=b.transform_x(this.offset_x,this.offset_y)+b.coords[0],d=b.transform_y(this.offset_x,this.offset_y)+b.coords[1];this.x=c,this.y=d,this.location=c+","+d,this.parent.aspect&&this.parent.aspect.update_connection_point(this,a)},p.prototype.coincident=function(a,b){return this.x==a&&this.y==b},p.prototype.draw=function(a,b){2!=b&&this.parent.draw_circle(a,this.offset_x,this.offset_y,z,b>2)},p.prototype.draw_x=function(a){this.parent.draw_line(a,this.offset_x-2,this.offset_y-2,this.offset_x+2,this.offset_y+2,a.grid_style),this.parent.draw_line(a,this.offset_x+2,this.offset_y-2,this.offset_x-2,this.offset_y+2,a.grid_style)},{libraries:r,find_module:e,Library:b,load_library:d,save_libraries:c,Aspect:g,Component:o,make_component:n,built_in_components:u,canonicalize:h,aOrient:w,ConnectionPoint:p,connection_point_radius:z}}(),jade.model.Aspect.prototype.netlist=function(a,b,c,d){var e=this.module.get_name();if(-1!=d.indexOf(e))throw d.push(e),"Recursive inclusion of module:\n"+d.join(" \u2192 ");d.push(e),this.label_connection_points(b,c),this.ensure_component_names(b);for(var f=[],g=0;g<this.components.length;g+=1){var e=this.components[g].netlist(a,b,d);void 0!==e&&f.push.apply(f,e)}return d.pop(),f},jade.model.Aspect.prototype.label_connection_points=function(a,b){var c;for(c=this.components.length-1;c>=0;c-=1)this.components[c].clear_labels();for(c=this.components.length-1;c>=0;c-=1)this.components[c].add_default_labels(a,b);for(this.next_label=0,c=this.components.length-1;c>=0;c-=1)this.components[c].label_connections(a)},jade.model.Aspect.prototype.get_next_label=function(a){return this.next_label+=1,a+this.next_label.toString()},jade.model.Aspect.prototype.propagate_label=function(a,b){for(var c=this.connection_points[b],d=c.length-1;d>=0;d-=1)c[d].propagate_label(a)},jade.model.Aspect.prototype.ensure_component_names=function(a){var b,c,d,e={};for(b=0;b<this.components.length;b+=1)if(c=this.components[b],d=c.name){if(d in e)throw"Duplicate component name: "+a+d;e[d]=c}for(b=0;b<this.components.length;b+=1)if(c=this.components[b],void 0!==c.module.name&&(d=c.name,""===d||void 0===d)){for(var f=1;;){if(d=c.module.name.toUpperCase()+"_"+f.toString(),!(d in e))break;f+=1}c.name=d,e[d]=c}},jade.model.Component.prototype.clear_labels=function(){for(var a=this.connections.length-1;a>=0;a-=1)this.connections[a].clear_label()},jade.model.Component.prototype.propagate_label=function(){},jade.model.Component.prototype.label_connections=function(a){for(var b=this.connections.length-1;b>=0;b-=1){var c=this.connections[b];if(!c.label){for(var d=c.nlist.length,e=[],f=0;d>f;f+=1)e.push(this.aspect.get_next_label(a));c.propagate_label(e)}}},jade.model.Component.prototype.add_default_labels=function(a,b){var c,d;if(this.properties.global_signal)c=jade.utils.parse_signal(this.properties.global_signal);else if(c=jade.utils.parse_signal(this.properties.signal),c.length>0)for(d=0;d<c.length;d+=1){var e=c[d];c[d]=e in b?b[e]:a+e}if(c.length>0)for(d=0;d<this.connections.length;d+=1)this.connections[d].propagate_label(c)},jade.model.Component.prototype.netlist=function(a,b,c){var d,e=[],f=1;for(d=0;d<this.connections.length;d+=1){var g=this.connections[d],h=g.label.length,i=g.nlist.length;if(h%i!==0)throw"Number of connections for terminal "+g.name+"of "+this.prefix+this.properties.name+" not a multiple of "+i.toString();f=Math.max(f,h/i),e.push([g.nlist,g.label])}for(d=0;d<this.connections.length;d+=1){var g=this.connections[d],j=g.label.length;if(f%j!==0)throw"Number of connections for terminal "+g.name+"of "+this.prefix+this.properties.name+" not a multiple of "+f.toString()}var k=[];for(d=0;f>d;d+=1){for(var l={},m=0;m<e.length;m+=1)for(var n=e[m][0],o=e[m][1],p=d*n.length,q=0;q<n.length;q+=1)l[n[q]]=o[(p+q)%o.length];if(-1==a.indexOf(this.type())){if(!this.has_aspect("schematic"))throw"No schematic for "+b+this.properties.name+" an instance of "+this.type();var r=this.module.aspect("schematic"),s=b+this.name;f>1&&(s+="["+d.toString()+"]"),s+=".";var t=r.netlist(a,s,l,c);k.push.apply(k,t)}else{var u=this.clone_properties(!1);u.name=b+this.name,f>1&&(u.name+="["+d.toString()+"]"),k.push([this.type(),l,u])}}return k},jade.model.ConnectionPoint.prototype.propagate_label=function(a){if(void 0===this.label)this.label=a,this.parent.aspect.propagate_label(a,this.location),this.parent.propagate_label(a);else if(!jade.utils.signal_equals(this.label,a))throw"Node has two conflicting sets of labels: ["+this.label+"], ["+a+"]"},jade.netlist={},jade.netlist.extract_nodes=function(a){var b={};return $.each(a,function(a,c){if("ground"!=c.type)for(var d in c.connections)b[c.connections[d]]=null;else b[c.connections[0]]=null}),Object.keys(b)},jade.netlist.print_netlist=function(a){if(a.length>0){var b=[];$.each(a,function(a,c){b.push(c.type+" ("+c.properties.name+"): "+JSON.stringify(c.connections)+" "+JSON.stringify(c.properties))}),console.log(b.join("\n")),console.log(b.length.toString()+" devices")}},jade.netlistparse_source=function(a){var b=a.match(/(\w+)\s*\((.*?)\)\s*/),c=$.map(b[2].split(","),jade.utils.parse_number);return{type:b[1],args:c}},jade.icons={},jade.icons.actions_icon='<span class="fa fa-file-o"></span>',jade.icons.close_icon='<span class="fa fa-times fa-inverse"></span>',jade.icons.resize_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 10 13.5 l 3 -3 m 0 -3 l -6 6 m -3 0 l 9 -9" stroke="black" stroke-width="0.5"/></svg>',jade.icons.undo_icon='<span class="fa fw fa-reply"></span>',jade.icons.redo_icon='<span class="fa fw fa-share"></span>',jade.icons.cut_icon='<span class="fa fw fa-cut"></span>',jade.icons.copy_icon='<span class="fa fw fa-copy"></span>',jade.icons.paste_icon='<span class="fa fw fa-paste"></span>',jade.icons.fliph_icon='<span class="fa fw fa-arrows-h"></span>',jade.icons.flipv_icon='<span class="fa fw fa-arrows-v"></span>',jade.icons.rotcw_icon='<span class="fa fw fa-rotate-right"></span>',jade.icons.rotccw_icon='<span class="fa fw fa-rotate-left"></span>',jade.icons.up_icon='<span class="fa fw fa-level-up"></span>',jade.icons.down_icon='<span class="fa fw fa-level-down"></span>',jade.icons.ground_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 8.5 3.5 v 7 h -5 l 5 5 l 5 -5 h -5" stroke="black" fill="transparent"/></svg>',jade.icons.vdd_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 8.5 5.5 v 8 M 3.5 5.5 h 10" stroke="black" fill="transparent"/></svg>',jade.icons.port_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 1.5 6.5 h 7 l 4 4 l -4 4 h -7 v -8 m 11 4 h 5" stroke="black" fill="transparent"/></svg>',jade.icons.jumper_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 4 12 C 4 6, 12 6, 12 12" stroke="black" fill="transparent"/><circle cx="4" cy="12" r="1" stroke="black"/><circle cx="12" cy="12" r="1" stroke="black"/></svg>',jade.icons.text_icon='<span class="fa fw fa-font"></span>',jade.icons.check_icon='<span class="fa fw fa-check" style="color:green;"></span>',jade.icons.select_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 3.5 3.5 v 9 l 2 -2 l 2 5 l 3 -2 l -2 -4 l 2.5 -0.5 L 3.5 3.5" fill="black"/></svg>',jade.icons.line_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 3.5 5.5 l 10 10" stroke="black" fill="transparent"/></svg>',jade.icons.arc_icon='<svg width="16" height="16" viewBox="0 0 16 16"><path d="M 3.5 5.5 c 8 0, 10 8, 10 10" stroke="black" fill="transparent"/></svg>',jade.icons.circle_icon='<svg width="16" height="16" viewBox="0 0 16 16"><circle cx="8" cy="10" r="5" stroke="black" fill="transparent"/></svg>',jade.icons.property_icon="{P}",jade.icons.terminal_icon='<svg width="16" height="16" viewBox="0 0 16 16"><circle cx="5" cy="10" r="3" stroke="black" fill="transparent"/><path d="M 5 10 h 8" stroke="black" fill="transparent"/></svg>',jade.schematic_view=function(){function a(l,m){function n(a){return a.aspect&&!a.aspect.read_only()&&a.aspect.selections()}function o(){return this.diagram&&this.diagram.aspect&&!this.diagram.aspect.read_only()}this.jade=m,this.status=m.status,this.diagram=new jade.Diagram(this,"jade-schematic-diagram"),l.diagram=this.diagram,this.diagram.wire=void 0,this.diagram.new_part=void 0,this.diagram.grid=8,this.diagram.zoom_factor=1.25,this.diagram.zoom_min=Math.pow(this.diagram.zoom_factor,-3),this.diagram.zoom_max=Math.pow(this.diagram.zoom_factor,5),this.diagram.origin_min=-200,this.diagram.origin_max=200,this.hierarchy_stack=[],$(this.diagram.canvas).mousemove(i).mouseover(f).mouseout(g).mouseup(j).mousedown(h).dblclick(k).keydown(e),this.toolbar=new jade.Toolbar(this.diagram),this.toolbar.add_tool("actions",jade.icons.actions_icon,"Edit/copy/delete modules; change settings",jade.jade_settings),this.toolbar.add_spacer(),this.toolbar.add_tool("undo",jade.icons.undo_icon,"Undo: undo effect of previous action",jade.diagram_undo,function(a){return a.aspect&&a.aspect.can_undo()}),this.toolbar.add_tool("redo",jade.icons.redo_icon,"redo: redo effect of next action",jade.diagram_redo,function(a){return a.aspect&&a.aspect.can_redo()}),this.toolbar.add_tool("cut",jade.icons.cut_icon,"Cut: move selected components from diagram to the clipboard",jade.diagram_cut,n),this.toolbar.add_tool("copy",jade.icons.copy_icon,"Copy: copy selected components into the clipboard",jade.diagram_copy,n),this.toolbar.add_tool("paste",jade.icons.paste_icon,"Paste: copy clipboard into the diagram",jade.diagram_paste,function(a){return a.aspect&&!a.aspect.read_only()&&jade.clipboards[a.editor.editor_name].length>0}),this.toolbar.add_tool("fliph",jade.icons.fliph_icon,"Flip Horizontally: flip selection horizontally",jade.diagram_fliph,n),this.toolbar.add_tool("flipv",jade.icons.flipv_icon,"Flip Vertically: flip selection vertically",jade.diagram_flipv,n),this.toolbar.add_tool("rotcw",jade.icons.rotcw_icon,"Rotate Clockwise: rotate selection clockwise",jade.diagram_rotcw,n),this.toolbar.add_tool("rotccw",jade.icons.rotccw_icon,"Rotate Counterclockwise: rotate selection counterclockwise",jade.diagram_rotccw,n),this.toolbar.add_spacer(),this.hierarchy=m.configuration.hierarchical,this.hierarchy&&(this.toolbar.add_tool("down",jade.icons.down_icon,"Down in the hierarchy: view selected included module",c,function(b){if(!b.aspect)return!1;var c=b.aspect.selected_component();return void 0!==c?c.has_aspect(a.prototype.editor_name):!1}),this.toolbar.add_tool("up",jade.icons.up_icon,"Up in the hierarchy: return to including module",d,function(a){return a.editor&&a.editor.hierarchy_stack.length>0}),this.toolbar.add_spacer());var p=this.toolbar.add_tool("ground",jade.icons.ground_icon,"Ground connection: click and drag to insert",null,o);b(p,this,"ground"),p=this.toolbar.add_tool("vdd",jade.icons.vdd_icon,"Power supply connection: click and drag to insert",null,o),b(p,this,"vdd"),p=this.toolbar.add_tool("port",jade.icons.port_icon,"I/O Port: click and drag to insert",null,o),b(p,this,"port"),p=this.toolbar.add_tool("jumper",jade.icons.jumper_icon,"Jumper for connecting wires with different names: click and drag to insert",null,o),b(p,this,"jumper"),p=this.toolbar.add_tool("text",jade.icons.text_icon,"Text: click and drag to insert",null,o),b(p,this,"text"),this.toolbar.add_spacer();var q=m.configuration.tools;void 0!==q&&(q=q.split(","));for(var r=0;r<z.length;r+=1){var t=z[r];(void 0===q||-1!=$.inArray(t[0],q))&&this.toolbar.add_tool(t[0],t[1],t[2],t[3],t[4])}l.appendChild(this.toolbar.toolbar[0]),l.appendChild(this.diagram.canvas);var u=new jade.model.Aspect("untitled",null);this.diagram.set_aspect(u),this.parts_bin=new s(this,m.configuration.parts),l.appendChild(this.parts_bin.top_level),this.resizer=$('<div class="jade-xparts-resize"></div>');var v,w,x=this;this.resizer.on("mousedown",function(a){function b(a){var b,c=window.event||a,d=c.pageX-v,e=$(x.parts_bin.top_level),f=$(x.diagram.canvas);return d>=0?(b=e.width()-d,75>b&&(d-=75-b)):(b=f.width()+d,300>b&&(d+=300-b)),e.width(e.width()-d),f.width(f.width()+d),f[0].diagram.resize(),v=c.pageX,w=c.pageY,!1}function c(){var a=$(document).get(0);return a.removeEventListener("mousemove",b,!0),a.removeEventListener("mouseup",c,!0),!1}return v=a.pageX,w=a.pageY,$(document).get(0).addEventListener("mousemove",b,!0),$(document).get(0).addEventListener("mouseup",c,!0),!1}),l.appendChild(this.resizer[0])}function b(a,b,c){a.off("click");var d=new t(b);d.set_component(jade.model.make_component([c,[0,0,0],{}])),a.mousedown(function(){b.diagram.new_part=d}),a.mouseup(function(){b.diagram.new_part=void 0})}function c(b){var c=b.aspect.selected_component();if(void 0!==c&&c.has_aspect(a.prototype.editor_name)){var d=b.editor;d.hierarchy_stack.push(b.aspect.module),d.jade.edit(c.module)}}function d(a){var b=a.editor;b.hierarchy_stack.length>0&&b.jade.edit(b.hierarchy_stack.pop())}function e(a){var b=a.target.diagram,e=a.keyCode;if(38==e)d(b);else if(40==e)c(b);else if(b.key_down(a))return!0;return a.preventDefault(),!1}function f(a){var b=a.target.diagram;if(!b.aspect.read_only()&&b.new_part){var c=b.new_part;b.new_part=void 0,c.select(!1),b.unselect_all(-1),b.redraw_background(),b.aspect.start_action(),b.set_cursor_grid(c.component.required_grid),b.event_coords(a),c=c.component.clone(b.cursor_x,b.cursor_y),c.add(b.aspect),c.set_select(!0),b.drag_begin()}return b.redraw(),b.canvas.focus(),!1}function g(a){var b=a.target.diagram;return b.redraw(),!1}function h(a){var b=a.target.diagram;if(b.event_coords(a),b.pan_zoom())return!1;var c=Math.abs(b.aspect_x-b.cursor_x),d=Math.abs(b.aspect_y-b.cursor_y),e=b.aspect.connection_points[b.cursor_x+","+b.cursor_y];return!b.aspect.read_only()&&c<=jade.model.connection_point_radius&&d<=jade.model.connection_point_radius&&e&&!a.shiftKey?(b.unselect_all(-1),b.redraw_background(),b.wire=[b.cursor_x,b.cursor_y,b.cursor_x,b.cursor_y]):b.start_select(a.shiftKey),a.preventDefault(),!1}function i(a){var b=a.target.diagram;return b.event_coords(a),b.wire?(b.wire[2]=b.cursor_x,b.wire[3]=b.cursor_y,b.redraw()):b.mouse_move(),a.preventDefault(),!1}function j(a){var b=a.target.diagram;if(b.wire){var c=b.wire;if(b.wire=void 0,c[0]!=c[2]||c[1]!=c[3]){b.aspect.start_action();var d=b.aspect.add_wire(c[0],c[1],c[2],c[3],0);d.selected=!0,b.aspect.end_action(),b.redraw_background()}else b.redraw()}else b.mouse_up(a.shiftKey);return a.preventDefault(),!1}function k(a){var b=a.target.diagram;return b.event_coords(a),b.aspect&&!b.aspect.read_only()&&b.aspect.map_over_components(function(a){return a.edit_properties(b,b.aspect_x,b.aspect_y)?!0:!1}),a.preventDefault(),!1}function l(a){jade.model.Component.call(this),this.module=A,this.load(a)}function m(a){jade.model.Component.call(this),this.module=C,this.load(a)}function n(a){jade.model.Component.call(this),this.module=D,this.load(a)}function o(a){jade.model.Component.call(this),this.module=E,this.load(a)}function p(a){jade.model.Component.call(this),this.module=F,this.load(a)}function q(a,b,c){var d=H[0].getContext("2d");c&&(H.css("font",c),d.font=c);var e=d.measureText(a).width,f=H.css("font-size").match(/([\d\.]*)(\w*)/),g=parseFloat(f[1]);"em"==f[2]?g*=16:"pt"==f[2]&&(g*=4/3);var h=[0,0,0,0],i=b.split("-"),j=i[0];"top"==j?(h[1]=0,h[3]=g):"center"==j?(h[1]=-g/2,h[3]=g/2):(h[1]=-g,h[3]=0);var k=i[1]||i[0];return"left"==k?(h[0]=0,h[2]=e):"center"==k?(h[0]=-e/2,h[2]=e/2):(h[0]=-e,h[2]=0),h}function r(a){jade.model.Component.call(this),this.module=I,this.load(a)}function s(a,b){this.editor=a,this.diagram=a.diagram,this.components=a.components,this.parts_wanted=b;var c=$('<div class="jade-xparts-bin"></div>');this.top_level=c[0],this.top_level.parts_bin=this,this.parts={}}function t(a){this.editor=a,this.diagram=a.diagram,this.component=void 0,this.selected=!1,this.canvas=$('<canvas class="jade-xpart jade-tool jade-tool-enabled"></div>'),this.canvas[0].part=this;var b=this.canvas[0].getContext("2d"),c=window.devicePixelRatio||1,d=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1;this.pixelRatio=c/d,this.canvas[0].width=J*this.pixelRatio,this.canvas[0].height=K*this.pixelRatio,b.scale(this.pixelRatio,this.pixelRatio),this.property_font="5pt sans-serif",this.annotation_font="6pt sans-serif"}function u(a){var b=a.target.part,c=b.component.module.properties.tool_tip;return c=void 0!==c?c.value:b.component.type(),c+=": drag onto diagram to insert, double click to edit",b.diagram.message(c),!1}function v(a){var b=a.target.part;return b.diagram.message(""),!1}function w(a){var b=a.target.part;return b.select(!0),b.diagram.new_part=b,!1}function x(a){var b=a.target.part;return b.select(!1),b.diagram.new_part=void 0,!1}function y(a){var b=a.target.part;b.editor.jade.edit(b.component.module.get_name())}var z=[];a.prototype.diagram_changed=function(a){var b=a.aspect.module;if(b){var c=this.jade.configuration.tests;delete c[b.get_name()]}},a.prototype.resize=function(a,b,c){var d=$(this.diagram.canvas),e=d.outerWidth(!0)-d.width(),f=d.outerHeight(!0)-d.height(),g=this.resizer.outerWidth(!0)+$(this.parts_bin.top_level).outerWidth(!0),h=this.toolbar.toolbar.outerHeight(!0),i=a-e,j=b-f-h;d.width(i-g),d.height(j),d=this.resizer,d.height(j),this.parts_bin.resize(i,j,c),c&&this.diagram.resize()},a.prototype.show=function(){this.diagram.resize(),this.parts_bin.show()},a.prototype.set_aspect=function(b){this.diagram.set_aspect(b.aspect(a.prototype.editor_name)),this.parts_bin.show()},a.prototype.redraw=function(a){this.toolbar&&this.toolbar.enable_tools(this.diagram);var b=a.wire;b&&(a.c.strokeStyle=a.selected_style,a.draw_line(b[0],b[1],b[2],b[3],1))},a.prototype.editor_name="schematic",jade.editors.push(a),l.prototype=new jade.model.Component,l.prototype.constructor=l,l.prototype.type=function(){return"wire"},jade.model.built_in_components.wire=l;var A={has_aspect:function(){return!1},properties:{signal:{type:"string",label:"Signal name",value:"",edit:"yes"}}},B=2;l.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties();var b=this.coords[3],c=this.coords[4];this.add_connection(0,0),this.add_connection(b,c);var d=[0,0,b,c];jade.model.canonicalize(d),d[0]-=B,d[1]-=B,d[2]+=B,d[3]+=B,this.bounding_box=d,this.update_coords(),this.len=Math.sqrt(b*b+c*c)},l.prototype.other_end=function(a){return this.connections[0].coincident(a.x,a.y)?this.connections[1]:this.connections[1].coincident(a.x,a.y)?this.connections[0]:void 0},l.prototype.far_end=function(){var a=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],b=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];return[a,b]},l.prototype.move_end=function(){jade.model.Component.prototype.move_end.call(this),this.aspect.check_connection_points(this)},l.prototype.add=function(a){jade.model.Component.prototype.add.call(this,a),this.aspect.check_wires(this),this.aspect.check_connection_points(this)},l.prototype.remove=function(){for(var a=this.connections[0],b=this.connections[1],c=this.aspect.find_connections(a),d=0;d<c.length;d+=1){var e=c[d].parent;if("wire"==e.type()&&e.other_end(a).coincident(b.x,b.y)){jade.model.Component.prototype.remove.call(e);break}}},l.prototype.draw=function(a){var b=this.coords[3],c=this.coords[4];this.draw_line(a,0,0,b,c);var d,e=this.properties.signal;if(void 0!==e){var f=1==this.connections[0].nconnections(),g=1==this.connections[1].nconnections();if(f&&!g||!f&&g){var h=this.connections[f?0:1],i=h.offset_x,j=h.offset_y;if(0===b||Math.abs(c/b)>1){var k=(this.bounding_box[1]+this.bounding_box[3])/2;h.offset_y>k?(d=1,j+=3):(d=7,j-=3)}else{var l=(this.bounding_box[0]+this.bounding_box[2])/2;h.offset_x>l?(d=3,i+=3):(d=5,i-=3)}this.draw_text(a,e,i,j,d,a.property_font)}else d=0===b?3:0===c?7:c/b>0?6:8,this.draw_text(a,e,b>>1,c>>1,d,a.property_font)}},l.prototype.draw_icon=function(a,b){var c=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],d=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];a.draw_line(b,this.coords[0],this.coords[1],c,d)},l.prototype.distance=function(a,b){var c=this.transform_x(this.coords[3],this.coords[4]),d=this.transform_y(this.coords[3],this.coords[4]),e=Math.abs((a-this.coords[0])*d-(b-this.coords[1])*c)/this.len;return e},l.prototype.near=function(a,b){return this.inside(a,b)&&this.distance(a,b)<=B?!0:!1},l.prototype.select_rect=function(a){this.was_previously_selected=this.selected;var b=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],c=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];(this.inside(this.coords[0],this.coords[1],a)||this.inside(b,c,a))&&this.set_select(!0)},l.prototype.bisect_cp=function(a){var b=a.x,c=a.y;return this.inside(b,c)&&this.distance(b,c)<1&&!this.connections[0].coincident(b,c)&&!this.connections[1].coincident(b,c)?!0:!1},l.prototype.bisect=function(a){if(void 0===a)return null;for(var b=a.connections.length-1;b>=0;b-=1){var c=a.connections[b];if(this.bisect_cp(c))return c}return null},l.prototype.propagate_label=function(a){this.connections[0].propagate_label(a),this.connections[1].propagate_label(a)},l.prototype.label_connections=function(){},l.prototype.netlist=function(){return void 0},m.prototype=new jade.model.Component,m.prototype.constructor=m,m.prototype.type=function(){return"ground"},jade.model.built_in_components.ground=m;var C={has_aspect:function(){return!1},properties:{global_signal:{label:"Global signal name",type:"string",value:"gnd",edit:"no",choices:[""]}}};
m.prototype.load=function(a){this.coords=a[1],this.properties={},this.default_properties(),this.add_connection(0,0);var b=[-6,0,6,14];this.bounding_box=b,this.update_coords()},m.prototype.draw=function(a){this.draw_line(a,0,0,0,8),this.draw_line(a,-6,8,6,8),this.draw_line(a,-6,8,0,14),this.draw_line(a,6,8,0,14)},m.prototype.netlist=function(){return[["ground",{gnd:"gnd"},{}]]},n.prototype=new jade.model.Component,n.prototype.constructor=n,n.prototype.type=function(){return"vdd"},jade.model.built_in_components.vdd=n;var D={has_aspect:function(){return!1},properties:{global_signal:{label:"Global signal name",type:"string",value:"Vdd",edit:"yes",choices:[""]}}};n.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.add_connection(0,0);var b=[-6,-8,6,0];this.bounding_box=b,this.update_coords()},n.prototype.draw=function(a){this.draw_line(a,0,0,0,-8),this.draw_line(a,-6,-8,6,-8),this.draw_text(a,this.properties.global_signal,0,-10,7,a.property_font)},n.prototype.netlist=function(){return void 0},o.prototype=new jade.model.Component,o.prototype.constructor=o,o.prototype.type=function(){return"jumper"},jade.model.built_in_components.jumper=o;var E={has_aspect:function(){return!1}};o.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.add_connection(0,0,"n1"),this.add_connection(8,0,"n2");var b=[0,-4,8,0];this.bounding_box=b,this.update_coords()},o.prototype.draw=function(a){this.draw_arc(a,0,0,8,0,4,-4)},p.prototype=new jade.model.Component,p.prototype.constructor=p,p.prototype.type=function(){return"port"},jade.model.built_in_components.port=p;var F={has_aspect:function(){return!1},properties:{signal:{label:"Signal name",type:"string",value:"???",edit:"yes",choices:[""]}}};p.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.add_connection(0,0);var b=[-24,-4,0,4];this.bounding_box=b,this.update_coords()},p.prototype.draw=function(a){this.draw_line(a,0,0,-8,0),this.draw_line(a,-8,0,-12,-4),this.draw_line(a,-12,-4,-24,-4),this.draw_line(a,-8,0,-12,4),this.draw_line(a,-12,4,-24,4),this.draw_line(a,-24,-4,-24,4),this.draw_text(a,this.properties.signal,-26,0,5,a.property_font)},p.prototype.netlist=function(){return void 0};var G=["top-left","top-center","top-right","center-left","center","center-right","bottom-left","bottom-center","bottom-right"],H=$("<canvas></canvas>");r.prototype=new jade.model.Component,r.prototype.constructor=r,r.prototype.required_grid=1,r.prototype.type=function(){return"text"},jade.model.built_in_components.text=r;var I={has_aspect:function(){return!1},properties:{text:{type:"string",label:"Text",value:"???",edit:"yes"},font:{type:"string",label:"CSS Font",value:"6pt sans-serif",edit:"yes"},align:{type:"menu",label:"Alignment",value:"center-left",edit:"yes",choices:G}}};r.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.bounding_box=q(this.properties.text,this.properties.align,this.properties.font),this.update_coords()},r.prototype.drag_callback=function(){return!0},r.prototype.draw=function(a){this.selected&&(this.draw_line(a,-1,0,1,0),this.draw_line(a,0,-1,0,1));var b=G.indexOf(this.properties.align);this.draw_text(a,this.properties.text,0,0,b,this.properties.font)},r.prototype.draw_icon=function(a,b){var c=G.indexOf(this.properties.align);c=jade.model.aOrient[9*this.coords[2]+c],a.draw_text(b,this.properties.text,this.coords[0],this.coords[1],c,this.properties.font)},r.prototype.edit_properties=function(a,b,c){return jade.model.Component.prototype.edit_properties.call(this,a,b,c,function(a){a.bounding_box=q(a.properties.text,a.properties.align),a.update_coords()})},r.prototype.netlist=function(){return void 0};var J=42,K=42;return s.prototype.resize=function(a,b){var c=$(this.top_level);c.height(b)},s.prototype.show=function(){var a=this,b=$(this.top_level);if(b.empty(),this.parts_wanted){var c=[];$.each((this.parts_wanted||"").split(","),function(a,b){var d=b.split(":"),e=d[0],f=new RegExp(d[1]?"^"+d[1]+"$":"^.+$");e=jade.model.load_library(e),$.each(e.modules,function(a,b){f.test(a)&&c.push(b.get_name())})}),this.editor.hierarchy&&$.each(jade.model.libraries,function(a,b){$.each(b.modules,function(a,b){var d=b.get_name();-1==c.indexOf(d)&&c.push(d)})}),c.sort();var d,e,f="";$.each(c,function(c,g){var h=a.parts[g];void 0===h&&(h=new t(a.editor),a.parts[g]=h,h.set_component(jade.model.make_component([g,[0,0,0]]))),h.component.compute_bbox(),h.rescale(),h.redraw(),h.canvas.mouseover(u).mouseout(v).mousedown(w).mouseup(x).dblclick(y);var i=h.component.module.library.name;if(f!=i){d=$('<div class="jade-xparts-header"></div>'),d.append('<span class="fa fa-caret-down fa-fw"></span>'),d.append(i),e=$('<div class="jade-xparts-list"></div>');var j=e,k=$("span",d);d.on("click",function(){k.hasClass("fa-caret-down")?k.removeClass("fa-caret-down").addClass("fa-caret-right"):k.removeClass("fa-caret-right").addClass("fa-caret-down"),j.animate({height:"toggle"})}),f=i,b.append(d,e)}e.append(h.canvas)})}b.width(b.width()-1),b.width(b.width()+1)},t.prototype.rescale=function(){var a=this.component.bounding_box;1/0==a[0]&&(a=[-1,-1,1,1]);var b=a[2]-a[0],c=a[3]-a[1];this.scale=Math.min(J/(1.1*Math.abs(b)),K/(1.1*Math.abs(c)),.8),this.origin_x=a[0]+b/2-J/(2*this.scale),this.origin_y=a[1]+c/2-K/(2*this.scale)},t.prototype.set_component=function(a){this.component=a},t.prototype.redraw=function(){var a=this.canvas[0].getContext("2d");this.c=a,a.clearRect(0,0,this.canvas[0].width,this.canvas[0].height),this.component&&this.component.draw(this)},t.prototype.select=function(a){this.selected=a,this.redraw()},t.prototype.update_connection_point=function(){},t.prototype.moveTo=function(a,b){var c=Math.floor((a-this.origin_x)*this.scale)+.5,d=Math.floor((b-this.origin_y)*this.scale)+.5;this.c.moveTo(c,d)},t.prototype.lineTo=function(a,b){var c=Math.floor((a-this.origin_x)*this.scale)+.5,d=Math.floor((b-this.origin_y)*this.scale)+.5;this.c.lineTo(c,d)},t.prototype.line_width=function(a){return Math.max(1,Math.floor(a*this.scale))},t.prototype.draw_line=function(a,b,c,d,e){var f=this.c;f.lineWidth=this.line_width(e),f.beginPath(),this.moveTo(a,b),this.lineTo(c,d),f.stroke()},t.prototype.draw_arc=function(a,b,c,d,e,f,g,h){var i=this.c;i.lineWidth=this.line_width(g),i.beginPath();var j=Math.floor((a-this.origin_x)*this.scale)+.5,k=Math.floor((b-this.origin_y)*this.scale)+.5;i.arc(j,k,Math.max(1,c*this.scale),d,e,f),h?i.fill():i.stroke()},t.prototype.draw_text=function(){},t.prototype.draw_text_important=function(a,b,c,d){var e=this.c,f=d.match(/\d+/)[0];f=Math.max(2,Math.round(f*this.scale)),e.font=d.replace(/\d+/,f.toString()),e.fillStyle="rgb(0,0,0)";var g=Math.floor((b-this.origin_x)*this.scale)+.5,h=Math.floor((c-this.origin_y)*this.scale)+.5;e.fillText(a,g,h)},{schematic_tools:z,text_alignments:G,text_bbox:q}}(),jade.icon_view=function(){function a(a,m){function q(a){return a.aspect&&!a.aspect.read_only()&&a.aspect.selections()}function r(){return this.diagram&&this.diagram.aspect&&!this.diagram.aspect.read_only()}this.jade=m,this.status=m.status,this.diagram=new jade.Diagram(this,"jade-icon-diagram"),a.diagram=this.diagram,this.diagram.grid=8,this.diagram.zoom_factor=1.25,this.diagram.zoom_min=Math.pow(this.diagram.zoom_factor,1),this.diagram.zoom_max=Math.pow(this.diagram.zoom_factor,10),this.diagram.origin_min=-64,this.diagram.origin_max=64,$(this.diagram.canvas).mouseover(i).mouseout(j).mousemove(n).mousedown(l).mouseup(o).dblclick(p).keydown(k),this.toolbar=new jade.Toolbar(this.diagram),this.toolbar.add_tool("actions",jade.icons.actions_icon,"Edit/copy/delete modules; change settings",jade.jade_settings),this.toolbar.add_spacer(),this.toolbar.add_tool("undo",jade.icons.undo_icon,"Undo: undo effect of previous action",jade.diagram_undo,function(a){return a.aspect&&a.aspect.can_undo()}),this.toolbar.add_tool("redo",jade.icons.redo_icon,"redo: redo effect of next action",jade.diagram_redo,function(a){return a.aspect&&a.aspect.can_redo()}),this.toolbar.add_tool("cut",jade.icons.cut_icon,"Cut: move selected components from diagram to the clipboard",jade.diagram_cut,q),this.toolbar.add_tool("copy",jade.icons.copy_icon,"Copy: copy selected components into the clipboard",jade.diagram_copy,q),this.toolbar.add_tool("paste",jade.icons.paste_icon,"Paste: copy clipboard into the diagram",jade.diagram_paste,function(a){return a.aspect&&!a.aspect.read_only()&&jade.clipboards[a.editor.editor_name].length>0}),this.toolbar.add_tool("fliph",jade.icons.fliph_icon,"Flip Horizontally: flip selection horizontally",jade.diagram_fliph,q),this.toolbar.add_tool("flipv",jade.icons.flipv_icon,"Flip Vertically: flip selection vertically",jade.diagram_flipv,q),this.toolbar.add_tool("rotcw",jade.icons.rotcw_icon,"Rotate Clockwise: rotate selection clockwise",jade.diagram_rotcw,q),this.toolbar.add_tool("rotccw",jade.icons.rotccw_icon,"Rotate Counterclockwise: rotate selection counterclockwise",jade.diagram_rotccw,q),this.toolbar.add_spacer(),this.modes={},this.modes.select=this.toolbar.add_tool("select",jade.icons.select_icon,"Select mode",b,r),this.set_mode("select"),this.modes.line=this.toolbar.add_tool("line",jade.icons.line_icon,"Icon line mode",c,r),this.modes.arc=this.toolbar.add_tool("arc",jade.icons.arc_icon,"Icon arc mode",d,r),this.modes.circle=this.toolbar.add_tool("circle",jade.icons.circle_icon,"Icon circle mode",e,r),this.modes.text=this.toolbar.add_tool("text",jade.icons.text_icon,"Icon text mode",f,r),this.modes.terminal=this.toolbar.add_tool("terminal",jade.icons.terminal_icon,"Icon terminal mode",g,r),this.modes.property=this.toolbar.add_tool("property",jade.icons.property_icon,"Icon property mode",h,r),this.toolbar.add_spacer();for(var s=0;s<v.length;s+=1){var t=v[s];this.toolbar.add_tool(t[0],t[1],t[2],t[3],t[4])}a.appendChild(this.toolbar.toolbar[0]),a.appendChild(this.diagram.canvas);var u=new jade.model.Aspect("untitled",null);this.diagram.set_aspect(u)}function b(a){a.editor.set_mode("select")}function c(a){a.editor.set_mode("line")}function d(a){a.editor.set_mode("arc")}function e(a){a.editor.set_mode("circle")}function f(a){a.editor.set_mode("text")}function g(a){a.editor.set_mode("terminal")}function h(a){a.editor.set_mode("property")}function i(a){var b=a.target.diagram;return b.canvas.focus(),b.editor.status.text(w[b.editor.mode]),a.preventDefault(),!1}function j(a){var b=a.target.diagram;return b.editor.status.text(""),a.preventDefault(),!1}function k(a){var b=a.target.diagram,c=a.keyCode;if(32==c)b.editor.set_mode("select");else if(b.key_down(a))return!0;return a.preventDefault(),!1}function l(a){var b=a.target.diagram;if(b.event_coords(a),b.pan_zoom())return!1;var c=b.editor,d=b.cursor_x,e=b.cursor_y;return"arc2"==c.mode?(c.drag_callback(d,e,"done"),b.aspect.end_action(),c.drag_callback=void 0,c.mode="arc"):"select"!=c.mode?(c.start_x=d,c.start_y=e):b.start_select(a.shiftKey),a.preventDefault(),!1}function m(a){var b=a.editor;a.unselect_all(-1),a.redraw_background(),a.aspect.start_action();var c=jade.model.make_component([b.mode,[b.start_x,b.start_y,0]]);c.add(a.aspect),c.selected=!0,b.drag_callback=function(b,d,e){"abort"!=e&&c.drag_callback(b,d,e)?a.redraw():(c.remove(),a.redraw_background())},b.start_x=void 0}function n(a){var b=a.target.diagram;b.event_coords(a);var c=b.editor;return void 0!==c.start_x&&m(b),c.drag_callback?c.drag_callback(b.cursor_x,b.cursor_y,c.mode):b.mouse_move(),a.preventDefault(),!1}function o(a){var b=a.target.diagram;b.event_coords(a);var c=b.editor;if(void 0!==c.start_x&&m(b),c.drag_callback){var d=b.cursor_x,e=b.cursor_y;"arc"==c.mode?(c.drag_callback(d,e,"arc"),c.mode="arc2"):(c.drag_callback(d,e,"done"),b.aspect.end_action(),c.drag_callback=void 0)}else b.mouse_up(a.shiftKey);return a.preventDefault(),!1}function p(a){var b=a.target.diagram;return b.event_coords(a),b.aspect.map_over_components(function(a){return a.edit_properties(b,b.aspect_x,b.aspect_y)?!0:!1}),a.preventDefault(),!1}function q(a){jade.model.Component.call(this),this.module=x,this.load(a)}function r(a){jade.model.Component.call(this),this.module=z,this.load(a)}function s(a){jade.model.Component.call(this),this.module=A,this.load(a)}function t(a){jade.model.Component.call(this),this.module=B,this.load(a)}function u(a){jade.model.Component.call(this),this.module=C,this.load(a)}var v=[];a.prototype.diagram_changed=function(a){var b=a.aspect.module;if(b){var c=this.jade.configuration.tests;delete c[b.get_name()]}},a.prototype.resize=function(a,b,c){this.w=a,this.h=b;var d=$(this.diagram.canvas),e=d.outerWidth(!0)-d.width(),f=d.outerHeight(!0)-d.height(),g=this.toolbar.toolbar.outerHeight(!0),h=a-e,i=b-f-g;d.width(h),d.height(i),c&&this.diagram.resize()},a.prototype.show=function(){this.diagram.canvas.focus(),this.resize(this.w,this.h,!0)},a.prototype.set_aspect=function(b){this.diagram.set_aspect(b.aspect(a.prototype.editor_name))},a.prototype.editor_name="icon",jade.editors.push(a),a.prototype.redraw=function(a){this.toolbar&&this.toolbar.enable_tools(this.diagram);var b=a.editor;if("select"!=b.mode){var c=a.cursor_x,d=a.cursor_y;a.c.strokeStyle=a.normal_style,a.draw_line(c-2,d-2,c+2,d+2,.1),a.draw_line(c+2,d-2,c-2,d+2,.1),a.c.textAlign="left",a.c.textBaseline="middle",a.c.fillStyle=a.normal_style,a.draw_text(b.mode,c+4,d,a.property_font)}};var w={select:"Click component to select, click and drag on background for area select",line:"Click and drag to draw line",arc:"Click and drag to draw chord, then click again to set radius",circle:"Click at center point, drag to set radisu",text:"Click to insert text",terminal:"Click to insert terminal",property:"Click to insert property tag"};a.prototype.set_mode=function(a){this.mode=a,this.start_x=void 0,this.drag_callback&&(this.drag_callback(void 0,void 0,"abort"),this.diagram.aspect.end_action(),this.drag_callback=void 0);var b=jade.model.built_in_components[a];this.diagram.set_cursor_grid(b?b.prototype.required_grid:1),this.diagram.canvas.style.cursor="select"==a?"auto":"none";for(var c in this.modes)this.modes[c].toggleClass("icon-tool-selected",a==c);this.status.text(w[a])},q.prototype=new jade.model.Component,q.prototype.constructor=q,q.prototype.required_grid=1,q.prototype.type=function(){return"line"},jade.model.built_in_components.line=q;var x={properties:{}},y=2;q.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.setup_bbox()},q.prototype.setup_bbox=function(){var a=this.coords[3],b=this.coords[4],c=[0,0,a,b];jade.model.canonicalize(c),c[0]-=y,c[1]-=y,c[2]+=y,c[3]+=y,this.bounding_box=c,this.update_coords(),this.len=Math.sqrt(a*a+b*b)},q.prototype.drag_callback=function(a,b,c){if(this.coords[3]=a-this.coords[0],this.coords[4]=b-this.coords[1],"done"==c){if(0===this.coords[3]&&0==this.coords[4])return!1;this.setup_bbox()}return!0},q.prototype.draw=function(a){var b=this.coords[3],c=this.coords[4];this.draw_line(a,0,0,b,c)},q.prototype.draw_icon=function(a,b){var c=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],d=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];a.draw_line(b,this.coords[0],this.coords[1],c,d)},q.prototype.distance=function(a,b){var c=this.transform_x(this.coords[3],this.coords[4]),d=this.transform_y(this.coords[3],this.coords[4]),e=Math.abs((a-this.coords[0])*d-(b-this.coords[1])*c)/this.len;return e},q.prototype.near=function(a,b){return this.inside(a,b)&&this.distance(a,b)<=y?!0:!1},q.prototype.select_rect=function(a){this.was_previously_selected=this.selected;var b=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],c=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];(this.inside(this.coords[0],this.coords[1],a)||this.inside(b,c,a))&&this.set_select(!0)},r.prototype=new jade.model.Component,r.prototype.constructor=r,r.prototype.required_grid=1,r.prototype.type=function(){return"arc"},jade.model.built_in_components.arc=r;var z={properties:{}};r.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.setup_bbox()},r.prototype.setup_bbox=function(){var a=this.coords[3],b=this.coords[4],c=this.coords[5],d=this.coords[6];if(void 0===c)q.prototype.setup_bbox.call(this);else{var e=[0,0,a,b];jade.model.canonicalize(e),c<e[0]?e[0]=c:c>e[2]&&(e[2]=c),d<e[1]?e[1]=d:d>e[3]&&(e[3]=d),jade.model.canonicalize(e),this.bounding_box=e,this.update_coords()}},r.prototype.drag_callback=function(a,b,c){if("arc"==c?(this.coords[3]=a-this.coords[0],this.coords[4]=b-this.coords[1]):(this.coords[5]=a-this.coords[0],this.coords[6]=b-this.coords[1]),"done"==c){if(0===this.coords[3]&&0==this.coords[4])return!1;this.setup_bbox()}return!0},r.prototype.draw=function(a){var b,c;void 0!==this.coords[5]?(b=this.coords[5],c=this.coords[6]):(b=this.coords[3],c=this.coords[4]),this.draw_arc(a,0,0,this.coords[3],this.coords[4],b,c)},r.prototype.draw_icon=function(a,b){var c,d,e=this.transform_x(this.coords[3],this.coords[4])+this.coords[0],f=this.transform_y(this.coords[3],this.coords[4])+this.coords[1];void 0!==this.coords[5]?(c=this.transform_x(this.coords[5],this.coords[6])+this.coords[0],d=this.transform_y(this.coords[5],this.coords[6])+this.coords[1]):(c=e,d=f),a.draw_arc(b,this.coords[0],this.coords[1],e,f,c,d)},s.prototype=new jade.model.Component,s.prototype.constructor=s,s.prototype.required_grid=1,s.prototype.type=function(){return"circle"},jade.model.built_in_components.circle=s;var A={properties:{}};s.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.setup_bbox()},s.prototype.setup_bbox=function(){var a=this.coords[3];this.bounding_box=[-a,-a,a,a],this.update_coords()},s.prototype.drag_callback=function(a,b,c){var d=a-this.coords[0],e=b-this.coords[1];if(this.coords[3]=Math.sqrt(d*d+e*e),"done"==c){if(0===this.coords[3])return!1;this.setup_bbox()}return!0},s.prototype.draw=function(a){this.draw_circle(a,0,0,this.coords[3],!1)},s.prototype.draw_icon=function(a,b){a.draw_circle(b,this.coords[0],this.coords[1],this.coords[3],!1)},t.prototype=new jade.model.Component,t.prototype.constructor=t,t.prototype.required_grid=1,t.prototype.type=function(){return"property"},jade.model.built_in_components.property=t;var B={properties:{format:{type:"string",label:"Format",value:"{???}",edit:"yes"},align:{type:"menu",label:"Alignment",value:"center-left",edit:"yes",choices:jade.schematic_view.text_alignments}}};t.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.bounding_box=jade.schematic_view.text_bbox(this.properties.format,this.properties.align,"5pt sans-serif"),this.update_coords()},t.prototype.drag_callback=function(){return!0},t.prototype.draw=function(a){this.selected&&(this.draw_line(a,-1,0,1,0),this.draw_line(a,0,-1,0,1));var b=jade.schematic_view.text_alignments.indexOf(this.properties.align);this.draw_text(a,this.properties.format||"-no format-",0,0,b,a.property_font)},t.prototype.draw_icon=function(a,b){var c=this.properties.format||"-no format-";for(var d in a.properties){var e=a.properties[d]||"";c=c.replace(new RegExp("\\{"+d+"\\}","gm"),e)}c=c.replace(new RegExp("\\{module\\}","gm"),a.module.get_name());var f=jade.schematic_view.text_alignments.indexOf(this.properties.align);f=jade.model.aOrient[9*this.coords[2]+f],a.draw_text(b,c,this.coords[0],this.coords[1],f,b.property_font)},t.prototype.edit_properties=function(a,b,c){return jade.model.Component.prototype.edit_properties.call(this,a,b,c,function(b){b.bounding_box=jade.schematic_view.text_bbox(b.properties.format,b.properties.align,a.property_font),b.update_coords()})},u.prototype=new jade.model.Component,u.prototype.constructor=u,u.prototype.required_grid=8,u.prototype.type=function(){return"terminal"},jade.model.built_in_components.terminal=u;var C={properties:{name:{type:"string",label:"Terminal name",value:"???",edit:"yes"},line:{type:"menu",label:"Draw line?",value:"yes",edit:"yes",choices:["yes","no"]}}};return u.prototype.load=function(a){this.coords=a[1],this.properties=a[2]||{},this.default_properties(),this.bounding_box=[-jade.model.connection_point_radius,-jade.model.connection_point_radius,8+jade.model.connection_point_radius,jade.model.connection_point_radius],this.update_coords()},u.prototype.drag_callback=function(){return!0},u.prototype.draw=function(a){this.draw_circle(a,0,0,jade.model.connection_point_radius,!1),"no"!=this.properties.line&&this.draw_line(a,0,0,8,0),this.draw_text(a,this.properties.name,jade.model.connection_point_radius-4,0,5,a.property_font)},u.prototype.draw_icon=function(a,b){if("no"!=this.properties.line){var c=this.coords[0],d=this.coords[1],e=this.transform_x(8,0)+this.coords[0],f=this.transform_y(8,0)+this.coords[1];a.draw_line(b,c,d,e,f)}},u.prototype.terminal_coords=function(){return[this.coords[0],this.coords[1],this.properties.name]},{icon_tools:v}}(),jade.property_view=function(){function a(a,b){this.jade=b,this.status=b.status,this.module=void 0,this.table=$('<table class="jade-property-table"></div>'),$(a).append(this.table),this.build_table()}return a.prototype.resize=function(){},a.prototype.show=function(){},a.prototype.set_aspect=function(a){this.module=a,this.build_table()},a.prototype.build_table=function(){var a,b=this,c=b.module,d=this.module&&this.module.read_only();if(a=this.table,a.empty(),void 0===c)return void a.append("<tr><td>To edit properites you must first specify a module.</td></tr>");if(a.append("<tr><th>Action</th><th>Name</th><th>Label</th><th>Type</th><th>Value</th><th>Edit</th><th>Choices</th></tr>"),$.each(c.properties,function(e,f){function g(a,b,f){var g=$("<td></td>").append(b);h.append(g),d&&$(b).attr("disabled","true"),$(b).on("change",function(b){var d=b.target.value.trim();f&&(d=f(d)),c.set_property_attribute(e,a,d)})}var h=$("<tr></tr>");a.append(h);var i=$("<td></td>");h.append(i);var j=jade.build_button("delete",function(){c.remove_property(e),b.build_table()});d&&$(j).attr("disabled","true"),i.append(j),i=$("<td></td>").text(e),h.append(i),g("label",jade.build_input("text",10,f.label||f.name)),g("type",jade.build_select(["string","menu"],f.type||"string")),g("value",jade.build_input("text",10,f.value||"")),g("edit",jade.build_select(["yes","no"],f.edit||"yes")),g("choices",jade.build_input("text",15,f.choices?f.choices.join():""),function(a){var b=a.split(",").map(function(a){return a.trim()});return b})}),!d){var e={};e.action=jade.build_button("add",function(){var a=e.name.value.trim();if(""===a)alert("Please enter a name for the new property");else if(a in b.module.properties)alert("Oops, duplicate property name!");else{var c={};c.label=e.label.value.trim()||a,c.type=e.type.value,c.value=e.value.value.trim(),c.edit=e.edit.value;for(var d=e.choices.value.split(","),f=0;f<d.length;f+=1)d[f]=d[f].trim();c.choices=d,b.module.set_property(a,c),b.build_table()}}),e.name=jade.build_input("text",10,""),e.label=jade.build_input("text",10,""),e.type=jade.build_select(["string","menu"],"string"),e.value=jade.build_input("text",10,""),e.edit=jade.build_select(["yes","no"],"yes"),e.choices=jade.build_input("text",15,"");var f=$("<tr></tr>");for(var g in e)f.append($("<td></td>").append(e[g]));a.append(f)}},a.prototype.editor_name="properties",jade.editors.push(a),{}}(),jade.test_view=function(){function a(a){var b=a.aspect.module;if(b&&b.has_aspect("test")){var c=b.aspect("test").components[0];if(c)return void d(c.test,a,b)}a.message("This module does not have a test!")}function b(a,b){this.jade=b,this.status=b.status,this.module=void 0,this.aspect=void 0,this.test_component=void 0;var c=$('<textarea class="jade-test-editor"></textarea>');this.textarea=c;var d=this;c.on("mouseleave",function(){if(d.test_component){var a=c.val();d.test_component.test!=a&&(d.test_component.test=a,d.aspect.set_modified(!0))}}),a.appendChild(c[0])}function c(a){jade.model.Component.call(this),this.load(a)}function d(a,b,c){function d(a){-1==E.indexOf(a)&&y.push('Circuit does not have a node named "'+a+'".')}function g(a,b){b!=a[a.length-1][1]&&a.push([F,b])}function h(a,d){function e(a){var b=d._network_.history(a);return void 0!==b?{xvalues:[b.xvalues],yvalues:[b.yvalues],name:[a],xunits:"s",yunits:"device"==o?"V":"",color:["#268bd2"],type:[d._network_.result_type()]}:void 0}function f(a){var b=e(a);void 0!==b&&k.push(b)}if(void 0===a){if(jade.window_close(G[0].win),"string"==typeof d)return b.message(d),void(i[c.get_name()]="Error detected: "+d);if(d instanceof Error)return b.message(d.stack.split("\n").join("<br>")),void(i[c.get_name()]="Error detected: "+d.message);var g=[];if($.each(x,function(a,b){var c=d._network_.history(a),e=c.xvalues,f=c.yvalues;$.each(b,function(b,c){var d;if("device"==o)d=jade.device_level.interpolate(c[0],e,f),("L"==c[1]&&d>s.Vil||"H"==c[1]&&d<s.Vih)&&g.push("Expected signal "+a+" to be a valid "+c[1]+" at time "+jade.utils.engineering_notation(c[0],2)+"s.");else{if("gate"!=o)throw"Unrecognized simulation mode: "+o;d=jade.gate_level.interpolate(c[0],e,f),("L"==c[1]&&0!=d||"H"==c[1]&&1!=d)&&g.push("Expected signal "+a+" to be a valid "+c[1]+" at time "+jade.utils.engineering_notation(c[0],2)+"s.")}})}),g.length>0){var h="";g.length>3&&(g=g.slice(0,5),h="<br>..."),j="<ul><li>"+g.join("<li>")+h+"</ul>",b.message(j),i[c.get_name()]="Error detected: "+j}else b.message("Test succesful!"),i[c.get_name()]="passed";if(p.length>0){var k=[];$.each(p,function(a,b){k.push(e(b))}),k.add_plot=f;var l=jade.plot.graph(k),m=$(b.canvas).offset(),n=jade.window("Test Results",l,m),q=n.width(),r=n.height();n[0].resize(Math.floor(.75*$(b.canvas).width())-q,Math.floor(.75*$(b.canvas).height())-r)}return void 0}return G[0].update_progress(a),G[0].stop_requested}var i=b.editor.jade.configuration.tests;i[c.get_name()]="Error detected: test did not yield a result.";var j;a=a.replace(/\/\*(.|\n)*?\*\//g,""),a=a.replace(/\/\/.*\n/g,"\n");var k,l,m,n,o="device",p=[],q=[],r={},s={},t=[],u={},v=[],w={},x={},y=[];for(a=a.split("\n"),m=0;m<a.length;m+=1){var z=a[m].match(/([A-Za-z0-9_.:\[\]]+|=|-)/g);if(null!==z)if(".mode"==z[0])2!=z.length?y.push("Malformed .mode statement: "+a[m]):"device"==z[1]||"gate"==z[1]?o=z[1]:y.push("Unrecognized simulation mode: "+z[1]);else if(".power"==z[0]||".thresholds"==z[0])for(k=1;k<z.length;k+=3){if(k+2>=z.length||"="!=z[k+1]){y.push("Malformed "+z[0]+" statement: "+a[m]);break}if(n=jade.utils.parse_number(z[k+2]),isNaN(n)){y.push('Unrecognized voltage specification "'+z[k+2]+'": '+a[m]);break}".power"==z[0]?r[z[k]]=n:s[z[k]]=n}else if(".group"==z[0])if(z.length<3)y.push("Malformed .group statement: "+a[m]);else for(u[z[1]]=[],l=2;l<z.length;l+=1)$.each(jade.utils.parse_signal(z[l]),function(a,b){u[z[1]].push(v.length),v.push(b)});else if(".plot"==z[0])for(l=1;l<z.length;l+=1)$.each(jade.utils.parse_signal(z[l]),function(a,b){p.push(b),x[b]=[]});else if(".cycle"==z[0]){if(0!=t.length){y.push("More than one .cycle statement: "+a[m]);break}for(k=1;k<z.length;)if(("assert"==z[k]||"deassert"==z[k]||"sample"==z[k])&&k+1<z.length){var A=u[z[k+1]];if(void 0===A){y.push('Use of undeclared group name "'+z[k+1]+'" in .cycle: '+a[m]);break}for(l=0;l<A.length;l+=1)("assert"==z[k]||"deassert"==z[k])&&(w[v[A[l]]]=[[0,"Z"]]),"sample"==z[k]&&(x[v[A[l]]]=[]);t.push([z[k],z[k+1]]),k+=2}else if("tran"==z[k]&&k+1<z.length){if(n=jade.utils.parse_number(z[k+1]),isNaN(n)){y.push('Unrecognized tran duration "'+z[k+1]+'": '+a[m]);break}t.push(["tran",n]),k+=2}else{if(!("="==z[k+1]&&k+2<z.length)){y.push('Malformed .cycle action "'+z[k]+'": '+a[m]);break}if(n=z[k+2],-1=="01Z".indexOf(n)){y.push('Unrecognized value specification "'+z[k+2]+'": '+a[m]);break}t.push(["set",z[k],n]),w[z[k]]=[[0,"Z"]],k+=3}}else if("."==z[0][0])y.push("Unrecognized control statment: "+a[m]);else{var B=z.join("");if(B.length!=v.length){y.push("Test line does not specify "+v.length+" signals: "+a[m]);break}for(l=0;l<B.length;l+=1)if(-1=="01ZLH-".indexOf(B[l])){y.push("Illegal test value "+B[l]+": "+a[m]);break}q.push(B)}}if("Vol"in s||y.push("Missing Vol threshold specification"),"Vil"in s||y.push("Missing Vil threshold specification"),"Vih"in s||y.push("Missing Vih threshold specification"),"Voh"in s||y.push("Missing Voh threshold specification"),0==t.length&&y.push("Missing .cycle specification"),0==q.length&&y.push("No tests specified!"),0!=y.length)return j="<li>"+y.join("<li>"),b.message("The following errors were found in the test specification:"+j),void(i[c.get_name()]="Error detected: invalid test specification"+j);if(!c.has_aspect("schematic"))return b.message("This module does not have a schematic!"),void(i[c.get_name()]="Error detected: this module has no schematic!");var C;try{if("device"==o)C=jade.device_level.device_netlist(c.aspect("schematic"));else{if("gate"!=o)throw"Unrecognized simulation mode: "+o;C=jade.gate_level.gate_netlist(c.aspect("schematic"))}}catch(D){return b.message("Error extracting netlist:<p>"+D),void(i[c.get_name()]="Error detected extracting netlist:<p>"+D)}var E=jade.netlist.extract_nodes(C);if($.each(w,d),$.each(x,d),0!=y.length)return j="<li>"+y.join("<li>"),b.message("The following errors were found in the test specification:"+j),void(i[c.get_name()]="Error detected:"+j);C.push({type:"ground",connections:["gnd"],properties:{}}),$.each(r,function(a,b){C.push({type:"voltage source",connections:{nplus:a,nminus:"gnd"},properties:{value:{type:"dc",args:[b]},name:a+"_source"}})});var F=0;if($.each(q,function(a,b){$.each(t,function(a,c){"assert"==c[0]||"deassert"==c[0]?$.each(u[c[1]],function(a,d){("deassert"==c[0]||-1!="01Z".indexOf(b[d]))&&g(w[v[d]],"deassert"==c[0]?"Z":b[d])}):"sample"==c[0]?$.each(u[c[1]],function(a,c){-1!="HL".indexOf(b[c])&&x[v[c]].push([F,b[c]])}):"set"==c[0]?g(w[c[1]],c[2]):"tran"==c[0]&&(F+=c[1])})}),"device"==o)e(C,w,s);else{if("gate"!=o)throw"Unrecognized simulation mode: "+o;f(C,w,s)}jade.netlist.print_netlist(C);var G=jade.progress_report();if(jade.window("Progress",G[0],$(b.canvas).offset()),"device"==o)jade.cktsim.transient_analysis(C,F,Object.keys(x),h);else{if("gate"!=o)throw"Unrecognized simulation mode: "+o;jade.gatesim.transient_analysis(C,F,Object.keys(x),h)}}function e(a,b,c){a.push({type:"voltage source",connections:{nplus:"_Voh_",nminus:"gnd"},properties:{name:"_Voh_source",value:{type:"dc",args:[c.Voh]}}}),a.push({type:"voltage source",connections:{nplus:"_Vol_",nminus:"gnd"},properties:{name:"_Voh_source",value:{type:"dc",args:[c.Vol]}}}),$.each(b,function(b){a.push({type:"pfet",connections:{D:"_Voh_",G:b+"_pullup",S:b},properties:{W:8,L:1,name:b+"_pullup"}}),a.push({type:"nfet",connections:{D:b,G:b+"_pulldown",S:"_Vol_"},properties:{W:8,L:1,name:b+"_pulldown"}})}),$.each(b,function(b,d){var e=[0,c.Vol],f=[0,c.Voh];$.each(d,function(a,g){var h,i,j=g[0],k=g[1];"0"==k?(i=c.Voh,h=c.Voh):"1"==k?(i=c.Vol,h=c.Vol):"Z"==k?(i=c.Vol,h=c.Voh):console.log("node: "+b+", tvlist: "+JSON.stringify(d));var l=f[f.length-1];l!=h&&(j!=f[f.length-2]&&f.push.apply(f,[j,l]),f.push.apply(f,[j+1e-10,h]));var m=e[e.length-1];m!=i&&(j!=e[e.length-2]&&e.push.apply(e,[j,m]),e.push.apply(e,[j+1e-10,i]))}),a.push({type:"voltage source",connections:{nplus:b+"_pullup",nminus:"gnd"},properties:{name:b+"_pullup_source",value:{type:"pwl",args:f}}}),a.push({type:"voltage source",connections:{nplus:b+"_pulldown",nminus:"gnd"},properties:{name:b+"_pulldown_source",value:{type:"pwl",args:e}}})})}function f(a,b,c){$.each(b,function(b){a.push({type:"tristate",connections:{E:b+"_enable",A:b+"_data",Z:b},properties:{name:b+"_input_driver",tcd:0,tpd:1e-10,tr:5e3,tf:5e3,cin:0,size:0}})}),$.each(b,function(b,d){var e=[0,c.Vol],f=[0,c.Vol];$.each(d,function(a,g){var h,i,j=g[0],k=g[1];"0"==k?(h=c.Voh,i=c.Vol):"1"==k?(h=c.Voh,i=c.Voh):"Z"==k||"-"==k?(h=c.Vol,i=c.Vol):console.log("node: "+b+", tvlist: "+JSON.stringify(d));var l=e[e.length-1];l!=h&&(j!=e[e.length-2]&&e.push.apply(e,[j,l]),e.push.apply(e,[j+1e-10,h]));var m=f[f.length-1];m!=i&&(j!=f[f.length-2]&&f.push.apply(f,[j,m]),f.push.apply(f,[j+1e-10,i]))
}),a.push({type:"voltage source",connections:{nplus:b+"_enable",nminus:"gnd"},properties:{name:b+"_enable_source",value:{type:"pwl",args:e}}}),a.push({type:"voltage source",connections:{nplus:b+"_data",nminus:"gnd"},properties:{name:b+"_data_source",value:{type:"pwl",args:f}}})})}return jade.schematic_view.schematic_tools.push(["check",jade.icons.check_icon,"Check: run tests",a]),b.prototype.resize=function(a,b){var c=this.textarea,d=c.outerWidth(!0)-c.width(),e=c.outerHeight(!0)-c.height(),f=a-d,g=b-e;c.width(f),c.height(g)},b.prototype.show=function(){},b.prototype.set_aspect=function(a){this.module=a,this.aspect=a.aspect("test"),this.test_component=this.aspect.components[0],void 0===this.test_component&&(this.test_component=jade.model.make_component(["test",""]),this.aspect.add_component(this.test_component)),this.textarea.val(this.test_component.test),this.aspect.read_only()?this.textarea.attr("disabled","disabled"):this.textarea.removeAttr("disabled")},b.prototype.event_coords=function(){},b.prototype.check=function(){d(this.textarea.val(),this,this.module)},b.prototype.message=function(a){this.status.text(a)},b.prototype.clear_message=function(a){this.status.text()==a&&this.status.text("")},b.prototype.editor_name="test",jade.editors.push(b),c.prototype=new jade.model.Component,c.prototype.constructor=c,c.prototype.type=function(){return"test"},jade.model.built_in_components.test=c,c.prototype.load=function(a){this.test=a[1]},c.prototype.json=function(){return[this.type(),this.test]},{}}(),jade.utils=function(){function a(a,b){var c;if(c=a.match(/^\s*([\-+]?)0x([0-9a-fA-F]+)\s*$/))return parseInt(c[1]+c[2],16);if(c=a.match(/^\s*([\-+]?)0b([0-1]+)\s*$/))return parseInt(c[1]+c[2],2);if(c=a.match(/^\s*([\-+]?)0([0-7]+)\s*$/))return parseInt(c[1]+c[2],8);if(c=a.match(/^\s*[\-+]?[0-9]*(\.([0-9]+)?)?([eE][\-+]?[0-9]+)?\s*$/))return parseFloat(c[0]);if(c=a.match(/^\s*([\-+]?[0-9]*(\.([0-9]+)?)?)(a|A|f|F|g|G|k|K|m|M|n|N|p|P|t|T|u|U)\s*$/)){var d=parseFloat(c[1]),e=c[4];return"P"==e?d*=1e15:"t"==e||"T"==e?d*=1e12:"g"==e||"G"==e?d*=1e9:"M"==e?d*=1e6:"k"==e||"K"==e?d*=1e3:"m"==e?d*=.001:"u"==e||"U"==e?d*=1e-6:"n"==e||"N"==e?d*=1e-9:"p"==e?d*=1e-12:"f"==e||"F"==e?d*=1e-15:("a"==e||"A"==e)&&(d*=1e-18),d}return b||0/0}function b(b){var c=a(b,void 0);if(void 0===c)throw'The string "'+b+'" could not be interpreted as an integer, a floating-point number or a number using engineering notation. Sorry, expressions are not allowed in this context.';return c}function c(a,b,c){if(0===a)return"0";if(void 0===a)return"undefined";void 0===c&&(c=!0);var d=0>a?-1:1,e=Math.log(d*a)/Math.LN10,f=Math.floor(e/3),g=d*Math.pow(10,e-3*f),h=(g+.5*d*Math.pow(10,-b)).toString(),i=h.length,j=h.indexOf(".");if(-1!=j){if(b>0&&(j+=b+1,j>i&&(j=i),c)){for(;"0"==h.charAt(j-1);)j-=1;"."==h.charAt(j-1)&&(j-=1)}i>j&&(h=h.substring(0,j))}switch(f){case-5:return h+"f";case-4:return h+"p";case-3:return h+"n";case-2:return h+"u";case-1:return h+"m";case 0:return h;case 1:return h+"K";case 2:return h+"M";case 3:return h+"G"}return a.toPrecision(b)}function d(a){var c={};c.period=0,c.value=function(){return 0},c.inflection_point=function(){return void 0};var d=a.match(/^\s*(\w+)\s*\(([^\)]*)\)\s*$/);d?(c.fun=d[1],c.args=d[2].split(/\s*,\s*/).map(b)):(c.fun="dc",c.args=[b(a)]);var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return"dc"==c.fun?(g=f(c.args,0,0),c.args=[a],c.value=function(){return g}):"impulse"==c.fun?(g=f(c.args,0,1),h=Math.abs(f(c.args,2,1e-9)),c.args=[g,h],e(c,[0,0,h/2,g,h,0],!1)):"step"==c.fun?(g=f(c.args,0,0),h=f(c.args,1,1),k=Math.max(0,f(c.args,2,0)),l=Math.abs(f(c.args,3,1e-9)),c.args=[g,h,k,l],e(c,[k,g,k+l,h],!1)):"square"==c.fun?(g=f(c.args,0,0),h=f(c.args,1,1),n=Math.abs(f(c.args,2,1)),o=Math.min(100,Math.abs(f(c.args,3,50))),c.args=[g,h,n,o],q=0===n?1/0:1/n,r=.01*q,p=.01*o*.98*q,e(c,[0,g,r,h,r+p,h,r+p+r,g,q,g],!0)):"triangle"==c.fun?(g=f(c.args,0,0),h=f(c.args,1,1),n=Math.abs(f(c.args,2,1)),c.args=[g,h,n],q=0===n?1/0:1/n,e(c,[0,g,q/2,h,q,g],!0)):"pwl"==c.fun||"pwl_repeating"==c.fun?e(c,c.args,"pwl_repeating"==c.fun):"pulse"==c.fun?(g=f(c.args,0,0),h=f(c.args,1,1),k=Math.max(0,f(c.args,2,0)),l=Math.abs(f(c.args,3,1e-9)),m=Math.abs(f(c.args,4,1e-9)),p=Math.abs(f(c.args,5,1e9)),q=Math.abs(f(c.args,6,1e9)),c.args=[g,h,k,l,m,p,q],s=k,t=s+l,u=t+p,v=u+m,e(c,[s,g,t,h,u,h,v,g,q,g],!0)):"sin"==c.fun&&(i=f(c.args,0,0),j=f(c.args,1,1),n=Math.abs(f(c.args,2,1)),c.period=1/n,k=Math.max(0,f(c.args,3,0)),w=f(c.args,4,0),c.args=[i,j,n,k,w],w/=360,c.value=function(a){return k>a?i+j*Math.sin(2*Math.PI*w):i+j*Math.sin(2*Math.PI*(n*(a-k)+w))},c.inflection_point=function(a){return k>a?k:void 0}),c.dc=c.value(0),c}function e(a,b,c){var d=b.length;c&&(a.period=b[d-2]),d%2==1&&(d-=1),2>=d?(a.value=function(){return 2==d?b[1]:0},a.inflection_point=function(){return void 0}):(a.value=function(a){c&&(a=Math.fmod(a,b[d-2]));var e=b[0],f=b[1];if(a>e)for(var g,h,i=2;d>i;i+=2){if(g=b[i],h=b[i+1],g>e&&g>a)return f+(h-f)*(a-e)/(g-e);e=g,f=h}return f},a.inflection_point=function(a){c&&(a=Math.fmod(a,b[d-2]));for(var e=0;d>e;e+=2){var f=b[e];if(f>a)return f}return void 0})}function f(a,b,c){var d=a[b];return void 0===d&&(d=c),d}function g(a,b){if(a.length==b.length){for(var c=0;c<a.length;c+=1)if(a[c]!=b[c])return!1;return!0}return!1}function h(a){function b(a){var c;if(c=a.match(/(.*)#\s*(\d+)$/)){var d=b(c[1].trim()),e=parseInt(c[2],10);if(isNaN(e))return[a];for(var f=[];e>0;)f.push.apply(f,d),e-=1;return f}if(c=a.match(/(.*)\[\s*(\-?\d+)\s*:\s*(\-?\d+)\s*(:\s*(\-?\d+)\s*)?\]$/)){var d=b(c[1].trim()),g=parseInt(c[2],10),h=parseInt(c[3],10),i=Math.abs(parseInt(c[5],10)||1);g>h&&(i=-i);for(var f=[];;){for(var j=0;j<d.length;j+=1)f.push(d[j]+"["+g.toString()+"]");if(g+=i,i>0&&g>h||0>i&&h>g)break}return f}return a?[a]:[]}var c=[];if(void 0!==a)for(var d=a.split(","),e=0;e<d.length;e+=1){var f=b(d[e].trim());c.push.apply(c,f)}return c}return Math.fmod=function(a,b){var c=Math.floor(a/b);return a-c*b},{parse_number:a,parse_number_alert:b,engineering_notation:c,parse_source:d,parse_signal:h,signal_equals:g}}(),jade.plot=function(){function a(a,b,c){var d,e=Math.log((b-a)/Math.max(1,c))/Math.LN10,f=Math.floor(e),g=Math.pow(10,e-f);d=g>=4.99?5:g>=1.99?2:1,d*=Math.pow(10,f);var h=Math.floor(a/d)*d;return a>h&&(h+=d),[h,d]}function b(a){function b(b,d){a.sel0=void 0,void 0===d&&(d=a[0].left);var e=a[0],f=e.datax(d),g=f-(d-e.left)/e.wplot*b;a.xstart=Math.max(a.xmin,g),a.xend=a.xstart+b,a.xend>a.xmax&&(a.xstart=Math.max(a.xmin,a.xstart-(a.xend-a.xmax)),a.xend=a.xmax),c(h[0],h.width(),h.height())}function f(d){d.dataseries=a,$.each(d.xvalues,function(b,c){(void 0===a.xmin||c[0]<a.xmin)&&(a.xmin=c[0]),(void 0===a.xmax||c[c.length-1]>a.xmax)&&(a.xmax=c[c.length-1])});var f,i;if($.each(d.yvalues,function(a,b){"analog"==d.type[a]&&$.each(b,function(a,b){(void 0===f||f>b)&&(f=b),(void 0===i||b>i)&&(i=b)})}),void 0===f&&(f=0,i=1),f==i)0===f?(f=-.5,i=.5):(f=f>0?.9*f:1.1*f,i=i>0?1.1*i:.9*i);else{var j=.2*(i-f);f-=j,i+=j}d.ymin=f,d.ymax=i,d.canvas=$('<canvas class="plot-canvas"></canvas>'),d.canvas[0].plot_dataset=d,d.canvas.on("click",function(b){var e=d.canvas.offset(),f=b.pageX-e.left,g=b.pageY-e.top;f>=5.5&&15.5>=f&&g>=5.5&&15.5>=g&&(a.splice(a.indexOf(d),1),d.canvas.remove(),c(h[0],h.width(),h.height()))}),d.canvas.on("dblclick",function(a){var c=d.canvas.offset(),e=a.pageX-c.left,f=a.pageY-c.top;if(e>=d.left&&e<=d.left+d.wplot&&f>=d.top&&f<=d.top+d.hplot){var g=d.dataseries.xend-d.dataseries.xstart;a.shiftKey?b(2*g,e):b(g/2,e)}}),d.canvas.on("mouseenter",function(){d.canvas.focus()}),d.canvas.on("mouseleave",function(){d.canvas.blur()}),d.canvas.on("keypress",function(a){if(37==a.which)g(1);else{if(39!=a.which)return;g(-1)}a.prevent_default()}),d.canvas.on("mousewheel",function(a){var b=d.canvas.offset(),c=a.pageX-b.left,e=a.pageY-b.top;c>=d.left&&c<=d.left+d.wplot&&e>=d.top&&e<=d.top+d.hplot&&(a.preventDefault(),g(a.originalEvent.wheelDelta>0?-1:1))}),d.canvas.on("mousedown",function(b){var c=d.canvas.offset(),f=b.pageX-c.left,g=b.pageY-c.top;f>=d.left&&f<=d.left+d.wplot&&g>=d.top&&g<=d.top+d.hplot&&(a.sel0=a.cursor,a.sel1=void 0,a.sel=!0),$(document).on("mouseup",function(){$(document).unbind("mouseup"),a.sel=void 0,e(a)})}),d.canvas.on("mousemove",function(b){var c=d.canvas.offset(),f=b.pageX-c.left,g=b.pageY-c.top;f>=d.left&&f<=d.left+d.wplot&&g>=d.top&&g<=d.top+d.hplot?(a.cursor=Math.floor(f)+.5,a.sel&&(a.sel1=a.cursor)):a.cursor=void 0,e(a)}),d.bg_image=$("<canvas></canvas>");var k=d.canvas[0].getContext("2d"),l=window.devicePixelRatio||1,m=k.webkitBackingStorePixelRatio||k.mozBackingStorePixelRatio||k.msBackingStorePixelRatio||k.oBackingStorePixelRatio||k.backingStorePixelRatio||1;d.pixelRatio=l/m,d.canvas.insertBefore(h.find(".plot-scrollbar-wrapper"))}function g(b){if(!s.is(":hidden")){var c=(a.xmax-a.xmin)/t.width(),f=a.xend-a.xstart;a.xstart=Math.max(a.xmin,a.xstart+b*c),a.xend=a.xstart+f,a.xend>a.xmax&&(a.xend=a.xmax,a.xstart=a.xend-f),s.css("margin-left",(a.xstart-a.xmin)/c),$.each(a,function(a,b){d(b)}),e(a)}}var h=$('<div class="plot-container"></div>');h[0].dataseries=a,a.container=h[0];var i=$('<div class="plot-toolbar"></div>'),j=$('<img class="plot-tool" id="zoom">').attr("src",n),k=$('<img class="plot-tool plot-tool-enabled" id="zoomin">').attr("src",o),l=$('<img class="plot-tool" id="zoomout">').attr("src",p),m=$('<img class="plot-tool" id="zoomsel">').attr("src",q);if(i.append(j,k,l,m),a.add_plot){i.append('<div class="plot-tool-spacer"></div>Add plot: ');var r=$('<input type="text" size="20" style="margin-bottom:0" id="add-plot">');i.append(r),r.on("keypress",function(b){13==b.which&&(a.add_plot(r.val()),$.each(a,function(a,b){void 0===b.dataseries&&f(b)}),c(h[0],h.width(),h.height()))})}h.append(i),h.append('<div class="plot-scrollbar-wrapper"><div class="plot-scrollbar"><div class="plot-scrollbar-thumb"></div></div></div>'),j.on("click",function(){j.hasClass("plot-tool-enabled")&&(a.sel0=void 0,a.xstart=a.xmin,a.xend=a.xmax,c(h[0],h.width(),h.height()))}),k.on("click",function(){k.hasClass("plot-tool-enabled")&&b((a.xend-a.xstart)/2)}),l.on("click",function(){l.hasClass("plot-tool-enabled")&&b(2*(a.xend-a.xstart))}),m.on("click",function(){if(m.hasClass("plot-tool-enabled")&&a.sel0&&a.sel1){var b=a[0].datax(a.sel0),d=a[0].datax(a.sel1);a.xstart=Math.min(b,d),a.xend=Math.max(b,d),a.sel0=void 0,a.sel1=void 0,c(h[0],h.width(),h.height())}}),$.each(a,function(a,b){f(b)}),a.xstart=a.xmin,a.xend=a.xmax,a.cursor=void 0;var s=h.find(".plot-scrollbar-thumb"),t=h.find(".plot-scrollbar");return s.on("mousedown",function(a){var b=a.pageX;$(document).on("mousemove",function(a){g(a.pageX-b),b=a.pageX}),$(document).on("mouseup",function(){$(document).unbind("mousemove"),$(document).unbind("mouseup")})}),h[0].resize=c,c(h[0],400,300),h[0]}function c(a,b,c){var f=a.dataseries,g=55.5,h=19.5,i=5.5,j=15.5;b=Math.max(150+g+h,b);var k=Math.max(30+i+j,Math.floor((c-60)/f.length));$(a).width(b),$(a).height(c),$.each(f,function(a,c){c.canvas.width(b),c.canvas.height(k),c.canvas[0].width=b*c.pixelRatio,c.canvas[0].height=k*c.pixelRatio,c.canvas[0].getContext("2d").scale(c.pixelRatio,c.pixelRatio),c.bg_image[0].width=b*c.pixelRatio,c.bg_image[0].height=k*c.pixelRatio,c.bg_image[0].getContext("2d").scale(c.pixelRatio,c.pixelRatio),void 0!==c.ylabel&&(g=70.5),void 0!==c.xlabel&&(j=35.5)}),$(a).find(".plot-scrollbar").css("margin-left",g).css("margin-right",h);var l=b-g-h,m=k-i-j,n=(f.xend-f.xstart)/l;$.each(f,function(a,b){var c=(b.ymax-b.ymin)/m;b.plotx=function(a){return(a-f.xstart)/n+g},b.ploty=function(a){return i+(m-(a-b.ymin)/c)},b.datax=function(a){return(a-g)*n+f.xstart},b.left=g,b.top=i,b.wplot=l,b.hplot=m,d(b)}),e(f);var o=f.xstart==f.xmin&&f.xend==f.xmax;if($(a).find("#zoom").toggleClass("plot-tool-enabled",!o),$(a).find("#zoomout").toggleClass("plot-tool-enabled",!o),$(a).find(".plot-scrollbar-thumb").toggle(!o),!o){var p=$(a).find(".plot-scrollbar-thumb"),q=(f.xmax-f.xmin)/l,r=(f.xend-f.xstart)/q,s=(f.xstart-f.xmin)/q;p.css("width",r),p.css("margin-left",s)}}function d(b){var c=b.dataseries.xstart,d=b.dataseries.xend,e=a(c,d,b.wplot/100);e.push(d);var h=b.bg_image[0].getContext("2d");h.clearRect(0,0,b.bg_image[0].width,b.bg_image[0].height),h.fillStyle=i,h.fillRect(b.left,b.top,b.wplot,b.hplot),h.strokeStyle=j,h.fillStyle=g,h.font=k,h.textAlign="center",h.textBaseline="top";var n,o,p=b.xunits||"";for(n=e[0];n<e[2];n+=e[1])o=Math.floor(b.plotx(n))+.5,h.beginPath(),h.moveTo(o,b.top),h.lineTo(o,b.top+b.hplot),h.stroke(),h.fillText(jade.utils.engineering_notation(n,2)+p,o,b.top+b.hplot);var q=a(b.ymin,b.ymax,b.hplot/100);for(h.textAlign="right",h.textBaseline="middle",n=q[0];n<b.ymax;n+=q[1])o=Math.floor(b.ploty(n))+.5,h.beginPath(),h.moveTo(b.left,o),h.lineTo(b.left+b.wplot,o),h.stroke(),h.fillText(jade.utils.engineering_notation(n,2)+b.yunits,b.left-2,o);h.font=l,b.xlabel&&(h.textAlign="center",h.textBaseline="bottom",h.fillText(b.xlabel,b.left+b.wplot/2,b.bg_image[0].height-5)),b.ylabel&&(h.save(),h.textAlign="center",h.textBaseline="top",h.translate(10,b.top+b.hplot/2),h.rotate(-Math.PI/2),h.fillText(b.ylabel,0,0),h.restore()),h.save(),h.beginPath(),h.rect(b.left,b.top,b.wplot,b.hplot),h.clip();for(var r=0;r<b.xvalues.length;r+=1){var s,t,u,v,w=b.xvalues[r],x=b.yvalues[r],y=f(w,c),z=w[y];if(h.strokeStyle=b.color[r]||"#268bd2",h.fillStyle=h.strokeStyle,h.lineWidth=2,"analog"==b.type[r]){for(s=b.plotx(z),t=b.ploty(x[y]),h.beginPath(),h.moveTo(s,t);d>=z&&(y+=1,!(y>w.length))&&(z=w[y],void 0!==z);){var A=b.plotx(z),B=b.ploty(x[y]);h.lineTo(A,B),s=A,t=B,y%100==99&&(h.stroke(),h.beginPath(),h.moveTo(s,t))}h.stroke()}else if("digital"==b.type[r]){u=b.ploty(0),v=b.ploty(1);var C=(u+v)/2;for(s=b.plotx(z),t=x[y],h.beginPath();d>=z&&(y+=1,!(y>w.length))&&(z=w[y],void 0!==z);){var A=b.plotx(z);2!=t?(t=0==t?u:1==t?v:C,h.moveTo(s,t),h.lineTo(A,t)):h.rect(s,u,A-s,v-u),s=A,t=x[y],y%100==99&&(h.stroke(),h.fill(),h.beginPath())}h.stroke(),h.fill()}else if("string"==b.type[r]){u=b.ploty(0),v=b.ploty(1);var D,E=(u+v)/2;for(h.font=m,h.lineWidth=1,h.textAlign="center",h.textBaseline="middle",s=b.plotx(z),t=x[y];d>=z&&(y+=1,!(y>w.length))&&(z=w[y],void 0!==z);){var A=b.plotx(z);if("number"==typeof t)h.beginPath(),h.moveTo(s,E),h.lineTo(A,E),h.stroke();else if(h.strokeRect(s,u,A-s,v-u),void 0===t)h.fillRect(s,u,A-s,v-u);else{D=h.measureText(t).width;var F=Math.max(b.left,s),G=Math.min(b.left+b.wplot,A);G-F>D&&h.fillText(t,(F+G)/2,E)}s=A,t=x[y]}}}h.restore(),h.lineWidth=1,h.strokeStyle=g,h.strokeRect(b.left,b.top,b.wplot,b.hplot),h.strokeRect(5.5,5.5,10,10),h.beginPath(),h.moveTo(7.5,7.5),h.lineTo(13.5,13.5),h.moveTo(13.5,7.5),h.lineTo(7.5,13.5),h.stroke();var H=b.left,I=b.top;b.legend_right=[],b.legend_top=[];for(var r=0;r<b.xvalues.length;r+=1){var D=h.measureText(b.name[r]).width;h.globalAlpha=.7,h.fillStyle=i,h.fillRect(H,I,D+30,20),h.globalAlpha=1,h.fillStyle=b.color[r],h.fillRect(H+5,I+5,10,10),h.strokeRect(H+5,I+5,10,10),h.fillStyle=g,h.textAlign="left",h.textBaseline="bottom",h.fillText(b.name[r],H+20,I+18),b.legend_right.push(H+20+D),b.legend_top.push(I),I+=15}}function e(a){$(a.container).find("#zoomsel").toggleClass("plot-tool-enabled",void 0!==a.sel0&&void 0!==a.sel1),$.each(a,function(b,c){var d=c.canvas[0].getContext("2d");if(d.clearRect(0,0,c.canvas.width(),c.canvas.height()),d.drawImage(c.bg_image[0],0,0,c.canvas.width(),c.canvas.height()),a.sel0&&a.sel1){d.fillStyle="rgba(207,191,194,0.4)";var e=Math.min(a.sel0,a.sel1),j=Math.abs(a.sel0-a.sel1);if(d.fillRect(e,c.top,j,c.hplot),d.strokeStyle="rgba(207,191,194,0.8)",d.lineWidth=1,d.beginPath(),d.moveTo(e,c.top),d.lineTo(e,c.top+c.hplot),d.moveTo(e+j,c.top),d.lineTo(e+j,c.top+c.hplot),d.stroke(),a.sel0!==a.sel1){d.fillStyle="rgb(207,191,194)",d.font=k,d.textAlign="left",d.textBaseline="top";var m=Math.abs(c.datax(a.sel0)-c.datax(a.sel1));d.fillText("dx="+jade.utils.engineering_notation(m,3),e+j+2,c.top)}}if(void 0!==a.cursor){d.lineWidth=1,d.strokeStyle=g,d.beginPath(),d.moveTo(a.cursor,c.top),d.lineTo(a.cursor,c.top+c.hplot),d.stroke();var n=c.datax(a.cursor),o=jade.utils.engineering_notation(n,4);if(c.xunits&&(o+=c.xunits),d.font=k,d.textAlign="center",d.textBaseline="top",d.fillStyle=h,d.fillText("\u2588\u2588\u2588\u2588\u2588\u2588",a.cursor,c.top+c.hplot),d.fillStyle=g,d.fillText(o,a.cursor,c.top+c.hplot),"analog"==c.type[0])for(var p=0;p<c.xvalues.length;p+=1){var q=c.xvalues[p],r=c.yvalues[p],s=f(q,n),t=q[s],u=r[s],v=q[s+1]||t,w=r[s+1]||u,x=u;t!=v&&(x=u+(n-t)/(v-t)*(w-u));var y=c.plotx(n),z=c.ploty(x);d.strokeStyle=c.color[p]||"#268bd2",d.beginPath(),d.arc(y,z,5,0,2*Math.PI),d.stroke();var A=c.legend_right[p],B=c.legend_top[p];o="="+jade.utils.engineering_notation(x,2)+c.yunits,d.font=l;var C=d.measureText(o).width;d.fillStyle=i,d.globalAlpha=.7,d.fillRect(A,B,C+5,20),d.textAlign="left",d.textBaseline="bottom",d.fillStyle=g,d.globalAlpha=1,d.fillText(o,A,B+18)}}})}function f(a,b){for(var c,d=0,e=a.length-1;e>d;)c=d+e>>1,c==d&&(c=e),a[c]<=b?d=c:e=c-1;return d}var g="rgb(0,0,0)",h="rgb(238,238,238)",i="rgb(255,255,255)",j="rgb(220,220,220)",k="8pt sans-serif",l="10pt sans-serif",m='8pt Consolas,"Courier New",monospace',n="data:image/gif;base64,R0lGODlhEAAQAMT/AAAAAP///zAwYT09bpGRqZ6et5iYsKWlvbi40MzM5cXF3czM5OHh5tTU2fDw84uMom49DbWKcfLy8g0NDcDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABQALAAAAAAQABAAAAVZICWOZFlOwCQF5pg2TDMJbDs1DqI8g2TjOsSC0DMBGEGF4UAz3RQ6wiFRLEkmj8WyUC0FBAMpNdWiBCQD8DWCKq98lEkEAiiTAJB53S7Cz/kuECuAIzWEJCEAIf5PQ29weXJpZ2h0IDIwMDAgYnkgU3VuIE1pY3Jvc3lzdGVtcywgSW5jLiBBbGwgUmlnaHRzIFJlc2VydmVkLg0KSkxGIEdSIFZlciAxLjANCgA7",o="data:image/gif;base64,R0lGODlhEAAQAMT/AAAAAP///zAwYT09boSEnIqKopiYsJ6etqurxL+/18XF3dnZ8sXF0OHh5tTU2ePj5piZr2EwAMKXfg0NDcDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABQALAAAAAAQABAAAAVXICWOZFkCE2CWaeMwwLCKQPNMBCQEa/0UAEXiIFhNHKmkYcA7MQgKwMGw2PUgiYkBsWuWBoJpNTWjBATgAECCKgfelHVkUh5NIpJ5XXTP7/kRcH9mgyUhADshACH+T0NvcHlyaWdodCAyMDAwIGJ5IFN1biBNaWNyb3N5c3RlbXMsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4NCkpMRiBHUiBWZXIgMS4wDQoAOw==",p="data:image/gif;base64,R0lGODlhEAAQAMT/AAAAAP///zAwYT09bn19lYSEnJGRqZ6et5iYsJ6etqWlvbi40MzM5cXF3czM5Li4w+Hh5tTU2fDw84uMom49DbWKcQ0NDcDAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABcALAAAAAAQABAAAAVX4CWOZFlagGWWaQQ9lrCKViQVxjQEay0RjYXDMFgBIKmkQsA7PQyLhEHB2PUmDoTisGuWBINpNTW7BAbggKWCKgfelzUFUB4BKJV5XXTP7/kUcH9mgyUhADshACH+T0NvcHlyaWdodCAyMDAwIGJ5IFN1biBNaWNyb3N5c3RlbXMsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC4NCkpMRiBHUiBWZXIgMS4wDQoAOw==",q="data:image/gif;base64,R0lGODlhEAAQAIQBAAAAAP///zAwYT09bpGRqZ6et5iYsKWlvbi40MzM5cXF3czM5OHh5tTU2fDw84uMom49DbWKcfLy8g0NDf///////////////////////////////////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEAAB8ALAAAAAAQABAAAAVY4CeOZFlOwCQF5pg2TDMJbIsCODBIdgMgCgSAsDMBGICgAnCgmSY+IAGQKJYkt5y1FBAMCIdqqvUJSAZebARFXvE+kwgEQCYBIHJ6XXSX710QK38jNYMkIQA7";return{graph:b,tick_interval:a}}(),jade.device_level=function(){function a(a){var b=a.match(/(\w+)\s*\((.*?)\)\s*/),c=$.map(b[2].split(","),jade.utils.parse_number);return{type:b[1],args:c}}function b(b){var c=["ground","jumper"];void 0!==jade.model.libraries.analog&&$.each(jade.model.libraries.analog.modules,function(a,b){c.push(b.get_name())});var d=b.netlist(c,"",{},[]),e=[];return $.each(d,function(b,c){var d=c[0],f=c[1],g=c[2];if("analog:nfet"==d?e.push({type:"nfet",connections:f,properties:{name:g.name,W:jade.utils.parse_number(g.W),L:jade.utils.parse_number(g.L)}}):"analog:pfet"==d?e.push({type:"pfet",connections:f,properties:{name:g.name,W:jade.utils.parse_number(g.W),L:jade.utils.parse_number(g.L)}}):"analog:resistor"==d?e.push({type:"resistor",connections:f,properties:{name:g.name,value:jade.utils.parse_number(g.r)}}):"analog:inductor"==d&&e.push({type:"inductor",connections:f,properties:{name:g.name,value:jade.utils.parse_number(g.l)}}),"analog:capacitor"==d)e.push({type:"capacitor",connections:f,properties:{name:g.name,value:jade.utils.parse_number(g.c)}});else if("analog:v_source"==d)e.push({type:"voltage source",connections:f,properties:{name:g.name,value:a(g.value)}});else if("analog:i_source"==d)e.push({type:"current source",connections:f,properties:{name:g.name,value:a(g.value)}});else if("analog:opamp"==d)e.push({type:"opamp",connections:f,properties:{name:g.name,A:jade.utils.parse_number(g.A)}});else if("analog:diode"==d)e.push({type:"diode",connections:f,properties:{name:g.name,area:jade.utils.parse_number(g.area)}});else if("ground"==d)e.push({type:"ground",connections:[f.gnd],properties:{}});else if("jumper"==d){var h=[];$.each(f,function(a,b){h.push(b)}),e.push({type:"connect",connections:h,properties:{}})}else"analog:v_probe"==d?e.push({type:"voltage probe",connections:f,properties:{name:g.name,color:g.color,offset:jade.utils.parse_number(g.offset)}}):"analog:i_probe"==d?e.push({type:"voltage source",connections:f,properties:{name:g.name,value:{type:"dc",args:[0]}}}):"analog:initial_voltage"==d&&e.push({type:"initial voltage",connections:f,properties:{name:g.name,IV:jade.utils.parse_number(g.IV)}})}),e}function c(a,b){var c={};for(var d in b)c[d]=b[d];var e=a.aspect.connection_points;for(var f in e)e[f][0].display_voltage(a,c);a.aspect.map_over_components(function(b){return b.display_current(a,c),!1})}function d(a){a.remove_annotations();var d=b(a.aspect);if(d.length>0){var e;try{e=new jade.cktsim.Circuit(d)}catch(f){return void a.message(f)}var g;try{g=e.dc(!0)}catch(f){return void a.message("Error during DC analysis:\n\n"+f)}void 0!==g&&a.add_annotation(function(a){c(a,g)})}}function e(a){for(var b=[],c=a.length-1;c>=0;c-=1){var d=a[c],e=d.type,f=d.connections,g=d.properties,h=g.offset;(void 0===h||""===h)&&(h="0"),"voltage probe"==e?b.push([g.color,f.probe,h,"voltage"]):"voltage source"==e&&"dc"==g.value.type&&1==g.value.args.length&&0===g.value.args[0]&&b.push([g.color,"I("+g.name+")",h,"current"])}return b}function f(a){a.remove_annotations();var c="Starting frequency (Hz)",d="Ending frequency (Hz)",f="Name of V or I source for ac",h=b(a.aspect);if(0===e(h).length)return void a.message("AC Analysis: there are no voltage probes in the diagram!");var i=a.aspect.module,j={};j[c]=jade.build_input("text",10,i.properties.ac_fstart||"10"),j[d]=jade.build_input("text",10,i.properties.ac_fstop||"1G"),j[f]=jade.build_input("text",10,i.properties.ac_source);var k=jade.build_table(j);a.dialog("AC Analysis",k,function(){var b=j[c].value,e=j[d].value,k=j[f].value;i.set_property("ac_fstart",b),i.set_property("ac_fstop",e),i.set_property("ac_source",k),b=jade.utils.parse_number_alert(b),e=jade.utils.parse_number_alert(e),void 0!==b&&void 0!==e&&g(h,a,b,e,k)})}function g(a,b,c,d,f){var g=50;if(a.length>0){var h,j=new jade.cktsim.Circuit(a);try{h=j.ac(g,c,d,f)}catch(k){return void b.message("Error during AC analysis:\n\n"+k)}if("string"==typeof h)b.message(h);else if(h instanceof Error)b.message(h.stack.split("\n").join("<br>"));else{var l,m,n,o=h._frequencies_;for(l=o.length-1;l>=0;l-=1)o[l]=Math.log(o[l])/Math.LN10;var p,q,r,s=e(a),t=[],u=[];for(l=s.length-1;l>=0;l-=1)"voltage"==s[l][3]&&(u[l]=s[l][0],p=s[l][1],n=h[p].magnitude,t[l]=i(n));var v=i(t);if(1e-16>v)b.message("Zero ac response, -infinity on DB scale.");else for(l=s.length-1;l>=0;l-=1)if("voltage"==s[l][3]&&t[l]/v<1e-10)return void b.message("Near zero ac response, remove "+u[l]+" probe");var w=[];for(l=s.length-1;l>=0;l-=1)if("voltage"==s[l][3]){q=s[l][0],p=s[l][1],r=s[l][2],n=h[p].magnitude;var x=1;for(m=n.length-1;m>=0;m-=1)n[m]=20*Math.log(n[m]/x)/Math.LN10;w.push({xvalues:[o],yvalues:[n],name:[p],color:[q],ylabel:"Magnitude",yunits:"dB",type:["analog"]}),w.push({xvalues:[o],yvalues:[h[p].phase],name:[p],color:[q],xlabel:"log(Frequency in Hz)",ylabel:"Phase",yunits:"\xb0",type:["analog"]})}var y=jade.plot.graph(w);b.window("Results of AC Analysis",y)}}}function h(a,b,c){if(void 0===c)return void 0;for(var d=0;d<b.length;d+=1)if(a<b[d]){var e=0===d?b[0]:b[d-1],f=b[d];if(void 0===f)return void 0;var g=0===d?c[0]:c[d-1],h=c[d],i=g;return a!=e&&(i+=(a-e)*(h-g)/(f-e)),i}return void 0}function i(a){for(var b=-1/0,c=a.length-1;c>=0;c-=1)a[c]>b&&(b=a[c]);return b}function j(a){a.remove_annotations();var c="Stop Time (seconds)",d=b(a.aspect);if(0===e(d).length)return void a.message("Transient Analysis: there are no probes in the diagram!");var f=a.aspect.module,g={};g[c]=jade.build_input("text",10,f.properties.tran_tstop);var h=jade.build_table(g);a.dialog("Transient Analysis",h,function(){f.set_property("tran_tstop",g[c].value);var b=jade.utils.parse_number_alert(f.properties.tran_tstop);if(d.length>0&&void 0!==b){for(var h=e(d),i={},j=h.length-1;j>=0;j-=1)i[j]=h[j][1];var l=jade.progress_report();a.window("Progress",l),jade.cktsim.transient_analysis(d,b,i,function(b,c){return void 0===c?(l[0].update_progress(b),l[0].stop_requested):(jade.window_close(l.win),void k(c,a,h))})}})}function k(a,b,c){var d;if("string"==typeof a)b.message("Error during Transient analysis:\n\n"+a);else if(void 0===a)b.message("Sorry, no results from transient analysis to plot!");else{for(var e=[],f=c.length-1;f>=0;f-=1){var g=c[f][0],h=c[f][1];d=a[h],void 0===d?b.message("The "+g+' probe is connected to node "'+h+'" which is not an actual circuit node'):"x-axis"!=g&&e.push({xvalues:[d.xvalues],yvalues:[d.yvalues],name:[h],color:[g],xunits:"s",yunits:"voltage"==c[f][3]?"V":"A",type:["analog"]})}var i=jade.plot.graph(e);b.window("Results of Transient Analysis",i)}}return jade.model.ConnectionPoint.prototype.display_voltage=function(a,b){var c=b[this.label];if(void 0!==c){var d=c.toFixed(2)+"V";a.c.globalAlpha=.85,this.parent.draw_text(a,"\u2588\u2588\u2588",this.offset_x,this.offset_y,4,a.annotation_font,a.background_style),a.c.globalAlpha=1,this.parent.draw_text(a,d,this.offset_x,this.offset_y,4,a.annotation_font,a.annotation_style),delete b[this.label]}},jade.model.Component.prototype.display_current=function(a,b){if("analog:i_probe"==this.type()){var c="I("+this.name+")",d=b[c];if(void 0!==d){var e=jade.utils.engineering_notation(d,2)+"A";this.draw_text(a,e,8,5,1,a.annotation_font,a.annotation_style),delete b[c]}}},jade.schematic_view.schematic_tools.push(["DC","DC","DC Analysis",d]),jade.schematic_view.schematic_tools.push(["AC","AC","AC Analysis",f]),jade.schematic_view.schematic_tools.push(["tran","TRAN","Transient Analysis",j]),{device_netlist:b,interpolate:h}}(),jade.cktsim=function(){function a(a){$.each(a,function(a,b){var c=[];for(var d in b.connections)c.push(d+"="+b.connections[d]);var e=[];for(var f in b.properties)e.push(f+"="+JSON.stringify(b.properties[f]));console.log(b.type+" "+c.join(" ")+"; "+e.join(" "))})}function b(a,b,c,d){if(a.length>0){var f,g,h,i,j,k,l,m,p,q,r=new e(a,d);if(void 0!==b.source){if(f=r.device_map[b.source],!(f instanceof n||f instanceof o))throw"Device not independent source in DC sweep: "+b.source;g=b.start,h=b.stop,i=b.step,i=h>=g?Math.abs(i):-Math.abs(i),j=f.src}if(void 0!==c.source){if(k=r.device_map[c.source],!(k instanceof n||k instanceof o))throw"Device not independent source in DC sweep: "+c.source;l=c.start,m=c.stop,p=c.step,p=m>=l?Math.abs(p):-Math.abs(p),q=k.src}for(var s=g,t=l,u={_sweep1_:[],_network_:r},w=[];;){void 0!==f&&(f.src=v({type:"dc",args:[s]})),void 0!==k&&(k.src=v({type:"dc",args:[t]}));var x=r.dc(!0);for(var y in x)"_network_"!=y&&(void 0===u[y]&&(u[y]=[]),u[y].push(x[y]));if(u._sweep1_.push(s),u._sweep2_=t,void 0===s)break;if(s==h){if(void 0===t)break;if(w.push(u),t==m){u=w;break}u={_sweep1_:[],_network_:r},s=g,t+=p,(p>0&&t>m||0>p&&m>t)&&(t=m)}else s+=i,(i>0&&s>h||0>i&&h>s)&&(s=h)}return void 0!==j&&(f.src=j),void 0!==q&&(k.src=q),u}return void 0}function c(a,b,c,d,f){var g=50;if(a.length>0){var h=new e(a,f);return h.ac(g,b,c,d)}return void 0}function d(a,b,c,d,f){if(a.length>0&&void 0!==b){var g=new e(a,f),h={};h.probe_names=c,h.update_interval=250,h.finish=function(a){d(void 0,a)},h.stop_requested=!1,h.update=function(a){d(a,void 0)&&(h.stop_requested=!0)};try{g.tran_start(h,100,0,b)}catch(i){h.finish(i)}}return void 0}function e(a,b){b&&(b.v_abstol&&(B=b.v_abstol),b.i_abstol&&(C=b.ia_abstol,L=Math.sqrt(C)),b.reltol&&(J=b.reltol,M=Math.sqrt(J))),this.node_map={},this.ntypes=[],this.devices=[],this.device_map={},this.voltage_sources=[],this.current_sources=[],this.initial_voltages=[],this.finalized=!1,this.diddc=!1,this.node_index=-1,this.periods=1,void 0!==a&&this.load_netlist(a)}function f(a,b){for(var c=new Array(a),d=a-1;d>=0;d-=1){c[d]=new Array(b);for(var e=b-1;e>=0;e-=1)c[d][e]=0}return c}function g(a,b,c,d){var e=a.length,f=a[0].length;if(e!=c.length||f!=b.length)throw"Rows of M mismatched to b or cols mismatch to x.";for(var g=0;e>g;g+=1){for(var h=0,i=0;f>i;i+=1)h+=a[g][i]*b[i];c[g]=d*h}}function h(a,b,c,d,e){var f,g,h=a.length,i=a[0].length;if(h>b.length||i>b[0].length)throw"Row or columns of A to large for B";if(h>e.length||i>e[0].length)throw"Row or columns of A to large for C";if("number"==typeof c&&"number"==typeof d)for(f=0;h>f;f+=1)for(g=0;i>g;g+=1)e[f][g]=c*a[f][g]+d*b[f][g];else if("number"==typeof d&&c instanceof Array)for(f=0;h>f;f+=1)for(g=0;i>g;g+=1)e[f][g]=c[f]*a[f][g]+d*b[f][g];else{if(!(typeof d instanceof Array&&c instanceof Array))throw"scalea and scaleb must be scalars or Arrays";for(f=0;h>f;f+=1)for(g=0;i>g;g+=1)e[f][g]=c[f]*a[f][g]+d[f]*b[f][g]}}function i(a,b){var c=a.length,d=a[0].length;if(c>b.length||d>b[0].length)throw"Rows or cols > rows or cols of dest";for(var e=0;c>e;e+=1)for(var f=0;d>f;f+=1)b[e][f]=a[e][f]}function j(a){var b,c,d,e,g,h=a.length,j=a[0].length,k=f(h,j);i(a,k);var l=0;for(e=h-1;e>=0;e-=1)for(g=h-1;g>=0;g-=1)Math.abs(k[e][g])>l&&(l=Math.abs(k[e][g]));var m=0,n=0;for(e=0;h>e;e+=1)for(g=n;j>g;g+=1){var o=Math.abs(k[e][g]),p=e;for(c=e+1;h>c;c+=1)b=Math.abs(k[c][g]),b>o&&(o=b,p=c);if(Math.abs(o)>D*l){for(n=g+1,m+=1,b=k[e],k[e]=k[p],k[p]=b,c=e+1;h>c;c+=1)if(b=k[c][g]/k[e][g],0!==b)for(d=g;j>d;d+=1)k[c][d]-=k[e][d]*b;break}}return m}function k(a,b){var c,d,e,f,g=a.length,h=a[0].length;if(null!==b)for(c=g-1;c>=0;c-=1)a[c][h-1]=b[c];var i=0,j=g-1;for(c=0;g>c;c+=1){var k=c,l=0;for(d=c;g>d;d+=1){f=a[d];var m=0;for(e=h-2;e>=0;e-=1)m+=f[e]*f[e];(c==d||m>l)&&(k=d,l=m)}if(k>c){var n=a[c];a[c]=a[k],a[k]=n}var o=Math.sqrt(l);0===c&&(i=o);var p;if(!(o>i*D)){j=c-1;break}for(p=1/o,f=a[c],e=h-1;e>=0;e-=1)f[e]*=p;for(d=c+1;g>d;d+=1){var q=a[d],r=0;for(e=h-2;e>=0;e-=1)r+=f[e]*q[e];for(e=h-1;e>=0;e-=1)q[e]-=r*f[e]}}var s=new Array(h-1);for(e=h-2;e>=0;e-=1)s[e]=0;for(c=j;c>=0;c-=1)for(f=a[c],e=h-2;e>=0;e-=1)s[e]+=f[e]*f[h-1];return s}function l(a,b){var c,d,e,f=a.length;if(null!==b)for(var g=0;f>g;g+=1)a[g][f]=b[g];for(var h=0;f>h;h+=1){var i=Math.abs(a[h][h]),j=h;for(d=h+1;f>d;d+=1)c=Math.abs(a[d][h]),c>i&&(i=c,j=d);for(0===i?a[h][h]=D:(c=a[h],a[h]=a[j],a[j]=c),d=h+1;f>d;d+=1)if(c=a[d][h]/a[h][h],0!==c)for(e=h;f>=e;e+=1)a[d][e]-=a[h][e]*c}var k=new Array(f);for(d=f-1;d>=0;d-=1){for(c=a[d][f],e=f-1;e>d;e-=1)c-=a[d][e]*k[e];k[d]=c/a[d][d]}return k}function m(){}function n(a,b,c,d){m.call(this),this.src=v(d),this.npos=a,this.nneg=b,this.branch=c}function o(a,b,c){m.call(this),this.src=v(c),this.npos=a,this.nneg=b}function p(a,b,c){m.call(this),this.n1=a,this.n2=b,this.g=1/c}function q(a,b,c,d){m.call(this),this.anode=a,this.cathode=b,this.area=c,this.type=d,this.is=1e-14,this.ais=this.area*this.is,this.vt="normal"==d?.0258:1e-4,this.exp_arg_max=50,this.exp_max=Math.exp(this.exp_arg_max)}function r(a,b,c){m.call(this),this.n1=a,this.n2=b,this.value=c}function s(a,b,c,d){m.call(this),this.n1=a,this.n2=b,this.branch=c,this.value=d}function t(a,b,c,d,e,f,g){m.call(this),this.np=a,this.nn=b,this.no=c,this.ng=d,this.branch=e,this.gain=f,this.name=g}function u(a,b,c,d,e,f,g){if("n"!=g&&"p"!=g)throw f+" fet type is not n or p";m.call(this),this.d=a,this.g=b,this.s=c,this.name=f,this.W=d,this.L=e,this.ratio=d/e,this.type_sign="n"==g?1:-1,this.vt=.5,this.kp="n"==g?12e-5:25e-6,this.beta=this.kp*this.ratio,this.lambda=.05,this.g_leak=1e-8*this.beta}function v(a){var b={};b.fun=a.type,b.args=a.args,b.period=0,b.value=function(){return 0},b.inflection_point=function(){return void 0};var c,d,e,f,g,h,i;if("dc"==b.fun){var j=x(b.args,0,0);b.args=[j],b.value=function(){return j
}}else if("impulse"==b.fun){var k=x(b.args,0,1),l=Math.abs(x(b.args,2,1e-9));b.args=[k,l],w(b,[0,0,l/2,k,l,0],!1)}else if("step"==b.fun)c=x(b.args,0,0),d=x(b.args,1,1),g=Math.max(0,x(b.args,2,0)),h=Math.abs(x(b.args,3,1e-9)),b.args=[c,d,g,h],w(b,[g,c,g+h,d],!1);else if("square"==b.fun){c=x(b.args,0,0),d=x(b.args,1,1),e=Math.abs(x(b.args,2,1));var m=Math.min(100,Math.abs(x(b.args,3,50)));b.args=[c,d,e,m],f=0===e?1/0:1/e;var n=.01*f,o=.01*m*.98*f;w(b,[0,c,n,d,n+o,d,n+o+n,c,f,c],!0)}else if("triangle"==b.fun)c=x(b.args,0,0),d=x(b.args,1,1),e=Math.abs(x(b.args,2,1)),b.args=[c,d,e],f=0===e?1/0:1/e,w(b,[0,c,f/2,d,f,c],!0);else if("pwl"==b.fun||"pwl_repeating"==b.fun)w(b,b.args,"pwl_repeating"==b.fun);else if("pulse"==b.fun){c=x(b.args,0,0),d=x(b.args,1,1),g=Math.max(0,x(b.args,2,0));var p=Math.abs(x(b.args,3,1e9));h=Math.abs(x(b.args,4,1e-10)),i=Math.abs(x(b.args,5,1e-10)),f=Math.abs(x(b.args,6,1e9)),b.args=[c,d,g,h,i,p,f];var q=g,r=q+h,s=r+p,t=s+i;w(b,[q,c,r,d,s,d,t,c,f,c],!0)}else if("sin"==b.fun){e=Math.abs(x(b.args,0,1)),b.period=1/e;var u=x(b.args,1,0),v=x(b.args,2,1);g=Math.max(0,x(b.args,3,0));var y=x(b.args,4,0);b.args=[u,v,e,g,y],y/=360,b.value=function(a){return g>a?u+v*Math.sin(2*Math.PI*y):u+v*Math.sin(2*Math.PI*(e*(a-g)+y))},b.inflection_point=function(a){return g>a?g:void 0}}return b.dc=b.value(0),b}function w(a,b,c){var d=b.length;a.tvpairs=b,c&&(a.period=b[d-2]),d%2==1&&(d-=1),2>=d?(a.value=function(){return 2==d?b[1]:0},a.inflection_point=function(){return void 0}):(a.value=function(a){c&&(a=Math.fmod(a,b[d-2]));var e=b[0],f=b[1];if(a>e)for(var g,h,i=2;d>i;i+=2){if(g=b[i],h=b[i+1],g>e&&g>a)return f+(h-f)*(a-e)/(g-e);e=g,f=h}return f},a.inflection_point=function(a){c&&(a=Math.fmod(a,b[d-2]));for(var e=0;d>e;e+=2){var f=b[e];if(f>a)return f}return void 0})}function x(a,b,c){var d=a[b];return void 0===d&&(d=c),d}var y=0,z=1,A=.3,B=1e-6,C=1e-12,D=1e-12,E=1e3,F=20,G=2,H=8,I=4,J=1e-4,K=10,L=Math.sqrt(C),M=Math.sqrt(J);e.prototype.history=function(a){return void 0===this.result||void 0===this.result[a]?void 0:{xvalues:this.result._xvalues_,yvalues:this.result[a]}},e.prototype.result_type=function(){return"analog"},e.prototype.node_list=function(){var a=[];for(var b in this.results)a.push(b);return a},e.prototype.gnd_node=function(){return-1},e.prototype.node=function(a,b){return this.node_index+=1,a&&(this.node_map[a]=this.node_index),this.ntypes.push(b),this.node_index},e.prototype.finalize=function(){if(!this.finalized){this.finalized=!0,this.N=this.node_index+1;for(var a=this.devices.length-1;a>=0;a-=1)this.devices[a].finalize(this);for(this.matrix=f(this.N,this.N+1),this.Gl=f(this.N,this.N),this.G=f(this.N,this.N),this.C=f(this.N,this.N),this.soln_max=new Array(this.N),this.abstol=new Array(this.N),this.solution=new Array(this.N),this.rhs=new Array(this.N),a=this.N-1;a>=0;a-=1)this.soln_max[a]=0,this.abstol[a]=this.ntypes[a]==y?B:C,this.solution[a]=0,this.rhs[a]=0;for(a=0;a<this.initial_voltages.length;a+=1){var b=this.initial_voltages[a].node,c=this.initial_voltages[a].v;this.solution[b]=c,this.soln_max[b]=c}for(a=this.devices.length-1;a>=0;a-=1)this.devices[a].load_linear(this);var d=this.voltage_sources.length;if(d>0){var e=f(d,this.N);for(a=d-1;a>=0;a-=1)for(var g=this.voltage_sources[a].branch,h=this.N-1;h>=0;h-=1)e[a][h]=this.Gl[g][h];var i=j(e);if(d>i)throw"Warning!!! Circuit has a voltage source loop or a source or current probe shorted by a wire, please remove the source or the wire causing the short."}}return!0},e.prototype.load_netlist=function(a){var b,c,d,e,f,g;for(b=a.length-1;b>=0;b-=1)if("ground"==a[b].type)for(f=a[b].connections,c=0;c<f.length;c+=1)d=f[c],this.node_map[d]=this.gnd_node();var h={};for(b=a.length-1;b>=0;b-=1)if("connect"==a[b].type){if(f=a[b].connections,f.length<=1)continue;var i=f[0];for(c=1;c<f.length;c+=1)if(d=f[c],void 0!==this.node_map[d]){i=d;break}for(;void 0!==h[i];)i=h[i];for(c=1;c<f.length;c+=1){for(d=f[c];void 0!==h[d];)d=h[d];h[d]=i}}var j=!1;for(this.counts={},b=a.length-1;b>=0;b-=1){e=a[b];var k=e.type,l=e.properties;this.counts[k]=(this.counts[k]||0)+1;var f={};for(d in e.connections){for(g=e.connections[d];void 0!==h[g];)g=h[g];var m=this.node_map[g];void 0===m?m=this.node(g,y):m==this.gnd_node()&&(j=!0),f[d]=m}var n=l.name;switch(k){case"resistor":this.r(f.n1,f.n2,l.value,n);break;case"diode":this.d(f.anode,f.cathode,l.area,l.type,n);break;case"capacitor":this.c(f.n1,f.n2,l.value,n);break;case"inductor":break;case"voltage source":this.v(f.nplus,f.nminus,l.value,n);break;case"current source":this.i(f.nplus,f.nminus,l.value,n);break;case"opamp":this.opamp(f.nplus,f.nminus,f.output,f.gnd,l.A,n);break;case"nfet":this.n(f.D,f.G,f.S,l.W,l.L,n);break;case"pfet":this.p(f.D,f.G,f.S,l.W,l.L,n);break;case"voltage probe":break;case"ground":break;case"connect":break;case"initial voltage":this.initial_voltages.push({node:f.node,v:l.IV});break;default:throw"Unrecognized device type "+k}}if(!j)throw"Please make at least one connection to ground (node gnd)";for(g in h){for(d=g;void 0!==h[d];)d=h[d];b=this.node_map[d],void 0!==b&&(this.node_map[g]=b)}this.find_cmos_gates();var o=(this.node_index+1).toString()+" nodes";this.size=0;for(var p in this.counts)o+=", "+this.counts[p].toString()+" "+p,this.size+=this.counts[p]},e.prototype.find_cmos_gates=function(){var a={};$.each(this.devices,function(b,c){c instanceof u&&(void 0===a[c.d]&&(a[c.d]=[]),a[c.d].push(c),void 0===a[c.s]&&(a[c.s]=[]),a[c.s].push(c))});var b=[];$.each(a,function(a,c){var d=!1,e=!1;$.each(c,function(a,b){1==b.type_sign?d=!0:e=!0}),d&&e&&b.push(a)}),this.counts.cmos_gates=b.length},e.prototype.find_solution=function(a,b){for(var c,d,e,f=this.solution,g=this.rhs,h=[],i=0,j=!1,l=0,m=0;b>m;m+=1){var n;for(a.call(this,f,g),e=0,n=this.N-1;n>=0;n-=1)this.ntypes[n]==y&&(e+=Math.abs(g[n]));if(m>0&&j===!1&&e>i){for(n=this.N-1;n>=0;n-=1)f[n]-=h[n];m-=1,j=!0}else h=k(this.matrix,g),i>e?l+=1:l=0,l>10&&(j=!1,l=0),i=e;for((0===m||e>c)&&(c=e),d=b-1>m&&e>L+M*c?!1:!0,n=this.N-1;n>=0;n-=1){j&&this.ntypes[n]==y&&(h[n]=h[n]>A?A:h[n],h[n]=h[n]<-A?-A:h[n]),f[n]+=h[n];var o=this.abstol[n]+J*this.soln_max[n];Math.abs(h[n])>o&&(d=!1,this.problem_node=n)}if(d===!0){for(n=this.N-1;n>=0;n-=1)Math.abs(f[n])>this.soln_max[n]&&(this.soln_max[n]=Math.abs(f[n]));return m+1}}return void 0},e.prototype.load_dc=function(a,b){g(this.Gl,a,b,-1),i(this.Gl,this.G);for(var c=this.devices.length-1;c>=0;c-=1)this.devices[c].load_dc(this,a,b);i(this.G,this.matrix)},e.prototype.dc=function(a){if(this.finalize()===!1)return void 0;var b=this.find_solution(e.prototype.load_dc,E);if("undefined"==typeof b){if(a)throw this.current_sources.length>0?"Unable to find circuit's operating point: do your current sources have a conductive path to ground?":"Unable to find circuit's operating point: is there a loop in your circuit that's oscillating?";return!1}if(this.diddc=!0,a){this.result={};for(var c in this.node_map){var d=this.node_map[c];this.result[c]=-1==d?0:this.solution[d]}for(var f=this.voltage_sources.length-1;f>=0;f-=1){var g=this.voltage_sources[f];this.result["I("+g.name+")"]=this.solution[g.branch]}return this.result._network_=this,this.result}return!0},e.prototype.tran_start=function(a,b,c,d){var e;for(this.diddc===!1?this.dc(!1)||(this.finalized=!1,this.finalize()===!1&&a.finish(void 0)):this.finalize()===!1&&a.finish(void 0),this.response=new Array(this.N+1),e=this.N;e>=0;e-=1)this.response[e]=[];for(this.old3sol=new Array(this.N),this.old3q=new Array(this.N),this.old2sol=new Array(this.N),this.old2q=new Array(this.N),this.oldsol=new Array(this.N),this.oldq=new Array(this.N),this.q=new Array(this.N),this.oldc=new Array(this.N),this.c=new Array(this.N),this.alpha0=1,this.alpha1=0,this.alpha2=0,this.beta0=new Array(this.N),this.beta1=new Array(this.N),this.ar=this.algebraic(this.C),this.ltecheck=new Array(this.N),e=this.N;e>=0;e-=1)this.ltecheck[e]=0===this.ar[e];for(var f in this.node_map){var g=this.node_map[f];for(e=a.probe_names.length-1;e>=0;e-=1)if(f==a.probe_names[e]){this.ltecheck[g]=!0;break}}var h,i=d-c;for(e=this.voltage_sources.length-1;e>=0;e-=1)h=this.voltage_sources[e].src.period,h>0&&(i=Math.min(i,h));for(e=this.current_sources.length-1;e>=0;e-=1)h=this.current_sources[e].src.period,h>0&&(i=Math.min(i,h));for(this.periods=Math.ceil((d-c)/i),this.max_nsteps=5e4*this.periods,this.time=c,this.max_step=(d-c)/(this.periods*b),this.min_step=this.max_step/1e8,this.new_step=this.max_step/1e6,this.oldt=this.time-this.new_step,this.load_tran(this.solution,this.rhs),e=this.N-1;e>=0;e-=1)this.old3sol[e]=this.solution[e],this.old2sol[e]=this.solution[e],this.oldsol[e]=this.solution[e],this.old3q[e]=this.q[e],this.old2q[e]=this.q[e],this.oldq[e]=this.q[e],this.oldc[e]=this.c[e];this.tstart=c,this.tstop=d,this.progress=a,this.step_index=-3;try{this.tran_steps((new Date).getTime()+a.update_interval)}catch(j){a.finish(j)}},e.prototype.pick_step=function(){for(var a=1/H,b=G,c=this.time-this.oldt,d=this.time-this.old2t,e=this.time-this.old3t,f=this.oldt-this.old2t,g=this.oldt-this.old3t,h=this.old2t-this.old3t,i=d*e/(f*g),j=c*e/(-f*h),k=c*d/(g*h),l=.5*(this.time-this.oldt)/(this.time-this.old3t),m=0,n=this.N-1;n>=0;n-=1)if(this.ltecheck[n]){var o=i*this.oldsol[n]+j*this.old2sol[n]+k*this.old3sol[n],p=Math.abs(this.solution[n]-o)*l,q=p/(K*(this.abstol[n]+J*this.soln_max[n]));m=Math.max(m,q)}var r,s=1/Math.pow(m,1/3);return 1>s?(s=Math.max(s,a),r=.75*(this.time-this.oldt)*s,r=Math.max(r,this.min_step)):(s=Math.min(s,b),r=s>1.2?(this.time-this.oldt)*s/1.2:this.time-this.oldt,r=Math.min(r,this.max_step)),r},e.prototype.load_tran=function(a,b){g(this.Gl,a,this.c,-1),i(this.Gl,this.G);for(var c=this.devices.length-1;c>=0;c-=1)this.devices[c].load_tran(this,a,this.c,this.time);for(g(this.C,a,this.q,1),c=this.N-1;c>=0;c-=1){var d=this.alpha0*this.q[c]+this.alpha1*this.oldq[c]+this.alpha2*this.old2q[c];b[c]=this.beta0[c]*this.c[c]+this.beta1[c]*this.oldc[c]-d}h(this.G,this.C,this.beta0,this.alpha0,this.matrix)},e.prototype.tran_steps=function(a){var b;if(!this.progress.stop_requested)for(;this.step_index<this.max_nsteps;){for(b=this.N-1;b>=0;b-=1)this.step_index>=0&&this.response[b].push(this.solution[b]),this.oldc[b]=this.c[b],this.old3sol[b]=this.old2sol[b],this.old2sol[b]=this.oldsol[b],this.oldsol[b]=this.solution[b],this.old3q[b]=this.oldq[b],this.old2q[b]=this.oldq[b],this.oldq[b]=this.q[b];if(this.step_index<0)this.old3t=this.old2t-(this.oldt-this.old2t),this.old2t=this.oldt-(this.tstart-this.oldt),this.oldt=this.tstart-(this.time-this.oldt),this.time=this.tstart,this._beta0=1,this._beta1=0;else{if(this.response[this.N].push(this.time),this.old3t=this.old2t,this.old2t=this.oldt,this.oldt=this.time,this.time>=this.tstop)break;this.time+this.new_step>this.tstop?this.time=this.tstop:this.time+=this.time+1.5*this.new_step>this.tstop?2/3*(this.tstop-this.time):this.new_step,this._beta0=.5,this._beta1=.5}for(b=this.N-1;b>=0;b-=1)this.beta0[b]=this._beta0+this.ar[b]*this._beta1,this.beta1[b]=(1-this.ar[b])*this._beta1;for(;;){if(this.alpha0=1/(this.time-this.oldt),this.alpha1=-this.alpha0,this.alpha2=0,this.time-this.oldt<1e-4*this.tstop)for(b=this.N-1;b>=0;b-=1)this.beta0[b]=1,this.beta1[b]=0;var c=this.find_solution(e.prototype.load_tran,F);if(void 0!==c&&(this.step_index<=0||this.time-this.oldt<(1+J)*this.min_step)){this.step_index>0&&(this.new_step=G*this.min_step);break}if(void 0===c)this.time=this.oldt+(this.time-this.oldt)/I;else{if(this.new_step=this.pick_step(),!(this.new_step<(1-J)*(this.time-this.oldt)))break;this.time=this.oldt+this.new_step}}this.step_index+=1;var d=(new Date).getTime();if(d>=a){var f=Math.round(100*(this.time-this.tstart)/(this.tstop-this.tstart));this.progress.update(f);var g=this;return void setTimeout(function(){try{g.tran_steps(d+g.progress.update_interval)}catch(a){g.progress.finish(a)}},1)}}this.result={};for(var h in this.node_map){var i=this.node_map[h];this.result[h]=-1==i?0:this.response[i]}for(b=this.voltage_sources.length-1;b>=0;b-=1){var j=this.voltage_sources[b];this.result["I("+j.name+")"]=this.response[j.branch]}throw this.result._xvalues_=this.response[this.N],this.result._network_=this,this.result},e.prototype.ac=function(a,b,c,d){var e;this.dc(!0);var g=this.N,h=this.G,i=this.C,j=f(2*g,2*g+1);if(void 0===this.device_map[d])throw"AC analysis refers to unknown source "+d;this.device_map[d].load_ac(this,this.rhs);var k=new Array(2*g+1);for(e=2*g;e>=0;e-=1)k[e]=[];var m=Math.exp(Math.LN10/a),n=new Array(g);for(e=g-1;e>=0;e-=1)n[e]=0;var o=b;for(c*=1.0001;c>=o;){var p=2*Math.PI*o;for(k[2*g].push(o),e=g-1;e>=0;e-=1){j[e][2*g]=this.rhs[e],j[e+g][2*g]=0;for(var q=g-1;q>=0;q-=1)j[e][q]=h[e][q],j[e+g][q+g]=h[e][q],j[e][q+g]=-p*i[e][q],j[e+g][q]=p*i[e][q]}var r=l(j,null);for(e=g-1;e>=0;e-=1){var s=Math.sqrt(r[e]*r[e]+r[e+g]*r[e+g]);k[e].push(s);var t=180*(Math.atan2(r[e+g],r[e])/Math.PI),u=k[e+g],v=u.length;if(v>1){var w=t+n[e]-u[v-1];w>90?n[e]-=360:-90>w&&(n[e]+=360)}k[e+g].push(t+n[e])}o*=m}this.result={};for(var x in this.node_map){var y=this.node_map[x];this.result[x]={magnitude:-1==y?0:k[y],phase:-1==y?0:k[y+g]}}return this.result._frequencies_=k[2*g],this.result._network_=this,this.result},e.prototype.add_device=function(a,b){return this.devices.push(a),a.name=b,b&&(this.device_map[b]=a),a},e.prototype.r=function(a,b,c,d){if(0!==c){var e=new p(a,b,c);return this.add_device(e,d)}return this.v(a,b,"0",d)},e.prototype.d=function(a,b,c,d,e){if(0!==c){var f=new q(a,b,c,d);return this.add_device(f,e)}return void 0},e.prototype.c=function(a,b,c,d){var e=new r(a,b,c);return this.add_device(e,d)},e.prototype.l=function(a,b,c,d){var e=this.node(void 0,z),f=new s(a,b,e,c);return this.add_device(f,d)},e.prototype.v=function(a,b,c,d){var e=this.node(void 0,z),f=new n(a,b,e,c);return this.voltage_sources.push(f),this.add_device(f,d)},e.prototype.i=function(a,b,c,d){var e=new o(a,b,c);return this.current_sources.push(e),this.add_device(e,d)},e.prototype.opamp=function(a,b,c,d,e,f){var g=this.node(void 0,z),h=new t(a,b,c,d,g,e,f);return this.add_device(h,f)},e.prototype.n=function(a,b,c,d,e,f){var g=new u(a,b,c,d,e,f,"n");return this.add_device(g,f)},e.prototype.p=function(a,b,c,d,e,f){var g=new u(a,b,c,d,e,f,"p");return this.add_device(g,f)},e.prototype.add_two_terminal=function(a,b,c,d){a>=0?(d[a][a]+=c,b>=0&&(d[a][b]-=c,d[b][a]-=c,d[b][b]+=c)):b>=0&&(d[b][b]+=c)},e.prototype.get_two_terminal=function(a,b,c){var d=0;return a>=0&&(d=c[a]),b>=0&&(d-=c[b]),d},e.prototype.add_conductance_l=function(a,b,c){this.add_two_terminal(a,b,c,this.Gl)},e.prototype.add_conductance=function(a,b,c){this.add_two_terminal(a,b,c,this.G)},e.prototype.add_capacitance=function(a,b,c){this.add_two_terminal(a,b,c,this.C)},e.prototype.add_to_Gl=function(a,b,c){a>=0&&b>=0&&(this.Gl[a][b]+=c)},e.prototype.add_to_G=function(a,b,c){a>=0&&b>=0&&(this.G[a][b]+=c)},e.prototype.add_to_C=function(a,b,c){a>=0&&b>=0&&(this.C[a][b]+=c)},e.prototype.add_to_rhs=function(a,b,c){a>=0&&(c[a]+=b)},e.prototype.algebraic=function(a){var b=a.length,c=f(b,b);i(a,c);for(var d,e=j(c),g=new Array(b),h=0;b>h;h+=1){for(d=b-1;d>=0;d-=1)c[h][d]=0;if(j(c)==e)g[h]=1;else{for(d=b-1;d>=0;d-=1)c[h][d]=a[h][d];g[h]=0}}return g},m.prototype.finalize=function(){},m.prototype.load_linear=function(){},m.prototype.load_dc=function(){},m.prototype.load_tran=function(){},m.prototype.load_ac=function(){},n.prototype=new m,n.prototype.constructor=n,n.prototype.load_linear=function(a){a.add_to_Gl(this.branch,this.npos,1),a.add_to_Gl(this.branch,this.nneg,-1),a.add_to_Gl(this.npos,this.branch,1),a.add_to_Gl(this.nneg,this.branch,-1)},n.prototype.load_dc=function(a,b,c){a.add_to_rhs(this.branch,this.src.dc,c)},n.prototype.load_tran=function(a,b,c,d){a.add_to_rhs(this.branch,this.src.value(d),c)},n.prototype.load_ac=function(a,b){a.add_to_rhs(this.branch,1,b)},o.prototype=new m,o.prototype.constructor=o,o.prototype.load_linear=function(){},o.prototype.load_dc=function(a,b,c){var d=this.src.dc;a.add_to_rhs(this.npos,-d,c),a.add_to_rhs(this.nneg,d,c)},o.prototype.load_tran=function(a,b,c,d){var e=this.src.value(d);a.add_to_rhs(this.npos,-e,c),a.add_to_rhs(this.nneg,e,c)},o.prototype.load_ac=function(a,b){a.add_to_rhs(this.npos,-1,b),a.add_to_rhs(this.nneg,1,b)},p.prototype=new m,p.prototype.constructor=p,p.prototype.load_linear=function(a){a.add_conductance_l(this.n1,this.n2,this.g)},p.prototype.load_dc=function(){},p.prototype.load_tran=function(){},p.prototype.load_ac=function(){},q.prototype=new m,q.prototype.constructor=q,q.prototype.load_linear=function(){},q.prototype.load_dc=function(a,b,c){var d,e,f=a.get_two_terminal(this.anode,this.cathode,b),g=f/this.vt,h=Math.abs(g),i=h-this.exp_arg_max;if(i>0){var j=1+i+.5*i*i;d=this.exp_max*j,e=this.exp_max*(1+i)}else d=Math.exp(h),e=d;0>g&&(d=1/d,e=d*e*d);var k=this.ais*(d-1),l=this.ais*(e/this.vt);a.add_to_rhs(this.anode,-k,c),a.add_to_rhs(this.cathode,k,c),a.add_conductance(this.anode,this.cathode,l)},q.prototype.load_tran=function(a,b,c){this.load_dc(a,b,c)},q.prototype.load_ac=function(){},r.prototype=new m,r.prototype.constructor=r,r.prototype.load_linear=function(a){a.add_capacitance(this.n1,this.n2,this.value)},r.prototype.load_dc=function(){},r.prototype.load_ac=function(){},r.prototype.load_tran=function(){},s.prototype=new m,s.prototype.constructor=s,s.prototype.load_linear=function(a){a.add_to_Gl(this.n1,this.branch,1),a.add_to_Gl(this.n2,this.branch,-1),a.add_to_Gl(this.branch,this.n1,-1),a.add_to_Gl(this.branch,this.n2,1),a.add_to_C(this.branch,this.branch,this.value)},s.prototype.load_dc=function(){},s.prototype.load_ac=function(){},s.prototype.load_tran=function(){},t.prototype=new m,t.prototype.constructor=t,t.prototype.load_linear=function(a){var b=1/this.gain;a.add_to_Gl(this.no,this.branch,1),a.add_to_Gl(this.ng,this.branch,-1),a.add_to_Gl(this.branch,this.no,b),a.add_to_Gl(this.branch,this.ng,-b),a.add_to_Gl(this.branch,this.np,-1),a.add_to_Gl(this.branch,this.nn,1)},t.prototype.load_dc=function(){},t.prototype.load_ac=function(){},t.prototype.load_tran=function(){},u.prototype=new m,u.prototype.constructor=u,u.prototype.load_linear=function(a){a.add_conductance_l(this.d,this.s,this.g_leak);var b=.25*this.W,c=1;a.add_capacitance(this.d,a.gnd_node(),2e-15*b*c+5e-16*(b+2*c)),a.add_capacitance(this.s,a.gnd_node(),2e-15*b*c+5e-16*(b+2*c)),c=.25*this.L,a.add_capacitance(this.g,a.gnd_node(),6e-15*b*c)},u.prototype.load_dc=function(a,b,c){var d=this.type_sign*a.get_two_terminal(this.d,this.s,b);if(0>d){var e=this.d;this.d=this.s,this.s=e,d=this.type_sign*a.get_two_terminal(this.d,this.s,b)}var f,g,h,i=this.type_sign*a.get_two_terminal(this.g,this.s,b),j=i-this.vt;j>0&&(d>j?(f=this.beta*(1+this.lambda*d)*j,g=.5*this.type_sign*f*j,h=.5*this.beta*j*j*this.lambda):(f=this.beta*(1+this.lambda*d),g=this.type_sign*f*d*(j-.5*d),h=f*(j-d)+this.beta*this.lambda*d*(j-.5*d),f*=d),a.add_to_rhs(this.d,-g,c),a.add_to_rhs(this.s,g,c),a.add_conductance(this.d,this.s,h),a.add_to_G(this.s,this.s,f),a.add_to_G(this.d,this.s,-f),a.add_to_G(this.d,this.g,f),a.add_to_G(this.s,this.g,-f))},u.prototype.load_tran=function(a,b,c){this.load_dc(a,b,c)},u.prototype.load_ac=function(){},Math.fmod=function(a,b){var c=Math.floor(a/b);return a-c*b};var N={Circuit:e,dc_analysis:b,ac_analysis:c,transient_analysis:d,print_netlist:a,parse_source:v};return N}(),jade.gate_level=function(){function a(a){var b=a.match(/(\w+)\s*\((.*?)\)\s*/),c=$.map(b[2].split(","),jade.utils.parse_number);return{type:b[1],args:c}}function b(b){var c=["ground","jumper","analog:v_source","analog:v_probe"];void 0!==jade.model.libraries.gates&&$.each(jade.model.libraries.gates.modules,function(a,b){c.push(b.get_name())});var d=b.netlist(c,"",{},[]),e=[];return $.each(d,function(b,c){var d=c[0],g=c[1],h=c[2],i=d.split(":");if("gates"==i[0]){var j={name:h.name};$.each(f,function(a,b){var c=h[b];c&&(j[b]=jade.utils.parse_number(c))}),e.push({type:i[1],connections:g,properties:j})}else if("analog:v_source"==d)e.push({type:"voltage source",connections:g,properties:{name:h.name,value:a(h.value)}});else if("ground"==d)e.push({type:"ground",connections:[g.gnd],properties:{}});else if("jumper"==d){var k=[];$.each(g,function(a,b){k.push(b)}),e.push({type:"connect",connections:k,properties:{}})}else"analog:v_probe"==d&&e.push({type:"voltage probe",connections:g,properties:{name:h.name,color:h.color,offset:jade.utils.parse_number(h.offset)}})}),e}function c(a){a.remove_annotations();var b="Stop Time (seconds)",c=device_netlist(a.aspect);if(0===find_probes(c).length)return void a.message("Transient Analysis: there are no probes in the diagram!");var e=a.aspect.module,f={};f[b]=jade.build_input("text",10,e.properties.tran_tstop);var g=jade.build_table(f);a.dialog("Transient Analysis",g,function(){e.set_property("tran_tstop",f[b].value);var g=jade.utils.parse_number_alert(e.properties.tran_tstop);if(c.length>0&&void 0!==g){for(var h=find_probes(c),i={},j=h.length-1;j>=0;j-=1)i[j]=h[j][1];var k=jade.progress_report();a.window("Progress",k),cktsim.transient_analysis(c,g,i,function(b,c){return void 0===c?(k[0].update_progress(b),k[0].stop_requested):(jade.window_close(k.win),void d(c,a,h))})}})}function d(a,b,c){var d;if("string"==typeof a)b.message("Error during Transient analysis:\n\n"+a);else if(void 0===a)b.message("Sorry, no results from transient analysis to plot!");else{for(var e=[],f=c.length-1;f>=0;f-=1){var g=c[f][0],h=c[f][1];d=a[h],void 0===d?b.message("The "+g+' probe is connected to node "'+h+'" which is not an actual circuit node'):"x-axis"!=g&&e.push({xvalues:[d.xvalues],yvalues:[d.yvalues],name:[h],color:[g],xunits:"s",type:["digital"]})}var i=jade.plot.graph(e);b.window("Results of Gate-level simulation",i)}}function e(a,b,c){if(void 0===c)return void 0;for(var d=0;d<b.length;d+=1)if(a<b[d])return c[d-1];return void 0}var f=["tcd","tpd","tr","tf","cin","size","ts","th"];return jade.schematic_view.schematic_tools.push(["gate","GATE","Gate-level simulation",c]),{gate_netlist:b,interpolate:e}}(),jade.gatesim=function(){function a(){return p}function b(){throw"Sorry, no DC analysis with gate-level simulation"}function c(){throw"Sorry, no AC analysis with gate-level simulation"}function d(a,b,c,d,e){if(a.length>0&&void 0!==b){var g=new f(a,e),h={};h.update_interval=250,h.finish=function(a){d(void 0,g,a)},h.stop_requested=!1,h.update=function(a){d(a,void 0,void 0)&&(h.stop_requested=!0)},g.initialize(h,b);try{g.simulate((new Date).getTime()+g.progress.update_interval)}catch(i){if("string"!=typeof i)throw i;h.finish(i)}}}function e(a,b,c){function d(a,b,d,e){if(0==d.length)return e;e+="<p><hr><p>",e+="Worst-case t<sub>PD</sub> from "+a+" to "+b+"\n",d.sort(function(a,b){return b.pd_sum-a.pd_sum});for(var f=0;c>f&&f<d.length;f+=1)i=d[f],e+="<p>  t<sub>PD</sub> from "+i.get_tpd_source().name+" to "+i.name+" ("+(1e9*i.pd_sum).toFixed(3)+"ns):",e+=" <button onclick=\"$('#detail"+k+'\').toggle()">Details</button>\n<div id="detail'+k+'" style="display:none;">',e+=i.describe_tpd(),e+="<br></div>",k+=1;return e}void 0===c&&(c=10);var e,g=new f(a,b);try{e=g.get_timing_info()}catch(h){return"\n\nOops, timing analysis failed:\n"+h}var i,j,k=0,l="";return $.each(e.clocks,function(a,b){var c=[];j=[],$.each(b.fanouts,function(a,d){if(i=d.get_clock_info(b),void 0!==i){var e=i.get_tpd_source().node;e==b&&j.push(i),!e.is_input()&&i.cd_sum<0&&c.push(i)}}),l=d(b.name+"\u2191",b.name+"\u2191",j,l),c.length>0&&(l+="<p><hr><p>",l+="Hold-time violations for "+b.name+"\u2191:\n",$.each(c,function(a,b){l+="\n  tCD from "+b.get_tcd_source().name+" to "+b.cd_link.name+" violates hold time by "+(1e9*b.cd_sum).toFixed(3)+"ns:\n",l+=b.describe_tcd()})),j=[],$.each(e.timing,function(a,c){c.get_tpd_source().node==b&&c.node.is_output()&&j.push(c)}),l=d(b.name+"\u2191","top-level outputs",j,l)}),j=[],$.each(e.timing,function(a,b){b.node.is_output()&&!b.get_tpd_source().node.clock&&j.push(b)}),l=d("inputs","top-level outputs",j,l)}function f(a,b){this.N=0,this.node_map={},this.aliases={},this.nodes=[],this.devices=[],this.device_map={},this.event_queue=new h,this.options=b||{},this.debug_level=this.options.debug||0,this._network_=this,void 0!==a&&this.load_netlist(a,b)}function g(a,b,c,d){this.time=a,this.type=b,this.node=c,this.v=d}function h(){this.nodes=[]}function i(a,b){this.name=a,this.network=b,this.drivers=[],this.driver=void 0,this.fanouts=[],this.capacitance=0}function j(a,b,c,d){this.type="voltage source",this.network=a,this.name=b,this.output=c,this.vil=a.options.vil||.1,this.vih=a.options.vih||.9;var e=jade.cktsim.parse_source(d.value);if("sin"==e.fun)throw"Can't use sin() sources in gate-level simulation";if("dc"==e.fun)this.tvpairs=[0,e.args[0]],this.period=0;else if(this.tvpairs=e.tvpairs,this.period=e.period,0!==this.period){this.tvpairs=this.tvpairs.slice(0);for(var f=0;f<e.tvpairs.length;f+=2)this.tvpairs.push(e.tvpairs[f]+this.period),this.tvpairs.push(e.tvpairs[f+1])}this.initial_value=this.tvpairs[1]<=this.vil?s:this.tvpairs[1]>=this.vih?t:u,c.add_fanout(this),c.add_driver(this),a.add_component(this)}function k(a,b,c,d,e,f,g){this.network=a,this.type=b,this.name=c,this.table=d,this.inputs=e,this.output=f,this.properties=g,this.size=g.size||0,this.lenient=void 0===g.lenient?!0:0!==g.lenient,e.length<2&&(this.lenient=!0),this.cout=g.cout||0,this.cin=g.cin||0,this.tcd=g.tcd||0,this.tpdf=g.tpdf||g.tpd||0,this.tpdr=g.tpdr||g.tpd||0,this.tr=g.tr||0,this.tf=g.tf||0;for(var h=0;h<e.length;h+=1)e[h].add_fanout(this);f.add_driver(this);var i=e[0],j=e[1],k=e[2],l=e[3],m=e[4],n=e[5];this.logic_eval=0===e.length?function(){return d[4]}:1==e.length?function(){return d[i.v][4]}:2==e.length?function(){return d[i.v][j.v][4]}:3==e.length?function(){return d[i.v][j.v][k.v][4]}:4==e.length?function(){return d[i.v][j.v][k.v][l.v][4]}:5==e.length?function(){return d[i.v][j.v][k.v][l.v][m.v][4]}:6==e.length?function(){return"mux4"==b&&(i.v>=u||j.v>=u)?i.v>=u?j.v>=u?k.v==l.v&&k.v==m.v&&k.v==n.v?k.v:u:j.v==s?k.v==l.v?k.v:u:m.v==n.v?m.v:u:i.v==s?k.v==m.v?k.v:u:l.v==n.v?l.v:u:d[i.v][j.v][k.v][l.v][m.v][n.v][4]}:function(){for(var a=d,b=0;b<e.length;b+=1)a=a[e[b].v];return a[4]},a.add_component(this)}function l(a,b,c,d,e){this.network=a,this.name=b,this.type=c,this.size=e.size||0,this.d=d.d,this.clk=d.clk,this.q=d.q,this.d.add_fanout(this),this.clk.add_fanout(this),this.q.add_driver(this),"dreg"==c&&(this.clk.clock=!0),this.gate_open="dlatch"==c?t:s,this.gate_closed="dlatch"==c?s:t,this.properties=e,this.lenient=void 0===e.lenient?!1:0!==e.lenient,this.cout=e.cout||0,this.cin=e.cin||0,this.tcd=e.tcd||0,this.tpdf=e.tpdf||e.tpd||0,this.tpdr=e.tpdr||e.tpd||0,this.tr=e.tr||0,this.tf=e.tf||0,this.ts=e.ts||0,this.th=e.th||0,a.add_component(this)}function m(a,b,c,d){var e=this;if(e.type="memory",e.network=a,e.name=b,e.width=c.width,void 0===e.width||e.width<=0)throw"Memory "+b+" must have width > 0.";if(e.nlocations=c.nlocations,void 0===e.nlocations||e.nlocations<=0)throw"Memory "+b+" must have > 0 locations.";e.contents=c.contents,e.lenient=void 0===c.lenient?!0:0!==c.lenient,e.cout=c.cout||d.mem_cout||0,e.cin=c.cin||d.mem_cin||1e-13,e.tcd=c.tcd||d.mem_tcd||2e-10,e.tr=c.tr||d.mem_tr||1e3,e.tf=c.tf||d.mem_tf||1e3,e.ts=c.ts||d.mem_ts||2*e.tcd,e.th=c.th||d.mem_th||e.tcd,e.nlocations>1024?(e.tpdf=c.tpdf||c.tpd||d.mem_tpdf_dram||d.mem_tpd_dram||4e-8,e.tpdr=c.tpdr||c.tpd||d.mem_tpdr_dram||d.mem_tpd_dram||4e-7):e.nlocations>128?(e.tpdf=c.tpdf||c.tpd||d.mem_tpdf_sram||d.mem_tpd_sram||2e-9,e.tpdr=c.tpdr||c.tpd||d.mem_tpdr_sram||d.mem_tpd_sram||2e-9):(e.tpdf=c.tpdf||c.tpd||d.mem_tpdf_regfile||d.mem_tpd_regfile||1e-10,e.tpdr=c.tpdr||c.tpd||d.mem_tpdr_regfile||d.mem_tpd_regfile||1e-10),e.ports=c.ports||[],e.tristate_outputs=[],e.n_read_ports=0,e.n_write_ports=0,e.naddr=0,$.each(e.ports,function(b,c){c.clk.add_fanout(e),c.wen.add_fanout(e),c.oe.add_fanout(e),$.each(c.addr,function(a,b){b.add_fanout(e)}),e.naddr=c.addr.length,(c.clk!=a.gnd||c.wen!=a.gnd)&&(e.n_write_ports+=1,c.write_port=!0,$.each(c.data,function(a,b){b.add_fanout(e)})),c.oe!=a.gnd&&(e.n_read_ports+=1,c.read_port=!0,$.each(c.data,function(a,b){b.add_driver(e),-1==e.tristate_outputs.indexOf(b)&&e.tristate_outputs.push(b)}))}),e.bits=new Uint8Array(e.nlocations*e.width);var f;f=1==e.n_read_ports&&0==e.n_write_ports?0:e.nlocations<=1024?d.mem_size_sram||5:0,f+=e.ports.length*(d.mem_size_access||1),e.size=e.nlocations*e.width*f,e.size+=e.ports.length*e.naddr*(d.mem_size_address_buffer||20),e.size+=e.ports.length*e.naddr*(d.mem_size_address_decoder||20),e.size+=e.n_read_ports*e.width*(d.mem_size_output_buffer||30),e.size+=e.n_write_ports*e.width*(d.mem_size_write_buffer||20),a.add_component(this)}function n(a,b,c,d,e){this.name=a,this.node=b,this.device=c,this.cd_sum=0,this.cd_link=void 0,this.pd_sum=0,this.pd_link=void 0,this.tcd=d||0,this.tpd=e||0}function o(a,b,c){for(var d=a.toFixed(c);d.length<b;)d=" "+d;return d}var p;f.prototype.unalias=function(a){for(;void 0!==this.aliases[a];)a=this.aliases[a];return a},f.prototype.make_alias=function(a,b){if(a=this.unalias(a),b=this.unalias(b),a!=b){var c,d,e=-1==a.indexOf("."),f=-1==b.indexOf(".");"gnd"==a?(c=a,d=b):"gnd"==b?(c=b,d=a):e&&!f?(c=a,d=b):f&&!e?(c=b,d=a):a.length<=b.length?(c=a,d=b):(c=b,d=a),this.aliases[d]=c}},f.prototype.node=function(a){a=this.unalias(a);var b=this.node_map[a];return void 0===b&&(b=new i(a,this),this.node_map[a]=b,this.nodes.push(b),this.N+=1),b},f.prototype.load_netlist=function(a,b){p=this;var c=this;c.N=0,c.node_map={},c.aliases={},c.nodes=[],c.devices=[],c.device_map={},c.size=0,c.counts={},c.sizes={},c.gnd=c.node("gnd"),c.devices.push(new j(c,"gnd",c.gnd,{name:"gnd",value:{type:"dc",args:[]}})),$.each(a,function(a,b){"ground"==b.type&&(c.node_map[b.connections.gnd]=c.gnd)}),$.each(a,function(a,b){if("connect"==b.type){var d=[];$.each(b.connections,function(a,b){d.push(b)});for(var e=1;e<d.length;e+=1)c.make_alias(d[0],d[e])}}),$.each(a,function(a,d){var e,f=d.type;if("ground"!=f&&"connect"!=f){var g=d.connections,h=d.properties,i=h.name;for(var n in g)g[n]=c.node(g[n]);if(f in cb){var o=cb[f],p=[];$.each(o[0],function(a,b){p.push(g[b])}),new k(c,f,i,o[2],p,g[o[1]],h)}else if("dreg"==f||"dlatch"==f||"dlatchn"==f)new l(c,i,f,g,h);else if("memory"==f)$.each(h.ports,function(a,b){$.each(b.addr,function(a,d){b.addr[a]=c.node(d)}),$.each(b.data,function(a,d){b.data[a]=c.node(d)}),b.data_out=b.data.slice(0),b.clk=c.node(b.clk),b.wen=c.node(b.wen),b.oe=c.node(b.oe)}),new m(c,i,h,b);else if("constant0"==f||"constant1"==f){if(e=g.z,e.drivers.length>0)return;e.v="constant0"==f?s:t,new k(c,f,i,"constant0"==f?y:z,[],e,h)}else{if("voltage source"!=f)throw"Unrecognized gate: "+f;if(e=g.nplus,e.drivers.length>0)return;new j(c,i,e,h)}}}),$.each(c.node_map,function(a,b){b.finalize()})},f.prototype.report=function(){var a=this,b=$("<div></div>"),c=1e-10/(1e-12*a.size*a.time);b.append("Benmark: "+c.toFixed(2));var d=void 0,e=void 0,f=void 0;$.each(a.devices,function(a,b){b.min_setup&&(void 0===d||b.min_setup<d)&&(d=b.min_setup,e=b.min_setup_time,f=b.name)}),d&&b.append("<p>Min observed setup time: "+(1e9*d).toFixed(2)+"ns at time="+(1e9*e).toFixed(0)+"ns for device "+f);var g=$('<table class="size-table"><tr><th>Component</th><th>Count</th><th>Size (\u03bc\xb2)</th></tr></table>');g.append('<tr><td><i>nodes</i></td><td class="number">'+this.N+"</td><td></td></tr>");var h=0,i=[];$.each(a.counts,function(a,b){i.push(a),h+=b}),i.sort();var j,h=0;return $.each(i,function(b,c){h+=a.counts[c],j=a.sizes[c],void 0===j&&(j=""),g.append("<tr><td>"+c+'</td><td class="number">'+a.counts[c]+'</td><td class="number">'+j+"</td></tr>")}),g.append('<tr><td><b>Totals</b></td><td class="number"><b>'+h+'</b></td><td class="number"><b>'+a.size+"</b></td></tr>"),b.append("<p>",g),b},f.prototype.add_component=function(a){var b=a.type;this.devices.push(a),this.counts[b]=(this.counts[b]||0)+1,a.name&&(this.device_map[a.name]=a),a.size&&(this.size+=a.size,this.sizes[b]=(this.sizes[b]||0)+a.size)},f.prototype.initialize=function(a,b){this.progress=a,this.tstop=b,this.event_queue.clear(),this.time=0;var c;for(c=0;c<this.nodes.length;c+=1)this.nodes[c].initialize();
for(c=0;c<this.devices.length;c+=1)this.devices[c].initialize()},f.prototype.simulate=function(a){var b=0;if(!this.progress.stop_requested){for(;this.time<this.tstop&&!this.event_queue.empty();){var c=this.event_queue.pop();if(this.time=c.time,c.node.process_event(c),!(++b<1e3)){b=0;var d=(new Date).getTime();if(d>=a){var e=Math.round(100*this.time/this.tstop);this.progress.update(e);var f=this;return void setTimeout(function(){try{f.simulate(d+f.progress.update_interval)}catch(a){if("string"!=typeof a)throw a;f.progress.finish(a)}},1)}}}this.time=this.tstop}this.progress.finish(void 0)},f.prototype.add_event=function(a,b,c,d){var e=new g(a,b,c,d);return this.event_queue.push(e),this.debug_level>2&&console.log("add "+"cp"[b]+" event: "+c.name+"->"+"01XZ"[d]+" @ "+a),e},f.prototype.remove_event=function(a){this.event_queue.removeItem(a),this.debug_level>2&&console.log("remove "+"cp"[a.type]+" event: "+a.node.name+"->"+"01XZ"[a.v]+" @ "+a.time)},f.prototype.history=function(a){a=this.unalias(a);var b=this.node_map[a];return void 0===b?void 0:(b.times[b.times.length-1]!=this.time&&(b.times.push(this.time),b.values.push(b.v)),{xvalues:b.times,yvalues:b.values})},f.prototype.get_memory=function(a){var b=this.device_map[a];return void 0!==b&&"memory"==b.type?b.get_contents():void 0},f.prototype.result_type=function(){return"digital"},f.prototype.node_list=function(){var a=[];for(var b in this.node_map)a.push(b);return a},f.prototype.get_timing_info=function(){var a=[],b={};return $.each(this.node_map,function(c,d){d.clock&&a.push(d),b[c]=d.get_timing_info()}),{clocks:a,timing:b}};var q=0,r=1;h.prototype.assert=function(){var a,b,c=this.nodes.length;for(a=0;c>a;a+=1){if(b=2*a+1,c>b&&this.nodes[a].time>this.nodes[b].time)throw"heap error 1";if(c>b+1&&this.nodes[a].time>this.nodes[b+1].time)throw"heap error 2"}},h.prototype.cmplt=function(a,b){return a.time<b.time},h.prototype._siftdown=function(a,b){var c,d,e;for(c=this.nodes[b];b>a&&(e=b-1>>1,d=this.nodes[e],this.cmplt(c,d));)this.nodes[b]=d,b=e;this.nodes[b]=c},h.prototype._siftup=function(a){var b,c,d,e,f;for(c=this.nodes.length,f=a,d=this.nodes[a],b=2*a+1;c>b;)e=b+1,c>e&&!this.cmplt(this.nodes[b],this.nodes[e])&&(b=e),this.nodes[a]=this.nodes[b],a=b,b=2*a+1;this.nodes[a]=d,this._siftdown(f,a)},h.prototype.push=function(a){this.nodes.push(a),this._siftdown(0,this.nodes.length-1)},h.prototype.pop=function(){var a,b;return a=this.nodes.pop(),this.nodes.length?(b=this.nodes[0],this.nodes[0]=a,this._siftup(0)):b=a,b},h.prototype.peek=function(){return this.nodes[0]},h.prototype.contains=function(a){return-1!==this.nodes.indexOf(a)},h.prototype.updateItem=function(a){var b=this.nodes.indexOf(a);-1!=b&&(this._siftdown(0,b),this._siftup(b))},h.prototype.removeItem=function(a){var b=this.nodes.indexOf(a);if(-1!=b){var c=this.nodes.pop();a!==c&&(this.nodes[b]=c,this._siftdown(0,b),this._siftup(b))}},h.prototype.clear=function(){return this.nodes=[]},h.prototype.empty=function(){return 0===this.nodes.length},h.prototype.size=function(){return this.nodes.length};var s=0,t=1,u=2,v=3,w=0,x=0;i.prototype.initialize=function(){this.v=u,this.times=[0],this.values=[u],this.cd_event=void 0,this.pd_event=void 0,this.clock=!1,this.timing_info=void 0,this.in_progress=!1},i.prototype.add_fanout=function(a){-1==this.fanouts.indexOf(a)&&this.fanouts.push(a)},i.prototype.add_driver=function(a){this.drivers.push(a)},i.prototype.process_event=function(a){a==this.cd_event?this.cd_event=void 0:a==this.pd_event?this.pd_event=void 0:console.log("unknown event!",this.name,this.network.time),this.v!=a.v&&(this.times.push(a.time),this.values.push(a.v)),this.network.debug_level>0&&console.log(this.name+": "+"01XZ"[this.v]+"->"+"01XZ"[a.v]+" @ "+a.time+[" contamination"," propagation"][a.type]),this.v=a.v;for(var b=this.fanouts.length-1;b>=0;b-=1)this.network.debug_level>1&&console.log("Evaluating ("+"cp"[a.type]+") "+this.fanouts[b].name+" @ "+a.time),this.fanouts[b].process_event(a,this)},i.prototype.last_event_time=function(){return this.times[this.times.length-1]},i.prototype.finalize=function(){if(void 0!==this.drivers&&void 0===this.driver){var a=this.drivers.length,b=this.fanouts.length;if(0!==a){0===this.capacitance&&(this.capacitance=x+w*(a+b));var c,d;for(c=0;a>c;c+=1)this.capacitance+=this.drivers[c].capacitance(this);for(c=0;b>c;c+=1)this.capacitance+=this.fanouts[c].capacitance(this);if(1==a)return this.driver=this.drivers[0],void(this.drivers=void 0);var e=[];for(c=0;a>c;c+=1){if(d=this.drivers[c],!d.tristate(this)){for(var f="Node "+this.name+" connects to more than one non-tristate output.  See devices: \n",g=0;a>g;g+=1)f+=this.drivers[g].name+"\n";throw f}var h=this.network.node(this.name+"$"+c.toString());h.capacitance=this.capacitance,e.push(h),d.change_output_node(this,h),h.driver=d}this.capacitance=0,this.driver=new k(this.network,"BUS",this.name+"%bus",J,e,this,{},!0),this.drivers=void 0}else if(b>0)throw"Node "+this.name+" is not connected to any output."}},i.prototype.c_event=function(a){var b=this.network.time+a;if(this.pd_event&&this.pd_event.time>=b&&(this.network.remove_event(this.pd_event),this.pd_event=void 0),this.cd_event){if(this.cd_event.time<=b)return;this.network.remove_event(this.cd_event)}this.cd_event=this.network.add_event(b,q,this,u)},i.prototype.p_event=function(a,b,c,d){var e=this.network.time+a+c*this.capacitance;if(this.pd_event){if(d&&this.pd_event.v==b&&e>=this.pd_event.time)return;this.network.remove_event(this.pd_event)}this.pd_event=this.network.add_event(e,r,this,b)},i.prototype.is_input=function(){return void 0===this.driver||this.driver instanceof j},i.prototype.is_output=function(){return 0===this.fanouts.length&&void 0!==this.driver&&!(this.driver instanceof j)&&-1==this.name.indexOf(".")},i.prototype.get_timing_info=function(){if(void 0===this.timing_info)if(this.is_input())this.timing_info=new n(this.name,this);else{if(this.in_progress)throw"Combinational cycle detected:\n  "+this.name;try{this.in_progress=!0,this.timing_info=this.driver.get_timing_info(this),this.in_progress=!1}catch(a){throw this.in_progress=!1,a+"\n  "+this.name}}return this.timing_info},j.prototype.change_output_node=function(a,b){this.output==a&&(this.output=b)},j.prototype.initialize=function(){this.initial_value!=u&&this.output.p_event(0,this.initial_value,0,!1)},j.prototype.capacitance=function(){return 0},j.prototype.tristate=function(){return!1},j.prototype.process_event=function(a){var b,c=this.network.time;a.type==r&&(b=this.next_contamination_time(c),b>=0&&this.output.c_event(b-c),b=this.next_propagation_time(c),b.time>0&&this.output.p_event(b.time-c,b.value,0,!1))},j.prototype.next_contamination_time=function(a){a+=1e-13;var b=a,c=0;0!==this.period&&(b=Math.fmod(b,this.period),c=a-b);for(var d,e=0,f=0,g=this.tvpairs.length,h=0;g>h;h+=2){var i=this.tvpairs[h],j=this.tvpairs[h+1];if(h>0&&i>=b)if(f>=this.vih&&j<this.vih){if(d=e+(i-e)*(this.vih-f)/(j-f),d>b)return c+d}else if(f<=this.vil&&j>this.vil&&(d=e+(i-e)*(this.vil-f)/(j-f),d>b))return c+d;e=i,f=j}return-1},j.prototype.next_propagation_time=function(a){a+=1e-13;var b=a,c=0;0!==this.period&&(b=Math.fmod(b,this.period),c=a-b);for(var d,e=0,f=0,g=this.tvpairs.length,h=0;g>h;h+=2){var i=this.tvpairs[h],j=this.tvpairs[h+1];if(h>0&&i>=b)if(f<this.vih&&j>=this.vih){if(d=e+(i-e)*(this.vih-f)/(j-f),d>b)return{time:c+d,value:t}}else if(f>this.vil&&j<=this.vil&&(d=e+(i-e)*(this.vil-f)/(j-f),d>b))return{time:c+d,value:s};e=i,f=j}return{time:-1}},j.prototype.get_clock_info=function(){return void 0};var y=[];y.push(y,y,y,y,0);var z=[];z.push(z,z,z,z,1);var A=[];A.push(A,A,A,A,2);var B=[];B.push(B,B,B,B,3);var C=[y,z,A,A,2],D=[C,C,C,C,2],E=[D,D,D,D,2],F=[E,E,E,E,2],G=[y,A,A,A,2],H=[A,z,A,A,2],I=[G,H,A,A,2],J=[],K=[],L=[];J.push(K,L,A,J,3),K.push(K,A,A,K,0),L.push(A,L,A,L,1);var M=[B,C,A,A,2],N=[];N.push(y,N,N,N,2);var O=[];O.push(y,O,N,N,1);var P=[];P.push(z,P,P,P,2);var Q=[];Q.push(z,Q,P,P,0);var R=[];R.push(R,z,R,R,2);var S=[];S.push(S,z,R,R,0);var T=[];T.push(T,y,T,T,2);var U=[];U.push(U,y,T,T,1);var V=[],W=[];V.push(V,W,A,A,0),W.push(W,V,A,A,1);var X=[],Y=[];X.push(X,Y,A,A,1),Y.push(Y,X,A,A,0);var Z=[C,D,I,I,2],_=[C,E,I,I,2],ab=[D,F,I,I,2],bb=[_,ab,I,I,2],cb={and2:[["A","B"],"Z",O],and3:[["A","B","C"],"Z",O],and4:[["A","B","C","D"],"Z",O],buffer:[["A"],"Z",O],inverter:[["A"],"Z",Q],mux2:[["S","D0","D1"],"Z",Z],mux4:[["S0","S1","D0","D1","D2","D3"],"Z",bb],nand2:[["A","B"],"Z",Q],nand3:[["A","B","C"],"Z",Q],nand4:[["A","B","C","D"],"Z",Q],nor2:[["A","B"],"Z",U],nor3:[["A","B","C"],"Z",U],nor4:[["A","B","C","D"],"Z",U],or2:[["A","B"],"Z",S],or3:[["A","B","C"],"Z",S],or4:[["A","B","C","D"],"Z",S],tristate:[["E","A"],"Z",M],xor2:[["A","B"],"Z",V],xnor2:[["A","B"],"Z",X]};k.prototype.change_output_node=function(a,b){this.output==a&&(this.output=b)},k.prototype.initialize=function(){if(0===this.inputs.length){var a=this.logic_eval();this.output.p_event(0,a,0,!1)}},k.prototype.capacitance=function(a){for(var b=0,c=0;c<this.inputs.length;c+=1)this.inputs[c]==a&&(b+=this.cin);return this.output==a&&(b+=this.cout),b},k.prototype.tristate=function(a){return this.output==a&&this.table==M?!0:!1},k.prototype.describe=function(a){for(var b=[],c=0;c<this.inputs.length;c+=1)b.push(this.inputs[c].name+"="+"01XZ".charAt(this.inputs[c].v));var d="01XZ".charAt(this.logic_eval());console.log((a||"")+this.name+":"+this.type+"("+b.join(",")+")="+d+" @ "+(1e9*this.network.time).toFixed(3)),console.log("    output "+this.output.name+"="+"01XZ".charAt(this.output.v)+" @ "+(1e9*this.output.last_event_time()).toFixed(3))},k.prototype.process_event=function(a){var b,c=this.output;if(a.type==q){if(this.lenient)if(b=this.logic_eval(),void 0===c.pd_event){if(void 0===c.cd_event&&b==c.v)return}else if(b==c.pd_event.v)return;c.c_event(this.tcd)}else if(a.type==r){b=this.logic_eval();var d,e;b==t?(e=this.tpdr,d=this.tr):b==s?(e=this.tpdf,d=this.tf):(e=Math.min(this.tpdr,this.tpdf),d=0),c.p_event(e,b,d,this.lenient)}},k.prototype.get_timing_info=function(a){for(var b=this.tpdr+this.tr*a.capacitance,c=this.tpdf+this.tf*a.capacitance,d=new n(a.name,a,this,this.tcd,Math.max(b,c)),e=0;e<this.inputs.length;e+=1)d.set_delays(this.inputs[e].get_timing_info());return d},k.prototype.get_clock_info=function(){return void 0},l.prototype.change_output_node=function(a,b){this.q==a&&(this.q=b)},l.prototype.initialize=function(){this.min_setup=void 0,this.min_setup_time=void 0,this.state=u},l.prototype.capacitance=function(a){var b=0;return this.q==a&&(b+=this.cout),this.d==a&&(b+=this.cin),this.clk==a&&(b+=this.cin),b},l.prototype.tristate=function(){return!1},l.prototype.process_event=function(a,b){if("dreg"==this.type){if(a.type!=r)return;if(this.clk.v==s)this.state=this.d.v;else if(this.clk==b)if(this.clk.v==t){var c=this.network.time,d=this.d.last_event_time();if(void 0!==d&&c>0){var e=c-d;(void 0===this.min_setup||e<this.min_setup)&&(this.min_setup=e,this.min_setup_time=c)}this.lenient&&this.state==this.q.v||this.q.c_event(this.tcd),this.q.p_event(this.state==s?this.tpdf:this.tpdr,this.state,this.state==s?this.tf:this.tr,this.lenient)}else this.lenient&&this.state==this.d.v||(this.state=u),this.lenient&&this.state==this.q.v||this.q.p_event(Math.min(this.tpdf,this.tpdr),u,0,this.lenient)}else{var f=this.clk.v==this.gate_closed?this.state:this.clk.v==this.gate_open?this.d.v:this.lenient&&this.d.v==this.state?this.state:u;if(this.clk.v==this.gate_open&&(this.state=f),a.type==q){if(this.lenient)if(void 0==this.q.pd_event){if(void 0==this.q.cd_event&&f==this.q.v)return}else if(f==this.q.pd_event.v)return;this.q.c_event(this.tcd)}else if(a.type==r&&(!this.lenient||f!=this.q.v||void 0!==this.q.cd_event||void 0!==this.q.pd_event)){var g,h;f==t?(h=this.tpdr,g=this.tr):f==s?(h=this.tpdf,g=this.tf):(h=Math.min(this.tpdr,this.tpdf),g=0),this.q.p_event(h,f,g,this.lenient)}}},l.prototype.get_timing_info=function(a){var b=this.tpdr+this.tr*a.capacitance,c=this.tpdf+this.tf*a.capacitance,d=new n(a.name,a,this,this.tcd,Math.max(b,c)),e=$.extend({},this.clk.get_timing_info());return e.name=e.name+"\u2191",d.set_delays(e),"dreg"!=this.type&&d.set_delays(this.d.get_timing_info()),d},l.prototype.get_clock_info=function(a){if("dreg"==this.type){var b=new n(a.name+"\u2191",a,this,-this.th,this.ts);return b.set_delays(this.d.get_timing_info()),b}return void 0},m.prototype.change_output_node=function(a,b){$.each(this.ports,function(c,d){$.each(d.data_out,function(c,e){e==a&&(d.data_out[c]=b)})})},m.prototype.get_contents=function(){for(var a=[],b=0;b<this.nlocations;b+=1){for(var c=0,d=0;d<this.width;d+=1){var e=this.bits[b*this.width+(this.width-1-d)];if(e==u){c=void 0;break}c*=2,e==t&&(c+=1)}a[b]=c}return a},m.prototype.clear_memory=function(){for(var a=this.nlocations*this.width,b=0;a>b;b+=1)this.bits[b]=u},m.prototype.initialize=function(){if(this.min_setup=void 0,this.min_setup_time=void 0,this.clear_memory(),void 0!==this.contents)for(var a=Math.min(this.nlocations,this.contents.length),b=0;a>b;b+=1)for(var c=this.contents[b],d=0;d<this.width;d+=1,c>>=1)this.bits[b*this.width+d]=1&c},m.prototype.update_from_node=function(a){var b=this.network.time;if(b>0){var c=a.last_event_time();if(void 0!==c){var d=b-c;(void 0===this.min_setup||d<this.min_setup)&&(this.min_setup=d,this.min_setup_time=b)}}},m.prototype.update_min_setup=function(a){this.update_from_node(a.wen);var b;for(b=0;b<this.naddr;b+=1)this.update_from_node(a.addr[b]);for(b=0;b<this.width;b+=1)this.update_from_node(a.data[b])},m.prototype.address=function(a){for(var b,c,d=0,e=0;e<this.naddr;e+=1)b=a.addr[e],c=b.v,c==u||c==v?d=-1:d>=0&&(d*=2,c==t&&(d+=1));return d},m.prototype.active_read_port=function(a,b){return a.read_port?b==a.oe?!0:a.oe.v!=s&&-1!=a.addr.indexOf(b)?!0:!1:!1},m.prototype.update_read_port=function(a){for(var b=this.address(a),c=M[a.oe.v],d=0;d<this.width;d+=1){var e=this.width-1-d,f=0>b||b>=this.nlocations?u:this.bits[b*this.width+e];f=c[f][4];var g,h;f==t?(h=this.tpdr,g=this.tr):f==s?(h=this.tpdf,g=this.tf):f==v?(h=0,g=0):(h=Math.min(this.tpdr,this.tpdf),g=0),a.data_out[d].p_event(h,f,g,this.lenient)}},m.prototype.location_changed=function(a){for(var b=0;b<this.ports.length;b+=1){var c=this.ports[b];if(c.read_port&&c.oe.v!=s){var d=this.address(c);(0>a||0>d||d==a)&&this.update_read_port(c)}}},m.prototype.active_write_port=function(a,b){return a.write_port?0===this.network.time?!1:b==a.clk&&a.clk.v!=s&&a.wen.v!=s?!0:!1:!1},m.prototype.capacitance=function(a){var b=this,c=0;return $.each(b.ports,function(d,e){e.clk==a&&(c+=b.cin),e.wen==a&&(c+=b.cin),e.oe==a&&(c+=b.cin),$.each(e.addr,function(d,e){e==a&&(c+=b.cin)}),$.each(e.data,function(d,f){f==a&&((e.clk!=b.network.gnd||e.wen!=b.network.gnd)&&(c+=b.cin),e.oe!=b.network.gnd&&(c+=b.cout))})}),c},m.prototype.tristate=function(a){return-1!=this.tristate_outputs.indexOf(a)},m.prototype.process_event=function(a,b){var c,d,e;if(a.type==q){for(c=0;c<this.ports.length;c+=1)if(e=this.ports[c],this.active_read_port(e,b))for(d=0;d<this.width;d+=1)e.data[d].c_event(this.tcd)}else if(a.type==r)for(c=0;c<this.ports.length;c+=1)if(e=this.ports[c],this.active_read_port(e,b)&&this.update_read_port(e),this.active_write_port(e,b)){var f=this.address(e),g=e.clk.v==t&&e.wen.v==t;if(0>f)this.clear_memory();else if(f<this.nlocations)for(d=0;d<this.width;d+=1){var h=g?e.data[d].v:u;this.bits[f*this.width+(this.width-1)-d]=h}this.location_changed(f),this.update_min_setup(e)}},m.prototype.get_timing_info=function(a){for(var b=this.tpdr+this.tr*a.capacitance,c=this.tpdf+this.tf*a.capacitance,d=new n(a.name,a,this,this.tcd,Math.max(b,c)),e=0;e<this.ports.length;e+=1){var f=this.ports[e];if(f.read_port&&-1!=f.data_out.indexOf(a)){d.set_delays(f.oe.get_timing_info());for(var g=0;g<this.naddr;g+=1)d.set_delays(f.addr[g].get_timing_info())}}return d},m.prototype.get_clock_info=function(a){var b,c,d,e;for(c=0;c<this.ports.length;c+=1)if(e=this.ports[c],e.write_port&&e.clk==a){for(void 0===b&&(b=new n(a.name+"\u2191",a,this,-this.th,this.ts)),b.set_delays(e.wen.get_timing_info()),d=0;d<this.naddr;d+=1)b.set_delays(e.addr[d].get_timing_info());for(d=0;d<this.width;d+=1)b.set_delays(e.data[d].get_timing_info())}return b},n.prototype.get_tcd_source=function(){for(var a=this;void 0!==a.cd_link;)a=a.cd_link;return{node:a.node,name:a.name}},n.prototype.get_tpd_source=function(){for(var a=this;void 0!==a.pd_link;)a=a.pd_link;return{node:a.node,name:a.name}},n.prototype.set_delays=function(a){var b;b=a.cd_sum+this.tcd,(void 0===this.cd_link||b<this.cd_sum)&&(this.cd_link=a,this.cd_sum=b),b=a.pd_sum+this.tpd,(void 0===this.pd_link||b>this.pd_sum)&&(this.pd_link=a,this.pd_sum=b)},n.prototype.describe_tpd=function(){var a;a=void 0!==this.pd_link?this.pd_link.describe_tpd():"";var b=void 0!==this.device?" ["+this.device.name+" "+this.device.type+"]":"";return a+="    + "+o(1e9*this.tpd,6,3)+"ns = "+o(1e9*this.pd_sum,6,3)+"ns "+this.name+b+"\n"},n.prototype.describe_tcd=function(){var a;a=void 0!==this.cd_link?this.cd_link.describe_tcd():"";var b=void 0!==this.device?" ["+this.device.name+"]":"";return a+="    "+(this.tcd<0?"-":"+"),a+=" "+o(1e9*Math.abs(this.tcd),6,3)+"ns = "+o(1e9*this.cd_sum,6,3)+"ns "+this.name+b+"\n"};var db={dc_analysis:b,ac_analysis:c,transient_analysis:d,timing_analysis:e,get_last_network:a};return db}(),new jade.model.Library("analog",{capacitor:{properties:{tool_tip:{edit:"no",type:"string",value:"Capacitor",label:"Tool tip"},c:{edit:"yes",type:"string",value:"1",label:"Capacitance (F)"},name:{edit:"yes",type:"string",value:"",label:"Name"}},icon:[["terminal",[0,0,1],{name:"n1"}],["terminal",[0,48,3],{name:"n2"}],["line",[0,8,0,0,14]],["line",[-8,22,0,16,0]],["line",[-8,26,0,16,0]],["line",[0,26,0,0,14]],["property",[9,24,0],{format:"{c}F"}],["property",[-9,24,0],{align:"center-right",format:"{name}"}]]},diode:{properties:{tool_tip:{edit:"no",choices:[""],type:"string",value:"Diode",label:"Tool tip"},type:{edit:"yes",choices:["normal","ideal"],type:"menu",value:"normal",label:"Type"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},area:{edit:"yes",choices:[""],type:"string",value:"1",label:"Area"}},icon:[["terminal",[0,0,1],{name:"anode"}],["terminal",[0,48,5],{name:"cathode"}],["line",[0,8,1,8,0]],["line",[-8,16,0,16,0]],["line",[8,16,0,-8,16]],["line",[0,32,0,-8,-16]],["line",[-8,32,0,16,0]],["line",[0,40,0,0,-8]],["property",[8,24,0],{format:"{area}"}],["property",[-8,24,0],{align:"center-right",format:"{name}"}]]},i_probe:{properties:{color:{edit:"yes",choices:["red","green","blue","cyan","magenta","yellow","black"],type:"menu",value:"red",label:"Plot color"},tool_tip:{edit:"no",choices:[""],type:"string",value:"Current probe",label:"Tool tip"},offset:{edit:"yes",choices:[""],type:"string",value:"0",label:"Offset"}},icon:[["terminal",[0,0,0],{name:"nplus"}],["terminal",[16,0,4],{name:"nminus"}],["line",[10,0,0,-4,-4]],["line",[10,0,6,-4,-4]]]},i_source:{properties:{tool_tip:{edit:"no",choices:[""],type:"string",value:"Current source",label:"Tool tip"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},value:{edit:"yes",choices:[""],type:"string",value:"dc(1)",label:"Value"}},icon:[["terminal",[0,0,1],{name:"nplus"}],["terminal",[0,48,3],{name:"nminus"}],["line",[0,8,0,0,4]],["circle",[0,24,0,12,0]],["line",[0,36,0,0,4]],["property",[14,24,0],{format:"{value}"}],["property",[-14,24,0],{align:"center-right",format:"{name}"}],["line",[0,16,0,0,16]],["line",[0,32,0,3,-6]],["line",[0,32,0,-3,-6]]]},inductor:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},l:{edit:"yes",choices:[""],type:"string",value:"1",label:"Inductance (H)"},tool_tip:{edit:"no",choices:[""],type:"string",value:"Inductor",label:"Tool tip"}},icon:[["terminal",[0,0,7],{name:"n1"}],["terminal",[0,48,3],{name:"n2"}],["line",[0,14,0,0,-6]],["line",[0,34,0,0,6]],["arc",[-3,28,0,3,6,3,-2]],["arc",[0,14,0,-3,6,0,8]],["property",[8,24,0],{format:"{l}H"}],["property",[-6,24,0],{align:"center-right",format:"{name}"}],["arc",[-3,20,0,0,8,7,2]]]},initial_voltage:{properties:{tool_tip:{edit:"yes",choices:[""],type:"string",value:"Initial voltage",label:"Tool tip"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},IV:{edit:"yes",choices:[""],type:"string",value:"0",label:"Initial voltage"}},test:[["test",""]],icon:[["terminal",[0,0,3],{name:"node"}],["property",[0,-16,0],{align:"center",format:"IV={IV}"}],["line",[-16,-8,0,32,0]],["line",[16,-8,0,0,-16]],["line",[16,-24,0,-32,0]],["line",[-16,-24,0,0,16]],["property",[0,-26,0],{align:"bottom-center",format:"{name}"}]]},nfet:{properties:{tool_tip:{edit:"no",choices:[""],type:"string",value:"N-Channel mosfet",label:"Tool tip"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},W:{edit:"yes",choices:[""],type:"string",value:"2",label:"Scaled width"},L:{edit:"yes",choices:[""],type:"string",value:"1",label:"Scaled length"}},icon:[["terminal",[0,0,1],{name:"D"}],["terminal",[0,32,3],{name:"S"}],["terminal",[-24,16,0],{name:"G"}],["line",[0,8,0,-8,0]],["line",[-8,8,0,0,16]],["line",[-8,24,0,8,0]],["line",[-11,8,0,0,16]],["property",[0,16,0],{format:"{W}/{L}"}],["line",[-16,16,0,5,0]]]},opamp:{properties:{A:{edit:"yes",choices:[""],type:"string",value:"30000",label:"Gain"},tool_tip:{edit:"no",choices:[""],type:"string",value:"Op Amp",label:"Tool tip"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"}},icon:[["terminal",[0,0,0],{name:"nplus"}],["terminal",[0,16,0],{name:"nminus"}],["terminal",[48,8,4],{name:"output"}],["terminal",[24,24,3],{name:"gnd"}],["line",[8,-8,0,0,32]],["line",[8,24,0,32,-16]],["line",[40,8,0,-32,-16]],["line",[10,0,0,6,0]],["line",[13,-3,0,0,6]],["line",[10,16,0,6,0]],["text",[27,16,0],{text:"gnd",align:"top-left",font:"5pt sans-serif"}],["property",[27,0,0],{align:"bottom-left",format:"{name}"}]]},pfet:{properties:{tool_tip:{edit:"no",choices:[""],type:"string",value:"P-Channel mosfet",label:"Tool tip"},name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},W:{edit:"yes",choices:[""],type:"string",value:"2",label:"Scaled width"},L:{edit:"yes",choices:[""],type:"string",value:"1",label:"Scaled length"}},icon:[["terminal",[0,0,1],{name:"D"}],["terminal",[0,32,3],{name:"S"}],["terminal",[-24,16,0],{name:"G"}],["line",[0,8,0,-8,0]],["line",[-8,8,0,0,16]],["line",[-8,24,0,8,0]],["line",[-11,8,0,0,16]],["property",[0,16,0],{format:"{W}/{L}"}],["circle",[-14,16,0,2]]]},resistor:{properties:{tool_tip:{edit:"no",type:"string",value:"Resistor",label:"Tool tip"},r:{edit:"yes",type:"string",value:"1",label:"Resistance (\u03a9)"},name:{edit:"yes",type:"string",value:"",label:"Name"}},icon:[["terminal",[0,0,1],{name:"n1"}],["terminal",[0,48,3],{name:"n2"}],["line",[0,8,0,0,4]],["line",[0,12,0,4,2]],["line",[4,14,0,-8,4]],["line",[-4,18,0,8,4]],["line",[4,22,0,-8,4]],["line",[-4,26,0,8,4]],["line",[4,30,0,-8,4]],["line",[-4,34,0,4,2]],["line",[0,36,0,0,4]],["property",[5,24,0],{format:"{r}\u03a9"}],["property",[-5,24,0],{align:"center-right",format:"{name}"}]]},v_probe:{properties:{color:{edit:"yes",choices:["red","green","blue","cyan","magenta","yellow","black","x-axis"],type:"menu",value:"red",label:"Plot color"},tool_tip:{edit:"no",type:"string",value:"Voltage probe",label:"Tool tip"},offset:{edit:"yes",type:"string",value:"0",label:"Plot offset"}},icon:[["terminal",[0,0,0],{line:"no",name:"probe"}],["line",[0,0,0,4,-4]],["line",[2,-6,0,4,4]],["line",[2,-6,0,15,-15]],["line",[6,-2,0,15,-15]],["line",[17,-21,0,4,4]],["arc",[19,-19,0,11,-2,5,-3]]]},v_source:{properties:{tool_tip:{edit:"no",type:"string",value:"Voltage source",label:"Tool tip"},name:{edit:"yes",type:"string",value:"",label:"Name"},value:{edit:"yes",type:"string",value:"dc(1)",label:"Value"}},icon:[["terminal",[0,0,1],{name:"nplus"}],["terminal",[0,48,3],{name:"nminus"}],["line",[0,8,0,0,4]],["circle",[0,24,0,12,0]],["line",[0,36,0,0,4]],["line",[0,15,0,0,6]],["line",[-3,18,0,6,0]],["line",[-3,30,0,6,0]],["property",[14,24,0],{format:"{value}"}],["property",[-14,24,0],{align:"center-right",format:"{name}"}]]}}),jade.model.libraries.analog.read_only=!0,new jade.model.Library("gates",{and2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"120p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2300",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"13",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 L\n01 L\n10 L\n11 H\n\n.plot A B\n.plot Z\n"]],schematic:[["gates:nand2",[-48,-8,0]],["gates:inverter",[0,0,0]],["port",[-48,-8,0],{signal:"A"}],["port",[-48,8,0],{signal:"B"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[8,-4,0,0,24]],["arc",[20,-4,0,16,12,15,9]],["arc",[20,20,6,16,12,15,9]],["line",[8,-4,0,12,0]],["line",[8,20,0,12,0]],["property",[33,15,0],{align:"top-left",format:"{name}"}],["line",[40,8,0,-4,0]]]},and3:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"150p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2600",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"17",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000 L\n001 L\n010 L\n011 L\n100 L\n101 L\n110 L\n111 H\n\n.plot A B C\n.plot Z\n"]],schematic:[["gates:nand3",[-48,-16,0]],["gates:inverter",[0,0,0]],["port",[-48,-16,0],{signal:"A"}],["port",[-48,0,0],{signal:"B"}],["port",[-48,16,0],{signal:"C"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,16,4],{name:"Z"}],["arc",[20,4,0,16,12,15,9]],["arc",[20,28,6,16,12,15,9]],["line",[8,4,0,12,0]],["line",[8,28,0,12,0]],["property",[33,23,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["line",[8,-4,0,0,40]],["line",[40,16,0,-4,0]]]},and4:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"160p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2800",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"20",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C D\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0000 L\n0001 L\n0010 L\n0011 L\n0100 L\n0101 L\n0110 L\n0111 L\n1000 L\n1001 L\n1010 L\n1011 L\n1100 L\n1101 L\n1110 L\n1111 H\n\n.plot A B C D\n.plot Z\n"]],schematic:[["gates:nand4",[-48,-24,0]],["gates:inverter",[0,0,0]],["port",[-48,-24,0],{signal:"A"}],["port",[-48,-8,0],{signal:"B"}],["port",[-48,8,0],{signal:"C"}],["port",[-48,24,0],{signal:"D"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,24,4],{name:"Z"}],["arc",[20,12,0,16,12,15,9]],["arc",[20,36,6,16,12,15,9]],["line",[8,12,0,12,0]],["line",[8,36,0,12,0]],["property",[33,31,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["terminal",[0,48,0],{name:"D"}],["line",[8,-4,0,0,57]],["line",[40,24,0,-4,0]]]},buffer:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"20p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"80p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"2200",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"1200",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.003p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"13",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0 L\n1 H\n\n\n.plot A\n.plot Z\n"]],schematic:[["gates:inverter",[-32,0,0]],["gates:inverter",[0,0,0]],["port",[-32,0,0],{signal:"A"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[32,0,4],{name:"Z"}],["line",[8,-8,0,0,16]],["line",[8,8,0,16,-8]],["line",[24,0,0,-16,-8]],["property",[16,4,0],{align:"top-left",format:"{name}"}]]},dlatch:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"190p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4300",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"36",label:"Size (\u03bc\xb2)"},ts:{edit:"no",choices:[""],type:"number",value:"200p",label:"Setup time (s)"},th:{edit:"no",choices:[""],type:"number",value:"25p",label:"Hold time (s)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs D G\n.group outputs Q\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 -\n\n\n.plot D G\n.plot Q\n"]],schematic:[["gates:nand2",[-16,-72,0]],["gates:nand2",[-16,-8,0]],["gates:inverter",[-16,32,0]],["port",[-16,-8,0],{signal:"D"}],["port",[-16,32,0],{signal:"G"}],["port",[80,-32,4],{signal:"Q"}],["wire",[-16,8,0,-8,0],{signal:"G"}],["wire",[-16,-56,0,-8,0],{signal:"GN"}],["wire",[24,32,0,-8,0],{signal:"GN"}],["gates:nand2",[-16,-40,0]],["gates:nand3",[32,-48,0]],["wire",[-16,-40,0,-24,0]],["wire",[80,-96,0,-120,0]],["wire",[-40,-40,0,0,-32]],["wire",[-40,-96,0,0,24]],["wire",[-16,-72,0,-24,0]],["wire",[-16,-24,0,0,16]],["wire",[80,-96,0,0,64]],["wire",[32,-64,0,0,16],{signal:"mem"}],["wire",[32,-16,0,0,16]],["wire",[32,-64,0,8,0]],["analog:initial_voltage",[40,-64,0],{IV:"1"}],["text",[-40,-110,0],{text:"Set initial voltage of feedback loop to be consistent with nodes",font:"4pt sans-serif"}],["text",[-40,-104,0],{text:"being initialized to 0V -- prevents convergence problems.",font:"4pt sans-serif"}]],icon:[["terminal",[0,0,0],{name:"D"}],["terminal",[0,16,0],{name:"G"}],["terminal",[40,0,4],{name:"Q"}],["text",[10,0,0],{text:"D"}],["text",[10,16,0],{text:"G"}],["text",[30,0,0],{text:"Q",align:"center-right"}],["line",[8,-8,0,24,0]],["line",[32,-8,0,0,32]],["line",[32,24,0,-24,0]],["line",[8,24,0,0,-32]],["property",[20,-8,0],{align:"bottom-center",format:"{name}"}]]},dlatchn:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"190p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4300",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"36",label:"Size (\u03bc\xb2)"},ts:{edit:"no",choices:[""],type:"number",value:"200p",label:"Setup time (s)"},th:{edit:"no",choices:[""],type:"number",value:"25p",label:"Hold time (s)"}},test:[["test",""]],schematic:[["gates:nand2",[-24,-40,0]],["gates:nand2",[-24,24,0]],["gates:inverter",[-24,64,0]],["port",[-24,24,0],{signal:"D"}],["port",[-24,64,0],{signal:"GN"}],["port",[72,0,4],{signal:"Q"}],["wire",[-24,40,0,-8,0],{signal:"G"}],["wire",[-24,-24,0,-8,0],{signal:"GN"}],["wire",[16,64,0,-8,0],{signal:"G"}],["gates:nand2",[-24,-8,0]],["gates:nand3",[24,-16,0]],["wire",[-24,-8,0,-24,0]],["wire",[72,-64,0,-120,0]],["wire",[-48,-8,0,0,-32]],["wire",[-48,-64,0,0,24]],["wire",[-24,-40,0,-24,0]],["wire",[-24,8,0,0,16]],["wire",[72,-64,0,0,64]],["wire",[24,-32,0,0,16]],["wire",[24,16,0,0,16]],["wire",[32,-32,0,-8,0]],["analog:initial_voltage",[32,-32,0],{IV:"1"}],["text",[-48,-78,0],{text:"Set initial voltage of feedback loop to be consistent with nodes",font:"4pt sans-serif"}],["text",[-48,-72,0],{text:"being initialized to 0V -- prevents convergence problems.",font:"4pt sans-serif"}]],icon:[["terminal",[0,0,0],{name:"D"}],["terminal",[0,16,0],{line:"no",name:"GN"}],["terminal",[40,0,4],{name:"Q"}],["text",[10,0,0],{text:"D"}],["text",[10,16,0],{text:"GN"}],["text",[30,0,0],{text:"Q",align:"center-right"}],["line",[8,-8,0,24,0]],["line",[32,-8,0,0,32]],["line",[32,24,0,-24,0]],["line",[8,24,0,0,-32]],["circle",[6,16,0,2]],["line",[4,16,0,-4,0]],["property",[20,-8,0],{align:"bottom-center",format:"{name}"}]]},dreg:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"190p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4300",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"56",label:"Size (\u03bc\xb2)"},ts:{edit:"no",choices:[""],type:"number",value:"200p",label:"Setup time (s)"},th:{edit:"no",choices:[""],type:"number",value:"25p",label:"Hold time (s)"}},test:[["test",""]],schematic:[["gates:dlatch",[-16,0,0],{name:"slave"}],["gates:dlatchn",[-56,0,0],{name:"master"}],["port",[-56,0,0],{signal:"D"}],["port",[24,0,4],{signal:"Q"}],["port",[-56,32,0],{signal:"CLK"}],["wire",[-56,32,0,0,-16]],["wire",[-16,16,0,0,16]],["wire",[-16,32,0,-40,0]]],icon:[["terminal",[0,0,0],{name:"D"}],["terminal",[0,16,0],{name:"CLK"}],["terminal",[40,0,4],{name:"Q"}],["text",[10,0,0],{text:"D"}],["text",[30,0,0],{text:"Q",align:"center-right"}],["line",[8,-8,0,24,0]],["line",[32,-8,0,0,32]],["line",[32,24,0,-24,0]],["line",[8,24,0,0,-32]],["line",[14,16,0,-6,3]],["line",[14,16,6,-6,3]],["property",[20,-8,0],{align:"bottom-center",format:"{name}"}]]},inverter:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"5p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"20p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"2300",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"1200",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.007p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"10",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0 H\n1 L\n\n\n.plot A\n.plot Z\n"]],schematic:[["analog:pfet",[0,-32,0],{W:"16"}],["analog:nfet",[0,0,0],{W:"4"}],["vdd",[0,-32,0]],["ground",[0,32,0]],["port",[-24,0,0],{signal:"A"}],["wire",[-24,-16,0,0,16]],["wire",[-24,16,0,0,-16]],["port",[0,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[32,0,4],{line:"no",name:"Z"}],["line",[8,-8,0,0,16]],["line",[8,8,0,16,-8]],["line",[24,0,0,-16,-8]],["property",[16,4,0],{align:"top-left",format:"{name}"}],["circle",[26,0,0,2]],["line",[32,0,0,-4,0]]]},mux2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"20p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"120p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.005p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"27",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs D0 D1 S\n.group outputs Y\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000 L\n001 L\n010 L\n011 H\n100 H\n101 L\n110 H\n111 H\n\n.plot D0 D1 S\n.plot Y\n"]],schematic:[["gates:nand2",[-56,-32,0]],["gates:nand2",[-56,0,0]],["gates:nand2",[-8,-16,0]],["wire",[-8,-24,0,0,8]],["wire",[-8,0,0,0,8]],["gates:inverter",[-56,40,0]],["port",[-56,-32,0],{signal:"D0"}],["port",[-56,0,0],{signal:"D1"}],["port",[-56,40,0],{signal:"S"}],["port",[40,-8,4],{signal:"Y"}],["wire",[-56,16,0,-8,0],{signal:"S"}],["wire",[-56,-16,0,-8,0],{signal:"SN"}],["wire",[-16,40,0,-8,0],{signal:"SN"}]],icon:[["terminal",[0,0,0],{name:"D0"}],["terminal",[0,16,0],{name:"D1"}],["terminal",[16,32,5],{name:"S"}],["line",[8,-8,0,0,32]],["line",[24,0,0,0,16]],["line",[24,16,0,-16,8]],["line",[8,-8,0,16,8]],["terminal",[32,8,4],{name:"Y"}],["line",[16,24,0,0,-4]],["text",[10,0,0],{text:"0"}],["text",[10,16,0],{text:"1"}]]},mux4:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"40p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"190p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.006p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"66",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs D0 D1 D2 D3 S[1] S[0]\n.group outputs Y\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000000 L\n000001 L\n000010 L\n000011 L\n000100 L\n000101 L\n000110 L\n000111 H\n\n001000 L\n001001 L\n001010 H\n001011 L\n001100 L\n001101 L\n001110 H\n001111 H\n\n010000 L\n010001 H\n010010 L\n010011 L\n010100 L\n010101 H\n010110 L\n010111 H\n\n011000 L\n011001 H\n011010 H\n011011 L\n011100 L\n011101 H\n011110 H\n011111 H\n\n100000 H\n100001 L\n100010 L\n100011 L\n100100 H\n100101 L\n100110 L\n100111 H\n\n101000 H\n101001 L\n101010 H\n101011 L\n101100 H\n101101 L\n101110 H\n101111 H\n\n110000 H\n110001 H\n110010 L\n110011 L\n110100 H\n110101 H\n110110 L\n110111 H\n\n111000 H\n111001 H\n111010 H\n111011 L\n111100 H\n111101 H\n111110 H\n111111 H\n\n.plot D0 D1 D2 D3 S[1] S[0]\n.plot Y\n"]],schematic:[["gates:nand3",[-48,-56,0]],["gates:nand3",[-48,-8,0]],["gates:nand3",[-48,40,0]],["gates:nand3",[-48,88,0]],["gates:nand4",[16,8,0]],["wire",[0,8,0,0,16]],["wire",[0,24,0,16,0]],["wire",[0,56,0,0,-16]],["wire",[0,40,0,16,0]],["wire",[16,8,0,0,-48]],["wire",[16,-40,0,-16,0]],["wire",[16,56,0,0,48]],["wire",[16,104,0,-16,0]],["gates:inverter",[-48,136,0]],["port",[-48,-56,0],{signal:"D0"}],["port",[-48,-8,0],{signal:"D1"}],["port",[-48,40,0],{signal:"D2"}],["port",[-48,88,0],{signal:"D3"}],["port",[-48,136,0],{signal:"S[1:0]"}],["port",[64,32,4],{signal:"Y"}],["wire",[-48,-40,0,-8,0],{signal:"SN[0]"}],["wire",[-16,136,0,8,0],{signal:"SN[1:0]"}],["wire",[-48,-24,0,-8,0],{signal:"SN[1]"}],["wire",[-48,120,0,-8,0],{signal:"S[1]"}],["wire",[-48,104,0,-8,0],{signal:"S[0]"}],["wire",[-48,56,0,-8,0],{signal:"SN[0]"}],["wire",[-48,72,0,-8,0],{signal:"S[1]"}],["wire",[-48,24,0,-8,0],{signal:"SN[1]"}],["wire",[-48,8,0,-8,0],{signal:"S[0]"}]],icon:[["terminal",[0,0,0],{name:"D0"}],["terminal",[0,16,0],{name:"D1"}],["terminal",[16,64,5],{name:"S[1:0]"}],["line",[24,48,0,-16,8]],["line",[8,-8,0,16,8]],["terminal",[32,24,4],{name:"Y"}],["line",[16,56,0,0,-4]],["text",[10,0,0],{text:"0"}],["text",[10,16,0],{text:"1"}],["terminal",[0,32,0],{name:"D2"}],["terminal",[0,48,0],{name:"D3"}],["line",[24,0,0,0,48]],["line",[8,-8,0,0,64]],["text",[10,32,0],{text:"2"}],["text",[10,48,0],{text:"3"}]]},nand2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"10p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2800",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.004p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"10",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 H\n01 H\n10 H\n11 L\n\n.plot A B\n.plot Z\n"]],schematic:[["analog:nfet",[0,0,0],{W:"4"}],["analog:nfet",[0,32,0],{W:"4"}],["analog:pfet",[0,-32,0],{W:"16"}],["analog:pfet",[48,-32,0],{W:"16"}],["port",[-24,16,0],{signal:"A"}],["port",[-24,48,0],{signal:"B"}],["port",[48,0,4],{signal:"Z"}],["wire",[-24,-16,0,0,32]],["ground",[0,64,0]],["wire",[-24,48,0,48,0]],["wire",[24,-16,0,0,64]],["wire",[0,0,0,48,0]],["vdd",[24,-32,0]],["wire",[0,-32,0,24,0]],["wire",[48,-32,0,-24,0]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[8,-4,0,0,24]],["arc",[20,-4,0,16,12,15,9]],["arc",[20,20,6,16,12,15,9]],["line",[8,-4,0,12,0]],["line",[8,20,0,12,0]],["circle",[38,8,0,2]],["property",[33,15,0],{align:"top-left",format:"{name}"}]]},nand3:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"10p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"50p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4200",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"3000",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.005p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"13",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000 H\n001 H\n010 H\n011 H\n100 H\n101 H\n110 H\n111 L\n\n.plot A B C\n.plot Z\n"]],schematic:[["analog:nfet",[-8,-24,0],{W:"4"}],["analog:nfet",[-8,8,0],{W:"4"}],["analog:pfet",[-8,-56,0],{W:"16"}],["analog:pfet",[40,-56,0],{W:"16"}],["port",[-32,-8,0],{signal:"A"}],["port",[-32,24,0],{signal:"B"}],["port",[88,-24,4],{signal:"Z"}],["wire",[-32,-40,0,0,32]],["ground",[-8,72,0]],["wire",[-32,24,0,48,0]],["wire",[16,-40,0,0,64]],["wire",[-8,-24,0,48,0]],["vdd",[40,-56,0]],["analog:pfet",[88,-56,0],{W:"16"}],["wire",[40,-56,0,48,0]],["wire",[40,-24,0,48,0]],["analog:nfet",[-8,40,0],{W:"4"}],["port",[-32,56,0],{signal:"C"}],["wire",[-8,-56,0,48,0]],["wire",[-32,56,0,96,0]],["wire",[64,56,0,0,-96]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,16,4],{name:"Z"}],["arc",[20,4,0,16,12,15,9]],["arc",[20,28,6,16,12,15,9]],["line",[8,4,0,12,0]],["line",[8,28,0,12,0]],["circle",[38,16,0,2]],["property",[33,23,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["line",[8,-4,0,0,40]]]},nand4:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"10p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"70p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4400",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"3500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.005p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"17",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C D\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0000 H\n0001 H\n0010 H\n0011 H\n0100 H\n0101 H\n0110 H\n0111 H\n1000 H\n1001 H\n1010 H\n1011 H\n1100 H\n1101 H\n1110 H\n1111 L\n\n.plot A B C D\n.plot Z\n"]],schematic:[["analog:nfet",[-32,-32,0],{W:"4"}],["analog:nfet",[-32,0,0],{W:"4"}],["analog:pfet",[-32,-64,0],{W:"16"}],["analog:pfet",[16,-64,0],{W:"16"}],["port",[-56,-16,0],{signal:"A"}],["port",[-56,16,0],{signal:"B"}],["port",[112,-32,4],{signal:"Z"}],["wire",[-56,-48,0,0,32]],["ground",[-32,96,0]],["wire",[-56,16,0,48,0]],["wire",[-8,-48,0,0,64]],["wire",[-32,-32,0,48,0]],["vdd",[40,-64,0]],["analog:pfet",[64,-64,0],{W:"16"}],["wire",[16,-32,0,48,0]],["analog:nfet",[-32,32,0],{W:"4"}],["port",[-56,48,0],{signal:"C"}],["wire",[-32,-64,0,48,0]],["wire",[-56,48,0,96,0]],["wire",[40,48,0,0,-96]],["analog:pfet",[112,-64,0],{W:"16"}],["wire",[64,-32,0,48,0]],["wire",[64,-64,0,48,0]],["wire",[16,-64,0,24,0]],["wire",[64,-64,0,-24,0]],["analog:nfet",[-32,64,0],{W:"4"}],["port",[-56,80,0],{signal:"D"}],["wire",[-56,80,0,144,0]],["wire",[88,80,0,0,-128]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,24,4],{name:"Z"}],["arc",[20,12,0,16,12,15,9]],["arc",[20,36,6,16,12,15,9]],["line",[8,12,0,12,0]],["line",[8,36,0,12,0]],["circle",[38,24,0,2]],["property",[33,31,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["terminal",[0,48,0],{name:"D"}],["line",[8,-4,0,0,57]]]},nor2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"10p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"50p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"6700",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2400",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.004p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"10",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 H\n01 L\n10 L\n11 L\n\n.plot A B\n.plot Z\n"]],schematic:[["analog:pfet",[8,-32,0],{W:"16"}],["analog:pfet",[8,-64,0],{W:"16"}],["port",[-16,-16,0],{signal:"A"}],["port",[-16,-48,0],{signal:"B"}],["port",[56,0,4],{signal:"Z"}],["analog:nfet",[8,0,0],{W:"4"}],["wire",[-16,-16,0,0,32]],["vdd",[8,-64,0]],["ground",[32,32,0]],["analog:nfet",[56,0,0],{W:"4"}],["wire",[8,32,0,24,0]],["wire",[56,32,0,-24,0]],["wire",[32,16,0,0,-64]],["wire",[32,-48,0,-48,0]],["wire",[8,0,0,48,0]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[8,20,0,8,0]],["line",[8,-4,0,8,0]],["arc",[16,-4,0,20,12,18,9]],["arc",[16,20,6,20,12,18,9]],["circle",[38,8,0,2.23606797749979]],["arc",[8,-4,0,0,24,3,12]],["line",[8,0,0,2,0]],["line",[8,16,0,2,0]],["property",[32,14,0],{align:"top-left",format:"{name}"}]]},nor3:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"20p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"80p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"8500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2400",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:".005p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"13",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000 H\n001 L\n010 L\n011 L\n100 L\n101 L\n110 L\n111 L\n\n.plot A B C\n.plot Z\n"]],schematic:[["analog:pfet",[-8,-24,0],{W:"16"}],["analog:pfet",[-8,-56,0],{W:"16"}],["port",[-32,-8,0],{signal:"A"}],["port",[-32,-40,0],{signal:"B"}],["port",[88,8,4],{signal:"Z"}],["analog:nfet",[-8,8,0],{W:"4"}],["wire",[-32,-8,0,0,32]],["vdd",[-8,-88,0]],["ground",[40,40,0]],["analog:nfet",[40,8,0],{W:"4"}],["wire",[16,24,0,0,-64]],["wire",[16,-40,0,-48,0]],["wire",[-8,8,0,48,0]],["analog:nfet",[88,8,0],{W:"4"}],["wire",[40,40,0,48,0]],["wire",[40,8,0,48,0]],["wire",[40,40,0,-48,0]],["analog:pfet",[-8,-88,0],{W:"16"}],["port",[-32,-72,0],{signal:"C"}],["wire",[-32,-72,0,96,0]],["wire",[64,-72,0,0,96]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,16,4],{name:"Z"}],["line",[8,28,0,8,0]],["line",[8,4,0,8,0]],["arc",[16,4,0,20,12,18,9]],["arc",[16,28,6,20,12,18,9]],["circle",[38,16,0,2.23606797749979]],["arc",[8,4,0,0,24,3,12]],["property",[32,22,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["arc",[8,-4,0,0,8,2,4]],["line",[8,0,0,2,0]],["line",[8,16,0,3,0]],["line",[8,32,0,2,0]],["arc",[8,28,0,0,8,2,5]]]},nor4:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"20p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"120p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"9500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2400",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.005p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"20",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C D\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0000 H\n0001 L\n0010 L\n0011 L\n0100 L\n0101 L\n0110 L\n0111 L\n1000 L\n1001 L\n1010 L\n1011 L\n1100 L\n1101 L\n1110 L\n1111 L\n\n.plot A B C D\n.plot Z\n"]],schematic:[["analog:pfet",[-24,-8,0],{W:"16"}],["analog:pfet",[-24,-40,0],{W:"16"}],["port",[-48,8,0],{signal:"A"}],["port",[-48,-24,0],{signal:"B"}],["port",[120,24,4],{signal:"Z"}],["analog:nfet",[-24,24,0],{W:"4"}],["wire",[-48,8,0,0,32]],["vdd",[-24,-104,0]],["ground",[48,56,0]],["analog:nfet",[24,24,0],{W:"4"}],["wire",[0,40,0,0,-64]],["wire",[0,-24,0,-48,0]],["wire",[-24,24,0,48,0]],["analog:nfet",[72,24,0],{W:"4"}],["wire",[24,24,0,48,0]],["wire",[24,56,0,-48,0]],["analog:pfet",[-24,-72,0],{W:"16"}],["port",[-48,-56,0],{signal:"C"}],["wire",[-48,-56,0,96,0]],["wire",[48,-56,0,0,96]],["analog:nfet",[120,24,0],{W:"4"}],["wire",[24,56,0,24,0]],["wire",[72,56,0,-24,0]],["wire",[72,56,0,48,0]],["wire",[72,24,0,48,0]],["analog:pfet",[-24,-104,0],{W:"16"}],["port",[-48,-88,0],{signal:"D"}],["wire",[-48,-88,0,144,0]],["wire",[96,-88,0,0,128]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,24,4],{name:"Z"}],["line",[8,36,0,8,0]],["line",[8,12,0,8,0]],["arc",[16,12,0,20,12,18,9]],["arc",[16,36,6,20,12,18,9]],["circle",[38,24,0,2.23606797749979]],["arc",[8,12,0,0,24,3,12]],["property",[32,30,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["terminal",[0,48,0],{name:"D"}],["arc",[8,36,0,0,17,2,12]],["arc",[8,12,6,0,17,2,12]],["line",[8,0,0,2,0]],["line",[8,16,0,2,0]],["line",[8,32,0,2,0]],["line",[8,48,0,2,0]]]},or2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"150p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.002p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"13",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 L\n01 H\n10 H\n11 H\n\n.plot A B\n.plot Z\n"]],schematic:[["gates:nor2",[-48,-8,0]],["gates:inverter",[0,0,0]],["port",[-48,-8,0],{signal:"A"}],["port",[-48,8,0],{signal:"B"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[8,20,0,8,0]],["line",[8,-4,0,8,0]],["arc",[16,-4,0,20,12,18,9]],["arc",[16,20,6,20,12,18,9]],["arc",[8,-4,0,0,24,3,12]],["line",[8,0,0,2,0]],["line",[8,16,0,2,0]],["property",[32,14,0],{align:"top-left",format:"{name}"}],["line",[40,8,0,-4,0]]]},or3:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"40p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"210p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.003p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"17",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n000 L\n001 H\n010 H\n011 H\n100 H\n101 H\n110 H\n111 H\n\n.plot A B C\n.plot Z\n"]],schematic:[["gates:nor3",[-48,-16,0]],["gates:inverter",[0,0,0]],["port",[-48,-16,0],{signal:"A"}],["port",[-48,0,0],{signal:"B"}],["port",[-48,16,0],{signal:"C"}],["port",[32,0,4],{signal:"Z"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,16,4],{name:"Z"}],["line",[8,28,0,8,0]],["line",[8,4,0,8,0]],["arc",[16,4,0,20,12,18,9]],["arc",[16,28,6,20,12,18,9]],["arc",[8,4,0,0,24,3,12]],["property",[32,22,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["arc",[8,-4,0,0,8,2,4]],["line",[8,0,0,2,0]],["line",[8,16,0,3,0]],["line",[8,32,0,2,0]],["arc",[8,28,0,0,8,2,5]],["line",[40,16,0,-4,0]]]},or4:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"60p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"290p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2600",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:".003p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"20",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B C D\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n0000 L\n0001 H\n0010 H\n0011 H\n0100 H\n0101 H\n0110 H\n0111 H\n1000 H\n1001 H\n1010 H\n1011 H\n1100 H\n1101 H\n1110 H\n1111 H\n\n.plot A B C D\n.plot Z\n"]],schematic:[["gates:nor4",[-48,-24,0]],["gates:inverter",[0,0,0]],["port",[-48,-24,0],{signal:"A"}],["port",[-48,-8,0],{signal:"B"}],["port",[-48,8,0],{signal:"C"}],["port",[32,0,4],{signal:"Z"}],["port",[-48,24,0],{signal:"D"}]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[0,16,0],{name:"B"}],["terminal",[48,24,4],{name:"Z"}],["line",[8,36,0,8,0]],["line",[8,12,0,8,0]],["arc",[16,12,0,20,12,18,9]],["arc",[16,36,6,20,12,18,9]],["arc",[8,12,0,0,24,3,12]],["property",[32,30,0],{align:"top-left",format:"{name}"}],["terminal",[0,32,0],{name:"C"}],["terminal",[0,48,0],{name:"C"}],["arc",[8,36,0,0,17,2,12]],["arc",[8,12,6,0,17,2,12]],["line",[8,0,0,2,0]],["line",[8,16,0,2,0]],["line",[8,32,0,2,0]],["line",[8,48,0,2,0]],["line",[40,24,0,-4,0]]]},tristate:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"150p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"2300",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"1300",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:".004p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"23",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A E\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 -\n01 L\n10 -\n11 H\n\n\n.plot A E\n.plot Z\n"]],schematic:[["analog:pfet",[0,-32,0],{W:"16"}],["analog:nfet",[0,0,0],{W:"4"}],["vdd",[0,-32,0]],["ground",[0,32,0]],["gates:nand2",[-72,-24,0]],["gates:nor2",[-72,8,0]],["gates:inverter",[-96,56,0]],["port",[-96,-8,0],{signal:"A"}],["wire",[-96,-8,0,24,0]],["wire",[-96,24,0,24,0]],["port",[-96,56,0],{signal:"E"}],["wire",[-64,56,0,8,0],{signal:"EN"}],["wire",[-72,-24,0,-8,0],{signal:"E"}],["wire",[-72,8,0,-8,0],{signal:"EN"}],["port",[0,0,4],{signal:"Z"}],["wire",[-96,-8,0,0,32]]],icon:[["terminal",[0,0,0],{name:"A"}],["terminal",[32,0,4],{name:"Z"}],["line",[8,-8,0,0,16]],["line",[8,8,0,16,-8]],["line",[24,0,0,-16,-8]],["property",[19,3,0],{align:"top-left",format:"{name}"}],["terminal",[16,16,3],{name:"E"}],["line",[16,8,0,0,-4]]]},xnor2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"140p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.006p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"27",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 H\n01 L\n10 L\n11 H\n\n.plot A B\n.plot Z\n"]],schematic:[["analog:pfet",[0,-32,0],{W:"16"}],["analog:nfet",[0,0,0],{W:"4"}],["analog:nfet",[0,32,0],{W:"4"}],["gates:nand2",[-72,-8,0]],["wire",[-24,-16,0,0,16]],["wire",[-24,16,0,0,-16]],["ground",[32,64,0]],["port",[-72,-8,0],{signal:"A"}],["port",[-72,8,0],{signal:"B"}],["wire",[-72,8,0,0,40]],["analog:nfet",[64,32,0],{W:"4"}],["wire",[0,64,0,32,0]],["wire",[64,64,0,-32,0]],["analog:pfet",[64,-32,0],{W:"16"}],["analog:pfet",[64,-64,0],{W:"16"}],["vdd",[32,-64,0]],["wire",[0,-32,0,0,-32]],["wire",[0,-64,0,32,0]],["wire",[64,-64,0,-32,0]],["wire",[0,0,0,64,0]],["port",[64,0,4],{signal:"Z"}],["wire",[0,32,0,64,0]],["wire",[-72,48,0,48,0]],["wire",[-24,48,0,40,0]],["wire",[40,-16,0,-24,0]],["wire",[16,48,0,0,-64]],["wire",[-72,-8,0,0,-40]],["wire",[40,48,0,-8,0]],["wire",[32,48,0,0,-96]],["wire",[-72,-48,0,104,0]],["wire",[40,-48,0,-8,0]]],icon:[["line",[8,20,0,8,0]],["line",[8,-4,0,8,0]],["arc",[16,-4,0,20,12,18,9]],["arc",[16,20,6,20,12,18,9]],["arc",[8,-4,0,0,24,3,12]],["property",[32,14,0],{align:"top-left",format:"{name}"}],["arc",[5,-4,0,0,24,3,12]],["terminal",[0,0,0],{line:"no",name:"A"}],["terminal",[0,16,0],{line:"no",name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[0,0,0,7,0]],["line",[0,16,0,7,0]],["circle",[38,8,0,2]]]},xor2:{properties:{name:{edit:"yes",choices:[""],type:"string",value:"",label:"Name"},tcd:{edit:"no",choices:[""],type:"number",value:"30p",label:"Contamination delay (s)"},tpd:{edit:"no",choices:[""],type:"number",value:"140p",label:"Propagation delay (s)"},tr:{edit:"no",choices:[""],type:"number",value:"4500",label:"Output rise time (s/F)"},tf:{edit:"no",choices:[""],type:"number",value:"2500",label:"Output fall time (s/F)"},cin:{edit:"no",choices:[""],type:"number",value:"0.006p",label:"Input capacitance (F)"},size:{edit:"no",choices:[""],type:"number",value:"27",label:"Size (\u03bc\xb2)"}},test:[["test",".power Vdd=1\n.thresholds Vol=0 Vil=0.1 Vih=0.9 Voh=1\n\n.group inputs A B\n.group outputs Z\n\n.cycle assert inputs tran 9n sample outputs tran 1n\n00 L\n01 H\n10 H\n11 L\n\n.plot A B\n.plot Z\n"]],schematic:[["analog:pfet",[0,-32,0],{W:"16"}],["analog:pfet",[0,-64,0],{W:"16"}],["analog:nfet",[0,0,0],{W:"4"}],["analog:nfet",[0,32,0],{W:"4"}],["ground",[24,64,0]],["analog:pfet",[48,-64,0],{W:"16"}],["gates:nor2",[-96,24,0]],["port",[-96,24,0],{signal:"A"}],["port",[-96,40,0],{signal:"B"}],["wire",[-96,40,0,0,8]],["wire",[-96,48,0,72,0]],["wire",[24,48,0,0,-96]],["wire",[-96,24,0,0,-8]],["wire",[-96,16,0,72,0]],["wire",[-96,16,0,0,-64]],["wire",[-96,-48,0,72,0]],["wire",[-48,32,0,0,-48]],["wire",[-48,-16,0,24,0]],["vdd",[24,-64,0]],["wire",[0,-64,0,24,0]],["wire",[-24,48,0,48,0]],["wire",[0,-32,0,48,0]],["wire",[24,-64,0,24,0]],["wire",[64,64,0,0,-32]],["wire",[0,64,0,24,0]],["wire",[0,0,0,64,0]],["wire",[24,64,0,40,0]],["port",[64,0,4],{signal:"Z"}],["wire",[-48,32,0,0,56]],["wire",[-48,88,0,88,0]],["wire",[40,88,0,0,-72]],["analog:nfet",[64,0,0],{W:"4"}]],icon:[["terminal",[0,0,0],{line:"no",name:"A"}],["terminal",[0,16,0],{line:"no",name:"B"}],["terminal",[48,8,4],{name:"Z"}],["line",[8,20,0,8,0]],["line",[8,-4,0,8,0]],["arc",[16,-4,0,20,12,18,9]],["arc",[16,20,6,20,12,18,9]],["arc",[8,-4,0,0,24,3,12]],["property",[32,14,0],{align:"top-left",format:"{name}"}],["arc",[5,-4,0,0,24,3,12]],["line",[0,0,0,7,0]],["line",[0,16,0,7,0]],["line",[40,8,0,-4,0]]]}}),jade.model.libraries.gates.read_only=!0;
